<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PixelArena | Bonus Hub</title>

<style>
/* --- ANA SAYFA ƒ∞LE AYNI TASARIM DEƒûƒ∞≈ûKENLERƒ∞ --- */
:root {
    --primary: #4fd1ff;
    --accent: #ff8a00;
    --bg-dark: #03050a;
    --glass: rgba(10, 15, 30, 0.9);
    --border: #1e2642;
    --card-gradient: linear-gradient(145deg, #0f172a, #020617);
    --neon-purple: #9333ea;
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;}
body{background: var(--bg-dark); color:white; overflow-x:hidden; line-height: 1.5;}

#snow { position:fixed; top:0; left:0; width:100%; height:100%; z-index:1; pointer-events:none; opacity: 0.4; }

/* --- TOP BAR (ANA SAYFAYLA AYNI) --- */
.top-bar {
    position: fixed; top: 0; width: 100%; height: 60px;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 15px; background: var(--glass);
    backdrop-filter: blur(15px); border-bottom: 1px solid var(--border); z-index: 2000;
}
.brand {
    font-size: 18px; font-weight: 900; letter-spacing: 1px;
    background: linear-gradient(90deg, var(--primary), #fff);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.balance-box { 
    background: #1a2248; border: 1px solid rgba(79, 209, 255, 0.2); 
    color: var(--primary); padding: 7px 12px; border-radius: 12px; 
    font-weight: 800; font-size: 13px;
}

/* --- CONTENT --- */
.panel-container { margin-top: 100px; padding: 20px; max-width: 500px; margin-left: auto; margin-right: auto; position: relative; z-index: 10; }

/* ANA SAYFADAKƒ∞ GAME CARD STƒ∞Lƒ∞NDE BUTONLAR */
.animated-btn {
    background: var(--card-gradient); border-radius: 24px; padding: 25px;
    text-align: center; border: 1px solid var(--border); position: relative;
    transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); overflow: hidden;
    cursor: pointer; margin-bottom: 20px; font-weight: 800;
}
.animated-btn:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }

/* √ñZEL ANƒ∞MASYONLU KENARLIK (G√úNL√úK √áARK ƒ∞√áƒ∞N) */
.premium-btn::before {
    content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: conic-gradient(transparent, var(--primary), transparent, var(--neon-purple), transparent);
    animation: rotate 4s linear infinite; z-index: -1;
}
.premium-btn::after { content: ""; position: absolute; inset: 2px; background: #0d1333; border-radius: 22px; z-index: -1; }
@keyframes rotate { 100% { transform: rotate(360deg); } }

/* --- MODAL (ANA SAYFA AUTH MODAL STƒ∞Lƒ∞) --- */
.modal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px);
    display: none; justify-content: center; align-items: center; z-index: 5000;
}
.modal-content {
    background: #0f172a; padding: 35px; border-radius: 25px; width: 90%; max-width: 400px;
    text-align: center; border: 1px solid var(--border); position: relative;
}
.close { position: absolute; right: 20px; top: 20px; cursor: pointer; opacity: 0.5; font-size: 20px; }

input { 
    width: 100%; padding: 15px; margin: 15px 0; border-radius: 12px; 
    background: #050811; border: 1px solid var(--border); color: white; 
    text-align: center; font-weight: bold; outline: none;
}
input:focus { border-color: var(--primary); }

.action-btn { 
    width: 100%; padding: 16px; border-radius: 12px; border: none; 
    background: linear-gradient(90deg, var(--accent), #ff5f00); 
    font-weight: 900; cursor: pointer; color: #000; 
}

/* --- √áARK TASARIMI --- */
.wheel-wrapper { position: relative; width: 280px; height: 280px; margin: 25px auto; }
#wheel { 
    width: 100%; height: 100%; border-radius: 50%; border: 6px solid #1e2642;
    box-shadow: 0 0 30px rgba(79, 209, 255, 0.2); transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
}
.pointer {
    position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
    width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent;
    border-top: 25px solid var(--accent); z-index: 10;
}

.footer { margin-top: 50px; text-align: center; color: #444; font-size: 12px; padding-bottom: 30px; }
</style>
</head>
<body>

<canvas id="snow"></canvas>

<div class="top-bar">
    <div class="brand">PixelArena Bonus</div>
    <div class="balance-box">‚Ç∫<span id="userBalance">0</span></div>
</div>

<div class="panel-container">
    <div class="animated-btn" onclick="openModal('codeModal')">
        <div style="font-size: 30px; margin-bottom: 10px;">üéÅ</div>
        <span>BONUS KOD Gƒ∞R</span>
    </div>

    <div class="animated-btn premium-btn" onclick="openModal('wheelModal')">
        <div style="font-size: 30px; margin-bottom: 10px;">üé°</div>
        <span>G√úNL√úK √áARK</span>
    </div>

    <div class="animated-btn" onclick="location.href='index.html'">
        <div style="font-size: 30px; margin-bottom: 10px;">üè†</div>
        <span>ANA SAYFAYA D√ñN</span>
    </div>

    <div class="footer">¬© 2026 PixelArena Global. All Rights Reserved.</div>
</div>

<div class="modal" id="codeModal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('codeModal')">‚úï</span>
        <h2 style="margin-bottom: 10px;">Promosyon</h2>
        <p style="font-size: 13px; opacity: 0.6;">Size √∂zel kodu buraya girin.</p>
        <input id="codeInput" placeholder="KODU BURAYA YAZ">
        <button class="action-btn" onclick="useCode()">ONAYLA</button>
    </div>
</div>

<div class="modal" id="wheelModal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('wheelModal')">‚úï</span>
        <h2 style="margin-bottom: 5px;">≈ûans √áarkƒ±</h2>
        <p style="font-size: 12px; color: var(--primary);">Her 24 saatte bir √ºcretsiz √ßevir!</p>
        <div class="wheel-wrapper">
            <div class="pointer"></div>
            <canvas id="wheel" width="300" height="300"></canvas>
        </div>
        <button class="action-btn" id="spinBtn" onclick="spinWheel()">√áEVƒ∞R</button>
    </div>
</div>

<audio id="spinSound" playsinline><source src="https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-wheel-1934.mp3" type="audio/mpeg"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc, increment, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
    authDomain: "emirhan-site.firebaseapp.com",
    projectId: "emirhan-site",
    storageBucket: "emirhan-site.firebasestorage.app",
    messagingSenderId: "668871888390",
    appId: "1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
const spinSound = document.getElementById("spinSound");

// --- SNOW (ANA SAYFAYLA AYNI) ---
const canvasSnow = document.getElementById("snow");
const ctxSnow = canvasSnow.getContext("2d");
let particles = [];
function resize() { canvasSnow.width = window.innerWidth; canvasSnow.height = window.innerHeight; }
window.onresize = resize; resize();
for(let i=0; i<80; i++) particles.push({x:Math.random()*canvasSnow.width, y:Math.random()*canvasSnow.height, r:Math.random()*2+1, d:Math.random()*0.5+0.2});
function drawSnow() {
    ctxSnow.clearRect(0,0,canvasSnow.width, canvasSnow.height);
    ctxSnow.fillStyle = "rgba(255,255,255,0.3)";
    ctxSnow.beginPath();
    particles.forEach(p => {
        ctxSnow.moveTo(p.x, p.y); ctxSnow.arc(p.x, p.y, p.r, 0, Math.PI*2);
        p.y += p.d; if(p.y > canvasSnow.height) p.y = -5;
    });
    ctxSnow.fill(); requestAnimationFrame(drawSnow);
}
drawSnow();

// --- AUTH & SYNC ---
onAuthStateChanged(auth, async (user) => {
    if(!user) { location.href="index.html"; return; }
    currentUser = user;
    onSnapshot(doc(db, "users", user.uid), s => {
        if(s.exists()) document.getElementById("userBalance").innerText = s.data().balance.toLocaleString();
    });
});

// --- WHEEL LOGIC ---
const wheelCanvas = document.getElementById("wheel");
const wctx = wheelCanvas.getContext("2d");
const rewards = [100, 500, 1000, 200, 2500, 50]; 
const colors = ["#0f172a", "#4fd1ff", "#0f172a", "#9333ea", "#0f172a", "#ff8a00"];

function drawWheel() {
    const angle = (2 * Math.PI) / rewards.length;
    for(let i=0; i<rewards.length; i++) {
        wctx.beginPath(); wctx.moveTo(150, 150);
        wctx.arc(150, 150, 150, i * angle, (i + 1) * angle);
        wctx.fillStyle = colors[i]; wctx.fill();
        wctx.save(); wctx.translate(150, 150); wctx.rotate(i * angle + angle / 2);
        wctx.fillStyle = "white"; wctx.font = "bold 16px Arial"; wctx.textAlign = "right";
        wctx.fillText(rewards[i] + "‚Ç∫", 130, 8); wctx.restore();
    }
}
drawWheel();

let currentRotation = 0;
window.spinWheel = async () => {
    const btn = document.getElementById("spinBtn");
    const userRef = doc(db, "users", currentUser.uid);
    const snap = await getDoc(userRef);
    
    const lastSpin = snap.data().lastSpin || 0;
    if(Date.now() - lastSpin < 24 * 60 * 60 * 1000) {
        alert("Bug√ºn zaten √ßevirdiniz! Yarƒ±n tekrar gelin.");
        return;
    }

    btn.disabled = true;
    spinSound.play().catch(()=>{});

    const segmentAngle = 360 / rewards.length;
    const randomIndex = Math.floor(Math.random() * rewards.length);
    const stopAt = (randomIndex * segmentAngle);
    currentRotation += (360 * 5) + (360 - stopAt) - (segmentAngle/2); 
    
    wheelCanvas.style.transform = `rotate(${currentRotation}deg)`;

    setTimeout(async () => {
        const prize = rewards[randomIndex];
        await updateDoc(userRef, { balance: increment(prize), lastSpin: Date.now() });
        alert(`Tebrikler! ${prize}‚Ç∫ kazandƒ±nƒ±z.`);
        btn.disabled = false;
        closeModal('wheelModal');
    }, 4100);
};

window.useCode = async () => {
    const code = document.getElementById("codeInput").value.trim().toUpperCase();
    if(!code) return;
    const codeRef = doc(db, "codes", code);
    const cSnap = await getDoc(codeRef);
    if(!cSnap.exists()) { alert("Ge√ßersiz kod!"); return; }

    await updateDoc(doc(db, "users", currentUser.uid), { balance: increment(cSnap.data().reward) });
    alert("Kod ba≈üarƒ±yla kullanƒ±ldƒ±!");
    closeModal('codeModal');
};

window.openModal = id => document.getElementById(id).style.display = "flex";
window.closeModal = id => document.getElementById(id).style.display = "none";
</script>
</body>
</html>
