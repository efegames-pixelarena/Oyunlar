<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PixelArena | Snake Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #4fd1ff;
    --bg-dark: #03050a;
    --border: #1e2642;
    --nokia-dark: #0f380f;
    --nokia-med: #2f4f2f;
    --nokia-light: #8bac0f;
    --nokia-screen: #9bbc0f;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body {
    background: var(--bg-dark);
    background-image: 
        radial-gradient(circle at 50% 50%, #1a2248 0%, #03050a 100%);
    height: 100vh;
    overflow: hidden;
    font-family: 'Press Start 2P', monospace;
    display: flex;
    flex-direction: column;
}

/* --- PROFESYONEL ÜST BAR --- */
.top-bar {
    width: 100%;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(10, 15, 30, 0.9);
    backdrop-filter: blur(15px);
    border-bottom: 1px solid var(--border);
    position: relative;
    z-index: 10;
}

.brand {
    font-size: 18px;
    font-weight: 900;
    letter-spacing: 2px;
    background: linear-gradient(90deg, var(--primary), #fff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* --- OYUN ALANI --- */
.main-container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.console {
    width: 100%;
    max-width: 380px;
    background: #2a2f3a;
    padding: 25px;
    border-radius: 40px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.8), inset 0 2px 5px rgba(255,255,255,0.1);
    border: 1px solid #444;
    position: relative;
}

.score-panel {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    color: var(--nokia-dark);
    background: var(--nokia-light);
    padding: 10px;
    border-radius: 5px 5px 0 0;
    font-size: 9px;
    border-bottom: 2px solid var(--nokia-dark);
}

.screen-container {
    position: relative;
    background: var(--nokia-screen);
    border: 10px solid #111;
    border-radius: 5px;
    box-shadow: inset 0 0 40px rgba(0,0,0,0.2);
    overflow: hidden;
}

canvas {
    display: block;
    width: 100%;
    height: auto;
    image-rendering: pixelated;
}

/* --- KONTROLLER --- */
.controls {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: 15px;
    margin-top: 30px;
    padding: 0 10px;
}

.btn {
    aspect-ratio: 1/1;
    background: #1e222a;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #888;
    font-size: 20px;
    border: none;
    box-shadow: 0 6px 0 #111, 0 10px 15px rgba(0,0,0,0.5);
    cursor: pointer;
    transition: all 0.1s;
}

.btn:active {
    transform: translateY(4px);
    box-shadow: 0 2px 0 #111;
    color: var(--primary);
}

.btn-up { grid-column: 2; }
.btn-left { grid-column: 1; }
.btn-down { grid-column: 2; }
.btn-right { grid-column: 3; }

/* --- EKRAN KATMANLARI --- */
.overlay {
    position: absolute;
    inset: 0;
    background: var(--nokia-screen);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 5;
    text-align: center;
}

#gameover { display: none; background: rgba(155, 188, 15, 0.9); }

.blink { animation: blinker 1s linear infinite; }
@keyframes blinker { 50% { opacity: 0; } }

</style>
</head>
<body>

<div class="top-bar">
    <div class="brand">PIXELARENA</div>
</div>

<div class="main-container">
    <div class="console">
        <div class="score-panel">
            <span>SCORE:<span id="score">0</span></span>
            <span>BEST:<span id="high">0</span></span>
        </div>

        <div class="screen-container">
            <canvas id="game" width="300" height="300"></canvas>
            
            <div id="startup" class="overlay">
                <div style="font-size:18px; color:var(--nokia-dark); margin-bottom:20px;">SNAKE PRO</div>
                <div class="blink" style="font-size:8px; color:var(--nokia-dark);">START TO PLAY</div>
            </div>

            <div id="gameover" class="overlay">
                <div style="font-size:14px; color:var(--nokia-dark);">GAME OVER</div>
                <div id="finalScore" style="font-size:10px; color:var(--nokia-dark); margin: 15px 0;"></div>
                <div class="blink" style="font-size:7px; color:var(--nokia-dark);">TAP TO RESTART</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-up" id="btn-UP">↑</button>
            <button class="btn btn-left" id="btn-LEFT">←</button>
            <button class="btn btn-down" id="btn-DOWN">↓</button>
            <button class="btn btn-right" id="btn-RIGHT">→</button>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const box = 15;
const size = 300;

let snake, direction, nextDirection, food, score, started = false;
let currentSpeed, lastMoveTime, audioCtx;

// High Score Yükle
const getHigh = () => localStorage.getItem("snake_pro_best") || 0;
document.getElementById("high").innerText = getHigh();

function initAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}

function beep(freq, dur) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "square";
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + dur/1000);
}

function startGame() {
    initAudio();
    snake = [{x: 10*box, y: 10*box}, {x: 9*box, y: 10*box}];
    direction = "RIGHT";
    nextDirection = "RIGHT";
    score = 0;
    currentSpeed = 150;
    spawnFood();
    started = true;
    document.getElementById("score").innerText = "0";
    document.getElementById("startup").style.display = "none";
    document.getElementById("gameover").style.display = "none";
    requestAnimationFrame(gameLoop);
}

function spawnFood() {
    food = {
        x: Math.floor(Math.random() * (size/box)) * box,
        y: Math.floor(Math.random() * (size/box)) * box
    };
}

function gameLoop(time) {
    if (!started) return;
    if (time - lastMoveTime > currentSpeed) {
        update();
        lastMoveTime = time;
    }
    draw();
    requestAnimationFrame(gameLoop);
}

function update() {
    direction = nextDirection;
    let head = { x: snake[0].x, y: snake[0].y };

    if (direction === "UP") head.y -= box;
    if (direction === "DOWN") head.y += box;
    if (direction === "LEFT") head.x -= box;
    if (direction === "RIGHT") head.x += box;

    // Çarpışma Kontrolü
    if (head.x < 0 || head.y < 0 || head.x >= size || head.y >= size || 
        snake.some(s => s.x === head.x && s.y === head.y)) {
        endGame();
        return;
    }

    // Yemek Yeme
    if (head.x === food.x && head.y === food.y) {
        score++;
        beep(600, 50);
        document.getElementById("score").innerText = score;
        spawnFood();
        currentSpeed = Math.max(60, 150 - (score * 2)); // Hızlanma
    } else {
        snake.pop();
    }

    snake.unshift(head);
}

function draw() {
    ctx.fillStyle = "#9bbc0f";
    ctx.fillRect(0, 0, size, size);

    // Yılan
    snake.forEach((s, i) => {
        ctx.fillStyle = "#0f380f";
        ctx.fillRect(s.x + 1, s.y + 1, box - 2, box - 2);
        if(i === 0) { // Gözler
            ctx.fillStyle = "#9bbc0f";
            ctx.fillRect(s.x + 3, s.y + 3, 2, 2);
            ctx.fillRect(s.x + 10, s.y + 3, 2, 2);
        }
    });

    // Yemek
    ctx.fillStyle = "#0f380f";
    ctx.fillRect(food.x + 4, food.y + 4, box - 8, box - 8);
}

function endGame() {
    started = false;
    beep(150, 400);
    if (score > getHigh()) localStorage.setItem("snake_pro_best", score);
    document.getElementById("high").innerText = getHigh();
    document.getElementById("finalScore").innerText = "SCORE: " + score;
    document.getElementById("gameover").style.display = "flex";
}

// Kontrolcü Dinleyicileri
const handleInput = (d) => {
    if (d === "UP" && direction !== "DOWN") nextDirection = "UP";
    if (d === "DOWN" && direction !== "UP") nextDirection = "DOWN";
    if (d === "LEFT" && direction !== "RIGHT") nextDirection = "LEFT";
    if (d === "RIGHT" && direction !== "LEFT") nextDirection = "RIGHT";
};

document.querySelectorAll('.btn').forEach(btn => {
    btn.onpointerdown = (e) => {
        e.preventDefault();
        handleInput(btn.id.split('-')[1]);
    };
});

document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp") handleInput("UP");
    if (e.key === "ArrowDown") handleInput("DOWN");
    if (e.key === "ArrowLeft") handleInput("LEFT");
    if (e.key === "ArrowRight") handleInput("RIGHT");
});

document.getElementById("startup").onclick = startGame;
document.getElementById("gameover").onclick = startGame;

</script>
</body>
</html>
