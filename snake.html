<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PixelArena | Snake 3310</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
/* --- PIXELARENA CORE STYLES --- */
:root {
    --primary: #4fd1ff;
    --accent: #ff8a00;
    --bg-dark: #03050a;
    --glass: rgba(10, 15, 30, 0.9);
    --border: #1e2642;
    --nokia-dark: #0f380f;
    --nokia-med: #2f4f2f;
    --nokia-light: #8bac0f;
    --nokia-screen: #9bbc0f;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body { 
    background: var(--bg-dark); 
    color: white; 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto; 
    overflow-x: hidden;
    min-height: 100vh;
}

/* --- TOP BAR (SHARED) --- */
.top-bar {
    position: fixed; top: 0; width: 100%; height: 60px;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 15px; background: var(--glass);
    backdrop-filter: blur(15px); border-bottom: 1px solid var(--border); z-index: 2000;
}
.brand-section { display: flex; align-items: center; gap: 15px; }
.brand {
    font-size: 18px; font-weight: 900; letter-spacing: 1px;
    background: linear-gradient(90deg, var(--primary), #fff);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.right-menu { display: flex; gap: 8px; align-items: center; }
.nav-box { 
    padding: 7px 12px; border-radius: 12px; font-weight: 800; font-size: 12px; 
    background: #1a2248; border: 1px solid rgba(79, 209, 255, 0.2); color: var(--primary);
}
.btn { padding: 8px 16px; border-radius: 10px; border: none; font-weight: 800; font-size: 12px; cursor: pointer; }
.logout-btn { background: #ff2a4d; color: white; display: none; }

/* --- SNAKE GAME SPECIFIC --- */
.game-wrapper {
    margin-top: 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    font-family: 'Press Start 2P', monospace;
}

.console {
    width: 100%;
    max-width: 360px;
    background: var(--nokia-light);
    border: 10px solid var(--nokia-med);
    border-radius: 20px;
    padding: 15px;
    box-shadow: 0 0 30px rgba(0,0,0,0.5);
}

.score-panel {
    width: 100%;
    font-size: 8px;
    color: var(--nokia-dark);
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
}

.screen-container {
    position: relative;
    border: 4px solid var(--nokia-dark);
    background: var(--nokia-screen);
    width: 100%;
}

canvas {
    width: 100%;
    height: auto;
    display: block;
    image-rendering: pixelated;
}

.controls {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-gap: 8px;
    margin-top: 20px;
}

.control-btn {
    background: var(--nokia-med);
    color: white;
    height: 55px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 10px;
    font-size: 18px;
    box-shadow: 0 4px 0 var(--nokia-dark);
    cursor: pointer;
}

.control-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 var(--nokia-dark); }

.startup-overlay {
    position: fixed; inset: 0; background: var(--nokia-light);
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    z-index: 3000; color: var(--nokia-dark); cursor: pointer;
}

.gameover-layer {
    position: absolute; inset: 0; background: rgba(155, 188, 15, 0.95);
    display: none; flex-direction: column; justify-content: center; align-items: center;
    text-align: center; color: var(--nokia-dark); font-size: 12px;
}

/* --- SIDE MENU --- */
.side-menu {
    position: fixed; top: 0; left: -280px; width: 280px; height: 100%;
    background: #050811; padding: 30px 20px; transition: 0.4s;
    z-index: 4000; border-right: 1px solid var(--border);
}
.side-menu.active { left: 0; }
.side-menu a { display: block; padding: 15px; color: #ccd6f6; text-decoration: none; font-weight: 700; }

</style>
</head>
<body>

<div class="top-bar">
    <div class="brand-section">
        <div id="menuBtn" style="cursor:pointer; font-size:24px;">‚ò∞</div>
        <div class="brand">PixelArena</div>
    </div>
    <div class="right-menu">
        <div class="nav-box" id="balanceBox" style="display:none;">
            ‚Ç∫<span id="userBalance">0</span>
        </div>
        <button class="btn logout-btn" id="logoutBtn">√áIKI≈û</button>
    </div>
</div>

<div id="sideMenu" class="side-menu">
    <div style="font-size: 20px; font-weight: 900; margin-bottom: 30px;">MENU <span id="closeMenu" style="float:right; cursor:pointer">‚úï</span></div>
    <a href="index.html">üè† Ana Sayfa</a>
    <a href="panel.html">üíé Bonus</a>
    <a href="index.html#games">üïπÔ∏è Oyunlar</a>
</div>

<div class="startup-overlay" id="startup">
    <h1 style="font-size: 24px;">NOKIA</h1>
    <p style="font-size: 8px; margin-top: 10px;">Connecting People</p>
    <p style="margin-top: 50px; font-size: 10px; animation: blink 1s infinite;">OYNAMAK ƒ∞√áƒ∞N DOKUN</p>
</div>

<div class="game-wrapper">
    <div class="console">
        <div class="score-panel">
            <div>SKOR: <span id="score">0</span></div>
            <div>EN Y√úKSEK: <span id="high">0</span></div>
        </div>

        <div class="screen-container">
            <canvas id="game" width="300" height="300"></canvas>
            <div class="gameover-layer" id="gameover">
                <p>GAME OVER</p>
                <p style="font-size: 8px; margin-top: 15px;">TEKRAR DENE</p>
            </div>
        </div>

        <div class="controls">
            <div style="visibility:hidden"></div>
            <div class="control-btn" id="btn-UP">‚Üë</div>
            <div style="visibility:hidden"></div>
            <div class="control-btn" id="btn-LEFT">‚Üê</div>
            <div class="control-btn" id="btn-DOWN">‚Üì</div>
            <div class="control-btn" id="btn-RIGHT">‚Üí</div>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
    authDomain:"emirhan-site.firebaseapp.com",
    projectId:"emirhan-site",
    storageBucket:"emirhan-site.firebasestorage.app",
    messagingSenderId:"668871888390",
    appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- AUTH & BALANCE SYNC ---
onAuthStateChanged(auth, user => {
    if(user) {
        document.getElementById("balanceBox").style.display = "block";
        document.getElementById("logoutBtn").style.display = "block";
        onSnapshot(doc(db, "users", user.uid), s => {
            if(s.exists()) document.getElementById("userBalance").innerText = s.data().balance.toLocaleString();
        });
    } else {
        // Giri≈ü yapmamƒ±≈üsa ana sayfaya y√∂nlendirilebilir veya butonlar gizlenebilir
    }
});

document.getElementById("logoutBtn").onclick = () => signOut(auth).then(() => location.href='index.html');

// --- SNAKE GAME ENGINE ---
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const box = 15;
const size = 300;

let snake, direction, food, score, started = false;
let currentSpeed, lastMoveTime, nextDirection, audioCtx;

function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function beep(freq, dur) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "square";
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + dur/1000);
}

const highScore = () => localStorage.getItem("snakeHighPro") || 0;
document.getElementById("high").innerText = highScore();

document.getElementById("startup").onclick = function() {
    initAudio();
    this.style.display = "none";
    startGame();
};

function startGame() {
    snake = [{ x: 10 * box, y: 10 * box }, { x: 9 * box, y: 10 * box }];
    direction = "RIGHT";
    nextDirection = "RIGHT";
    food = { x: 5 * box, y: 5 * box, special: false };
    score = 0;
    currentSpeed = 180;
    lastMoveTime = 0;
    started = true;
    document.getElementById("score").innerText = "0";
    document.getElementById("gameover").style.display = "none";
    requestAnimationFrame(gameLoop);
}

function gameLoop(time) {
    if (!started) return;
    if (time - lastMoveTime > currentSpeed) {
        update();
        lastMoveTime = time;
    }
    draw();
    requestAnimationFrame(gameLoop);
}

function update() {
    direction = nextDirection;
    let head = { x: snake[0].x, y: snake[0].y };
    if (direction === "UP") head.y -= box;
    if (direction === "DOWN") head.y += box;
    if (direction === "LEFT") head.x -= box;
    if (direction === "RIGHT") head.x += box;

    if (head.x < 0 || head.y < 0 || head.x >= size || head.y >= size || snake.some(s => s.x === head.x && s.y === head.y)) {
        gameOver(); return;
    }

    if (head.x === food.x && head.y === food.y) {
        score++;
        beep(400, 50);
        food = { x: Math.floor(Math.random()*20)*box, y: Math.floor(Math.random()*20)*box };
        currentSpeed = Math.max(70, 180 - (score * 2));
    } else { snake.pop(); }
    snake.unshift(head);
    document.getElementById("score").innerText = score;
}

function draw() {
    ctx.fillStyle = "#9bbc0f";
    ctx.fillRect(0, 0, size, size);
    ctx.fillStyle = "#0f380f";
    snake.forEach(s => ctx.fillRect(s.x + 1, s.y + 1, box - 2, box - 2));
    ctx.fillRect(food.x + 4, food.y + 4, box - 8, box - 8);
}

function gameOver() {
    started = false;
    beep(150, 400);
    if (score > highScore()) localStorage.setItem("snakeHighPro", score);
    document.getElementById("gameover").style.display = "flex";
}

document.getElementById("gameover").onclick = startGame;

// Controls
const handleInput = (d) => {
    if (d === "UP" && direction !== "DOWN") nextDirection = "UP";
    if (d === "DOWN" && direction !== "UP") nextDirection = "DOWN";
    if (d === "LEFT" && direction !== "RIGHT") nextDirection = "LEFT";
    if (d === "RIGHT" && direction !== "LEFT") nextDirection = "RIGHT";
};

["UP", "DOWN", "LEFT", "RIGHT"].forEach(d => {
    document.getElementById("btn-"+d).onpointerdown = (e) => { e.preventDefault(); handleInput(d); };
});

// Menu Logic
const sideMenu = document.getElementById("sideMenu");
document.getElementById("menuBtn").onclick = () => sideMenu.classList.add("active");
document.getElementById("closeMenu").onclick = () => sideMenu.classList.remove("active");
</script>
</body>
</html>
