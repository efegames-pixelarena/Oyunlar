<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake.io Test</title>
<style>
body, html { margin:0; padding:0; overflow:hidden; background:#111; }
canvas { display:block; }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let W = window.innerWidth;
let H = window.innerHeight;
canvas.width = W; canvas.height = H;

const MAP_SIZE = 2000; // test için küçük
const MAX_FOODS = 50;
const MAX_BOTS = 10;

let mySnake = { body:[{x:W/2,y:H/2}], dir:'RIGHT', speed:4, score:0 };
let foods = [];
let bots = [];

// input
let inputDir = {x:0,y:0};
canvas.addEventListener("touchstart", handleTouch);
canvas.addEventListener("touchmove", handleTouch);
function handleTouch(e){
    e.preventDefault();
    let touch = e.touches[0];
    let dx = touch.clientX - W/2;
    let dy = touch.clientY - H/2;
    let len = Math.sqrt(dx*dx+dy*dy);
    inputDir.x = dx/len;
    inputDir.y = dy/len;
}

// spawn foods
for(let i=0;i<MAX_FOODS;i++){
    foods.push({ x: W/2 + Math.random()*400-200, y: H/2 + Math.random()*400-200, type: Math.random()<0.2?"red":"green" });
}

// spawn bots
for(let i=0;i<MAX_BOTS;i++){
    bots.push({ body:[{x: W/2 + Math.random()*400-200, y:H/2 + Math.random()*400-200}], speed:2, score:0 });
}

// update snake
function updateMySnake(){
    if(inputDir.x!==0 || inputDir.y!==0){
        let head = mySnake.body[0];
        let newX = head.x + inputDir.x*mySnake.speed;
        let newY = head.y + inputDir.y*mySnake.speed;

        // duvar kontrolü
        newX = Math.max(0, Math.min(MAP_SIZE, newX));
        newY = Math.max(0, Math.min(MAP_SIZE, newY));

        mySnake.body.unshift({x:newX,y:newY});
        if(mySnake.body.length > 20 + mySnake.score/5) mySnake.body.pop();
    }

    // yem yeme
    foods.forEach((f,i)=>{
        if(Math.hypot(f.x-mySnake.body[0].x,f.y-mySnake.body[0].y)<15){
            mySnake.score += (f.type==="red"?5:1);
            foods[i] = { x: W/2 + Math.random()*400-200, y: H/2 + Math.random()*400-200, type: Math.random()<0.2?"red":"green" };
        }
    });
}

// botlar hareket
function updateBots(){
    bots.forEach(bot=>{
        let head = bot.body[0];
        let targetFood = foods[Math.floor(Math.random()*foods.length)];
        let dx = targetFood.x - head.x;
        let dy = targetFood.y - head.y;
        let len = Math.sqrt(dx*dx+dy*dy);
        dx/=len; dy/=len;
        bot.body.unshift({x: head.x + dx*bot.speed, y: head.y + dy*bot.speed});
        if(bot.body.length>20+bot.score/5) bot.body.pop();
    });
}

// render
function render(){
    // kamera
    let camX = mySnake.body[0].x - W/2;
    let camY = mySnake.body[0].y - H/2;

    // arka plan
    ctx.fillStyle = "#222";
    ctx.fillRect(0,0,W,H);

    // foods
    foods.forEach(f=>{
        ctx.fillStyle = f.type==="red"?"red":"green";
        ctx.fillRect(f.x - camX -7, f.y - camY -7, 14,14);
    });

    // bots
    bots.forEach(bot=>{
        ctx.fillStyle="blue";
        bot.body.forEach(seg=>{
            ctx.fillRect(seg.x - camX -7, seg.y - camY -7, 14,14);
        });
    });

    // my snake
    ctx.fillStyle="yellow";
    mySnake.body.forEach(seg=>{
        ctx.fillRect(seg.x - camX -7, seg.y - camY -7, 14,14);
    });

    // skor
    ctx.fillStyle="white";
    ctx.font="20px Arial";
    ctx.fillText("Skor: "+mySnake.score, 20,30);
}

function gameLoop(){
    updateMySnake();
    updateBots();
    render();
    requestAnimationFrame(gameLoop);
}

gameLoop();

</script>
</body>
</html>
