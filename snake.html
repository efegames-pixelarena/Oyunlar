<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>PixelArena | Snake Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #4fd1ff;
    --bg-dark: #03050a;
    --border: #1e2642;
    --nokia-dark: #0f380f;
    --nokia-screen: #9bbc0f;
}

/* √áift Tƒ±klama Zoom ve Se√ßme Sorununu K√∂kten √á√∂zen Profesyonel Reset */
* { 
    margin:0; padding:0; box-sizing:border-box; 
    -webkit-tap-highlight-color:transparent; 
    outline: none; 
    user-select: none;
    -webkit-user-select: none;
    touch-action: none; /* T√ºm tarayƒ±cƒ± seviyesi dokunmatik hareketleri (zoom dahil) kapatƒ±r */
}

body {
    background: var(--bg-dark);
    background-image: radial-gradient(circle at 50% 50%, #1a2248 0%, #03050a 100%);
    height: 100vh; width: 100vw; overflow: hidden;
    font-family: 'Press Start 2P', monospace;
    display: flex; flex-direction: column;
}

.top-bar {
    width: 100%; height: 60px; display: flex; align-items: center; justify-content: space-between;
    padding: 0 20px; background: rgba(10, 15, 30, 0.9); backdrop-filter: blur(15px);
    border-bottom: 1px solid var(--border); z-index: 100;
}

.back-btn {
    color: white; text-decoration: none; font-size: 10px; padding: 8px 12px; border-radius: 8px;
    background: #1e2642; border: 1px solid rgba(255,255,255,0.1);
}

.brand {
    font-size: 14px; font-weight: 900; letter-spacing: 1px;
    background: linear-gradient(90deg, var(--primary), #fff);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}

.main-container { flex: 1; display: flex; justify-content: center; align-items: center; padding: 10px; }

.console {
    width: 100%; max-width: 350px; background: #2a2f3a; padding: 20px; border-radius: 30px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.8); border: 1px solid #444;
}

.score-panel {
    display: flex; justify-content: space-between; background: #8bac0f;
    padding: 8px; font-size: 8px; color: var(--nokia-dark); border-bottom: 2px solid var(--nokia-dark);
}

.screen-container { position: relative; background: var(--nokia-screen); border: 8px solid #111; overflow: hidden; }

canvas { display: block; width: 100%; height: auto; image-rendering: pixelated; }

.controls { display: grid; grid-template-columns: repeat(3, 1fr); grid-gap: 12px; margin-top: 20px; }

/* Buton Tasarƒ±mƒ± Korundu */
.btn {
    aspect-ratio: 1/1; background: #1e222a; border-radius: 50%; display: flex;
    justify-content: center; align-items: center; color: #888; font-size: 20px;
    border: none; box-shadow: 0 5px 0 #111; cursor: pointer;
    touch-action: none;
}

.btn:active { transform: translateY(3px); box-shadow: 0 2px 0 #111; color: var(--primary); }

.btn-up { grid-column: 2; }
.btn-left { grid-column: 1; }
.btn-down { grid-column: 2; }
.btn-right { grid-column: 3; }

.overlay {
    position: absolute; inset: 0; background: var(--nokia-screen); display: flex;
    flex-direction: column; justify-content: center; align-items: center;
    z-index: 10; text-align: center; cursor: pointer;
}

.blink { animation: blinker 1s linear infinite; }
@keyframes blinker { 50% { opacity: 0; } }
</style>
</head>
<body>

<div class="top-bar">
    <a href="index.html" class="back-btn">‚á† GERƒ∞</a>
    <div class="brand">PIXELARENA</div>
    <div style="width:50px;"></div>
</div>

<div class="main-container">
    <div class="console">
        <div class="score-panel">
            <span>SCORE:<span id="score">0</span></span>
            <span>BEST:<span id="high">0</span></span>
        </div>

        <div class="screen-container">
            <canvas id="game" width="300" height="300"></canvas>
            
            <div id="startup" class="overlay">
                <div style="font-size:16px; color:var(--nokia-dark); margin-bottom:15px;">SNAKE PRO</div>
                <div class="blink" style="font-size:8px; color:var(--nokia-dark);">BA≈ûLAMAK ƒ∞√áƒ∞N DOKUN</div>
            </div>

            <div id="gameover" class="overlay" style="display:none;">
                <div style="font-size:14px; color:var(--nokia-dark);">EYVAH!</div>
                <div id="finalScore" style="font-size:10px; color:var(--nokia-dark); margin: 10px 0;"></div>
                <div class="blink" style="font-size:7px; color:var(--nokia-dark);">TEKRAR DENE</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-up" id="btn-UP">‚Üë</button>
            <button class="btn btn-left" id="btn-LEFT">‚Üê</button>
            <button class="btn btn-down" id="btn-DOWN">‚Üì</button>
            <button class="btn btn-right" id="btn-RIGHT">‚Üí</button>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const box = 15;
const size = 300;

let snake, direction, nextDirection, food, score, started = false;
let currentSpeed, lastMoveTime, gameInterval;

// --- KESƒ∞N √áALI≈ûAN SES MOTORU (iOS UNLOCKER) ---
let audioCtx = null;

function unlockAudio() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
    // iOS i√ßin sessiz bir buffer oynatƒ±p kanalƒ± a√ßƒ±yoruz
    const buffer = audioCtx.createBuffer(1, 1, 22050);
    const source = audioCtx.createBufferSource();
    source.buffer = buffer;
    source.connect(audioCtx.destination);
    source.start(0);
}

function playSound(freq, type, dur, vol = 0.1) {
    if (!audioCtx || audioCtx.state !== 'running') return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    
    gain.gain.setValueAtTime(vol, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    
    osc.start();
    osc.stop(audioCtx.currentTime + dur);
}

const sounds = {
    move: () => playSound(400, 'sine', 0.05, 0.05),
    eatGreen: () => playSound(800, 'square', 0.1, 0.1),
    eatRed: () => {
        playSound(1000, 'square', 0.1, 0.1);
        setTimeout(() => playSound(1300, 'square', 0.1, 0.1), 60);
    },
    dead: () => {
        playSound(200, 'sawtooth', 0.3, 0.2);
        setTimeout(() => playSound(100, 'sawtooth', 0.4, 0.2), 100);
    }
};

const getHigh = () => localStorage.getItem("snake_pro_best") || 0;
document.getElementById("high").innerText = getHigh();

function spawnFood() {
    const isSpecial = Math.random() < 0.15;
    food = {
        x: Math.floor(Math.random() * (size/box)) * box,
        y: Math.floor(Math.random() * (size/box)) * box,
        type: isSpecial ? 'üçé' : 'üçè',
        value: isSpecial ? 3 : 1
    };
    if(snake.some(s => s.x === food.x && s.y === food.y)) spawnFood();
}

function startGame() {
    unlockAudio();
    snake = [{x: 10*box, y: 10*box}, {x: 9*box, y: 10*box}, {x: 8*box, y: 10*box}];
    direction = "RIGHT";
    nextDirection = "RIGHT";
    score = 0;
    currentSpeed = 150;
    lastMoveTime = 0;
    spawnFood();
    
    document.getElementById("score").innerText = "0";
    document.getElementById("startup").style.display = "none";
    document.getElementById("gameover").style.display = "none";
    
    started = true;
    if(gameInterval) cancelAnimationFrame(gameInterval);
    gameInterval = requestAnimationFrame(gameLoop);
}

function gameLoop(time) {
    if (!started) return;
    if (time - lastMoveTime > currentSpeed) {
        update();
        lastMoveTime = time;
    }
    draw();
    gameInterval = requestAnimationFrame(gameLoop);
}

function update() {
    direction = nextDirection;
    let head = { x: snake[0].x, y: snake[0].y };

    if (direction === "UP") head.y -= box;
    if (direction === "DOWN") head.y += box;
    if (direction === "LEFT") head.x -= box;
    if (direction === "RIGHT") head.x += box;

    if (head.x < 0 || head.y < 0 || head.x >= size || head.y >= size || 
        snake.some(s => s.x === head.x && s.y === head.y)) {
        return endGame();
    }

    if (head.x === food.x && head.y === food.y) {
        score += food.value;
        document.getElementById("score").innerText = score;
        if(food.type === 'üçé') sounds.eatRed(); else sounds.eatGreen();
        spawnFood();
        if(currentSpeed > 60) currentSpeed -= 2;
    } else {
        snake.pop();
    }
    snake.unshift(head);
}

function draw() {
    ctx.fillStyle = "#9bbc0f";
    ctx.fillRect(0, 0, size, size);
    ctx.font = "14px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(food.type, food.x + box/2, food.y + box/2);
    snake.forEach(s => {
        ctx.fillStyle = "#0f380f";
        ctx.fillRect(s.x + 1, s.y + 1, box - 2, box - 2);
    });
}

function endGame() {
    started = false;
    sounds.dead();
    if (score > getHigh()) localStorage.setItem("snake_pro_best", score);
    document.getElementById("high").innerText = getHigh();
    document.getElementById("finalScore").innerText = "SKORUN: " + score;
    document.getElementById("gameover").style.display = "flex";
}

function moveAction(dir) {
    unlockAudio();
    if(!started) return;
    sounds.move();
    if (dir === "UP" && direction !== "DOWN") nextDirection = "UP";
    if (dir === "DOWN" && direction !== "UP") nextDirection = "DOWN";
    if (dir === "LEFT" && direction !== "RIGHT") nextDirection = "LEFT";
    if (dir === "RIGHT" && direction !== "LEFT") nextDirection = "RIGHT";
}

// Butonlar - iOS √áift Tƒ±k ve Ses Fix
const btns = ["UP", "DOWN", "LEFT", "RIGHT"];
btns.forEach(id => {
    const el = document.getElementById("btn-" + id);
    el.addEventListener("touchstart", (e) => {
        e.preventDefault(); // Hem zoomu hem √ßift tƒ±kƒ± engeller
        moveAction(id);
    }, { passive: false });
});

// Klavye Desteƒüi
document.addEventListener("keydown", e => {
    if (["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)) e.preventDefault();
    if (e.key === "ArrowUp") moveAction("UP");
    if (e.key === "ArrowDown") moveAction("DOWN");
    if (e.key === "ArrowLeft") moveAction("LEFT");
    if (e.key === "ArrowRight") moveAction("RIGHT");
});

// Ba≈ülatma ve Restart - iOS i√ßin touchstart zorunlu
const startUI = document.getElementById("startup");
const restartUI = document.getElementById("gameover");

[startUI, restartUI].forEach(el => {
    el.addEventListener("touchstart", (e) => {
        e.preventDefault();
        startGame();
    }, { passive: false });
    // Yedek olarak click
    el.addEventListener("click", (e) => {
        e.preventDefault();
        startGame();
    });
});
</script>
</body>
</html>
