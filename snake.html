<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake.io Clone</title>
<style>
body { margin:0; overflow:hidden; background:#111; color:white; font-family:sans-serif;}
#gameCanvas { background:#1a1a1a; display:block; margin:0 auto; }
#info { position:absolute; top:10px; left:10px; z-index:1000; }
</style>
</head>
<body>

<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="info">Oyuncular: <span id="playerCount">0</span></div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Harita boyutu
const MAP_WIDTH = 4000;
const MAP_HEIGHT = 4000;

// Görüntülenen ekran
const VIEW_WIDTH = canvas.width;
const VIEW_HEIGHT = canvas.height;

// Oyuncular
let players = {}; // {id: {snake:[{x,y}], color, score, isBot}}

// Örnek bot yılanları
const BOT_COUNT = 50;

// Yiyecekler
let food = [];

// Oyuncu kontrolü
let playerId = 'p'+Math.floor(Math.random()*1000000);
let direction = {x:1, y:0}; // Başlangıç yön

// Kamera
let cameraX = 0, cameraY = 0;

// Başlangıç
function init(){
    // Kendi yılanımız
    players[playerId] = {
        snake: [{x:2000, y:2000}],
        color: 'lime',
        score: 0,
        isBot: false
    };

    // Botları ekle
    for(let i=0;i<BOT_COUNT;i++){
        let id = 'bot'+i;
        players[id] = {
            snake: [{x: Math.random()*MAP_WIDTH, y: Math.random()*MAP_HEIGHT}],
            color: 'red',
            score: 0,
            isBot: true,
            dir: {x: Math.random()-0.5, y: Math.random()-0.5}
        };
    }

    // Yiyecekler
    for(let i=0;i<500;i++){
        food.push({
            x: Math.random()*MAP_WIDTH,
            y: Math.random()*MAP_HEIGHT,
            type: Math.random()<0.1?'red':'green'
        });
    }

    // Input
    window.addEventListener('keydown', e=>{
        if(e.key==='ArrowUp') direction = {x:0, y:-1};
        if(e.key==='ArrowDown') direction = {x:0, y:1};
        if(e.key==='ArrowLeft') direction = {x:-1, y:0};
        if(e.key==='ArrowRight') direction = {x:1, y:0};
    });

    requestAnimationFrame(gameLoop);
}

// Yılan hareketi
function moveSnake(player, dir){
    let head = {...player.snake[0]};
    head.x += dir.x*5;
    head.y += dir.y*5;

    // Sınırlar
    if(head.x<0) head.x=0;
    if(head.y<0) head.y=0;
    if(head.x>MAP_WIDTH) head.x=MAP_WIDTH;
    if(head.y>MAP_HEIGHT) head.y=MAP_HEIGHT;

    player.snake.unshift(head);
    player.snake.pop();
}

// Bot hareketi
function moveBots(){
    for(let id in players){
        let p = players[id];
        if(p.isBot){
            // rastgele yön değiştir
            if(Math.random()<0.02){
                p.dir.x = Math.random()-0.5;
                p.dir.y = Math.random()-0.5;
            }
            moveSnake(p, p.dir);
        }
    }
}

// Yiyecek kontrolü
function eatFood(player){
    let head = player.snake[0];
    for(let i=0;i<food.length;i++){
        let f = food[i];
        if(Math.abs(head.x-f.x)<10 && Math.abs(head.y-f.y)<10){
            // yılan büyür
            player.snake.push({...player.snake[player.snake.length-1]});
            player.score += (f.type==='red'?5:1);
            food.splice(i,1);
            break;
        }
    }
}

// Oyun döngüsü
function gameLoop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Kamera yılan etrafında
    let player = players[playerId];
    cameraX = player.snake[0].x - VIEW_WIDTH/2;
    cameraY = player.snake[0].y - VIEW_HEIGHT/2;

    // Kendi yılan hareketi
    moveSnake(player, direction);

    // Botlar
    moveBots();

    // Yiyecek kontrolü
    for(let id in players){
        eatFood(players[id]);
    }

    // Çizim
    // Yiyecekler
    for(let f of food){
        ctx.fillStyle = f.type==='red'?'red':'green';
        ctx.beginPath();
        ctx.arc(f.x - cameraX, f.y - cameraY, 5,0,2*Math.PI);
        ctx.fill();
    }

    // Yılanlar
    for(let id in players){
        let p = players[id];
        ctx.fillStyle = p.color;
        for(let s of p.snake){
            ctx.fillRect(s.x - cameraX, s.y - cameraY, 10, 10);
        }
    }

    // Oyuncu sayısı
    document.getElementById('playerCount').innerText = Object.keys(players).length;

    requestAnimationFrame(gameLoop);
}

init();
</script>
</body>
</html>
