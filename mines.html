<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PixelArena - Mines</title>

<style>
body{
margin:0;
background:linear-gradient(180deg,#0b1023,#0d1333,#0a0f1f);
color:white;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
text-align:center;
}

.container{
max-width:520px;
margin:auto;
padding:20px;
}

h1{margin-top:20px}

.controls{margin:15px 0}

input,select,button{
padding:10px;
border-radius:10px;
border:none;
margin:5px;
font-size:14px;
}

button{cursor:pointer;font-weight:bold}

.start{background:#3498db;color:white}
.cashout{background:#f1c40f;color:black}

#grid{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:8px;
margin-top:20px;
}

.tile{
background:#141b3f;
height:65px;
border-radius:12px;
display:flex;
align-items:center;
justify-content:center;
font-size:22px;
cursor:pointer;
border:1px solid #2a3577;
}

.tile.open{background:#2ecc71}
.tile.mine{background:#e74c3c}

.info{margin-top:15px;font-size:18px}
</style>
</head>
<body>

<div class="container">
<h1>ðŸ’£ PixelArena Mines</h1>

<div class="controls">
<input type="number" id="bet" placeholder="Bahis MiktarÄ±" min="1">
<select id="mineCount">
<option value="3">3 MayÄ±n</option>
<option value="4">4 MayÄ±n</option>
<option value="5">5 MayÄ±n</option>
<option value="6">6 MayÄ±n</option>
<option value="7">7 MayÄ±n</option>
<option value="8">8 MayÄ±n</option>
<option value="9">9 MayÄ±n</option>
<option value="10">10 MayÄ±n</option>
</select>
<br>
<button class="start" onclick="startGame()">Oyunu BaÅŸlat</button>
<button class="cashout" onclick="cashout()">ParayÄ± Ã‡ek</button>
</div>

<div class="info">
Ã‡arpan: <span id="multiplier">1.00x</span>
</div>

<div id="grid"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* SENÄ°N FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
  authDomain: "emirhan-site.firebaseapp.com",
  projectId: "emirhan-site",
  storageBucket: "emirhan-site.firebasestorage.app",
  messagingSenderId: "668871888390",
  appId: "1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let mines=[];
let opened=0;
let gameActive=false;
let betAmount=0;
let mineTotal=3;
let currentMultiplier=1;
const houseEdge=0.97;

const grid=document.getElementById("grid");
const multiplierText=document.getElementById("multiplier");

function createGrid(){
grid.innerHTML="";
for(let i=0;i<25;i++){
const tile=document.createElement("div");
tile.classList.add("tile");
tile.dataset.index=i;
tile.onclick=()=>revealTile(i,tile);
grid.appendChild(tile);
}
}

function generateMines(){
mines=[];
while(mines.length<mineTotal){
let r=Math.floor(Math.random()*25);
if(!mines.includes(r)) mines.push(r);
}
}

async function startGame(){

if(!auth.currentUser){
alert("GiriÅŸ yapmalÄ±sÄ±n.");
return;
}

betAmount=parseFloat(document.getElementById("bet").value);
mineTotal=parseInt(document.getElementById("mineCount").value);

if(!betAmount || betAmount<=0){
alert("GeÃ§erli bahis gir.");
return;
}

const userRef=doc(db,"users",auth.currentUser.uid);
const snap=await getDoc(userRef);

if(!snap.exists()) return alert("KullanÄ±cÄ± bulunamadÄ±.");

let balance=snap.data().balance;

if(balance<betAmount){
alert("Yetersiz bakiye.");
return;
}

/* BAKÄ°YE DÃœÅž */
await updateDoc(userRef,{
balance:balance-betAmount
});

opened=0;
currentMultiplier=1;
multiplierText.innerText="1.00x";

generateMines();
createGrid();

gameActive=true;
}

function revealTile(index,tile){

if(!gameActive || tile.classList.contains("open")) return;

if(mines.includes(index)){
tile.classList.add("mine");
tile.innerHTML="ðŸ’£";
gameActive=false;
alert("MayÄ±na bastÄ±n! Bahis kaybedildi.");
return;
}

opened++;
tile.classList.add("open");
tile.innerHTML="ðŸ’Ž";

const safeTiles=25-mineTotal;

currentMultiplier=(25/(safeTiles-opened+1))*houseEdge;

multiplierText.innerText=currentMultiplier.toFixed(2)+"x";
}

async function cashout(){

if(!gameActive || opened===0) return;

gameActive=false;

const win=betAmount*currentMultiplier;

const userRef=doc(db,"users",auth.currentUser.uid);
const snap=await getDoc(userRef);

let balance=snap.data().balance;

await updateDoc(userRef,{
balance:balance+win
});

alert("KazandÄ±n: "+win.toFixed(2)+"â‚º");
}

createGrid();

</script>

</body>
</html>
