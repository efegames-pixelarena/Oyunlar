<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PixelArena - Mines</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;}
body{
background:
radial-gradient(circle at 20% 20%,#1f2b63 0%,transparent 40%),
radial-gradient(circle at 80% 80%,#16245c 0%,transparent 40%),
linear-gradient(180deg,#0b1023,#0d1333,#0a0f1f);
color:white;
min-height:100vh;
}

.top-bar{
position:fixed;
top:0;
width:100%;
height:55px;
display:flex;
align-items:center;
justify-content:space-between;
padding:0 16px;
background:linear-gradient(135deg,#1a2a6c,#16245c);
box-shadow:0 4px 15px rgba(0,0,0,0.45);
z-index:1000;
}

.brand{
font-size:18px;
font-weight:800;
background:linear-gradient(90deg,#4fd1ff,#fff,#4fd1ff);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
}

.balance-box{
background:#273c8f;
padding:6px 14px;
border-radius:14px;
font-weight:700;
font-size:13px;
}

.container{
max-width:520px;
margin:auto;
padding:90px 20px 20px;
text-align:center;
}

#grid{
display:grid;
grid-template-columns:repeat(5,1fr);
gap:8px;
margin-top:20px;
}

.tile{
background:#141b3f;
height:65px;
border-radius:12px;
display:flex;
align-items:center;
justify-content:center;
font-size:22px;
cursor:pointer;
border:1px solid #2a3577;
transition:0.2s;
}

.tile.open{background:#2ecc71}
.tile.mine{background:#e74c3c;animation:explode 0.4s ease;}

@keyframes explode{
0%{transform:scale(1)}
50%{transform:scale(1.4)}
100%{transform:scale(1)}
}

button{
padding:10px;
border-radius:10px;
border:none;
margin:5px;
font-weight:bold;
cursor:pointer;
}

.start{background:#3498db;color:white}
.start:disabled{background:#555;cursor:not-allowed}

.cashout{background:#f1c40f;color:black}
.cashout:disabled{background:#555;cursor:not-allowed}

input,select{
padding:10px;
border-radius:10px;
border:none;
margin:5px;
}
</style>
</head>
<body>

<div class="top-bar">
<div class="brand">PixelArena</div>
<div class="balance-box">Bakiye: <span id="userBalance">0â‚º</span></div>
</div>

<div class="container">

<h2>ðŸ’£ Mines</h2>

<input type="number" id="bet" placeholder="Bahis (Max 5000)" min="1" max="5000">

<select id="mineCount"></select>

<br>
<button id="startBtn" class="start">BaÅŸlat</button>
<button id="cashoutBtn" class="cashout" disabled>Cashout</button>

<h3>Ã‡arpan: <span id="multiplier">1x</span></h3>

<div id="grid"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,doc,onSnapshot,runTransaction } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
authDomain:"emirhan-site.firebaseapp.com",
projectId:"emirhan-site",
storageBucket:"emirhan-site.firebasestorage.app",
messagingSenderId:"668871888390",
appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let mines=[];
let opened=0;
let betAmount=0;
let mineTotal=3;
let gameActive=false;
let multiplier=1;

const grid=document.getElementById("grid");
const multiplierText=document.getElementById("multiplier");
const balanceText=document.getElementById("userBalance");
const startBtn=document.getElementById("startBtn");
const cashoutBtn=document.getElementById("cashoutBtn");
const mineSelect=document.getElementById("mineCount");

/* 1-24 MAYIN */
for(let i=1;i<=24;i++){
const option=document.createElement("option");
option.value=i;
option.text=i+" MayÄ±n";
mineSelect.appendChild(option);
}

function createGrid(){
grid.innerHTML="";
for(let i=0;i<25;i++){
const tile=document.createElement("div");
tile.classList.add("tile");
tile.addEventListener("click",()=>reveal(i,tile));
grid.appendChild(tile);
}
}

function generateMines(){
mines=[];
while(mines.length<mineTotal){
let r=Math.floor(Math.random()*25);
if(!mines.includes(r)) mines.push(r);
}
}

/* GERÃ‡EK RÄ°SK Ã‡ARPANI */
function updateMultiplier(){

const remainingSafe = 25 - mineTotal - (opened - 1);
const totalRemaining = 25 - (opened - 1);

multiplier *= totalRemaining / remainingSafe;

multiplier = Math.floor(multiplier * 100) / 100;

multiplierText.innerText = multiplier + "x";

const winAmount = Math.floor(betAmount * multiplier);
cashoutBtn.innerText = "Ã‡ek ("+winAmount+"â‚º)";
}

/* BAÅžLAT */
startBtn.addEventListener("click",async()=>{

if(!auth.currentUser) return;

betAmount=parseInt(document.getElementById("bet").value);
mineTotal=parseInt(mineSelect.value);

if(!betAmount||betAmount<=0||betAmount>5000) return;

const userRef=doc(db,"users",auth.currentUser.uid);

try{
await runTransaction(db,async(transaction)=>{
const snap=await transaction.get(userRef);
if(snap.data().balance<betAmount) throw "Yetersiz bakiye";
transaction.update(userRef,{balance:snap.data().balance-betAmount});
});
}catch(e){return;}

opened=0;
multiplier=1;

multiplierText.innerText="1x";
cashoutBtn.innerText="Ã‡ek (0â‚º)";

generateMines();
createGrid();
gameActive=true;

startBtn.disabled=true;
cashoutBtn.disabled=false;

});

/* AÃ‡MA */
function reveal(index,tile){

if(!gameActive||tile.classList.contains("open")) return;

if(mines.includes(index)){
tile.classList.add("mine");
tile.innerHTML="ðŸ’£";
gameActive=false;
startBtn.disabled=false;
cashoutBtn.disabled=true;
cashoutBtn.innerText="Cashout";
return;
}

opened++;
tile.classList.add("open");
tile.innerHTML="ðŸ’Ž";

updateMultiplier();
}

/* CASHOUT */
cashoutBtn.addEventListener("click",async()=>{

if(!gameActive||opened===0) return;

gameActive=false;

const win=Math.floor(betAmount*multiplier);

const userRef=doc(db,"users",auth.currentUser.uid);

await runTransaction(db,async(transaction)=>{
const snap=await transaction.get(userRef);
transaction.update(userRef,{balance:snap.data().balance+win});
});

startBtn.disabled=false;
cashoutBtn.disabled=true;
cashoutBtn.innerText="Cashout";
multiplierText.innerText="1x";

});

/* CANLI BAKÄ°YE */
onAuthStateChanged(auth,(user)=>{
if(user){
const userRef=doc(db,"users",user.uid);
onSnapshot(userRef,(snap)=>{
if(snap.exists()){
balanceText.innerText=parseInt(snap.data().balance)+"â‚º";
}
});
}
});

createGrid();

</script>
</body>
</html>
