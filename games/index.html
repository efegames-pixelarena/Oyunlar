<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PixelArena | Elite Gaming Platform</title>

<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
    --primary: #00f2ff;
    --accent: #ff007a;
    --bg-deep: #06080f;
    --card-bg: #111420;
    --border: rgba(255, 255, 255, 0.05);
    --text-glow: 0 0 10px rgba(0, 242, 255, 0.5);
    --success: #00ffa3;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
body { background: var(--bg-deep); color: #fff; font-family: 'Outfit', sans-serif; overflow-x: hidden; }

/* --- NAVBAR (TAŞMAYA KARŞI GÜVENLİ) --- */
.nav-bar {
    position: fixed; top: 0; width: 100%; height: 70px;
    background: rgba(6, 8, 15, 0.95); backdrop-filter: blur(15px);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 20px; z-index: 2000; border-bottom: 1px solid var(--border);
}

.brand {
    font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 22px;
    letter-spacing: 2px; color: var(--primary); text-shadow: var(--text-glow);
}

.user-engine { display: flex; align-items: center; gap: 12px; max-width: 60%; }

.wallet-box {
    background: rgba(255,255,255,0.03); border: 1px solid var(--border);
    padding: 6px 15px; border-radius: 50px; display: flex; align-items: center; gap: 8px;
    white-space: nowrap; overflow: hidden; /* Taşmayı önler */
}
.wallet-box b { 
    color: var(--success); font-family: monospace; font-size: 14px;
    overflow: hidden; text-overflow: ellipsis; max-width: 100px; 
}

.p-avatar { 
    width: 40px; height: 40px; border-radius: 12px; border: 2px solid var(--primary); 
    cursor: pointer; transition: 0.3s; object-fit: cover;
}
.p-avatar:hover { transform: scale(1.1); box-shadow: var(--text-glow); }

/* --- OYUN KARTLARI --- */
.main-content { margin-top: 90px; padding: 0 20px 100px; }
.section-header { 
    font-family: 'Rajdhani'; text-transform: uppercase; font-size: 14px; 
    color: var(--primary); letter-spacing: 3px; margin: 30px 0 15px;
    display: flex; align-items: center; gap: 10px;
}
.section-header::after { content:''; flex:1; height:1px; background: linear-gradient(90deg, var(--primary), transparent); }

.game-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 15px; }

.game-card {
    background: var(--card-bg); border-radius: 20px; padding: 25px 15px;
    text-align: center; border: 1px solid var(--border); position: relative;
    transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer;
}
.game-card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
.game-card i { font-size: 35px; color: var(--primary); margin-bottom: 12px; display: block; }
.game-card span { display: block; font-weight: 700; font-size: 15px; margin-bottom: 5px; }
.game-card .tag { font-size: 9px; opacity: 0.5; text-transform: uppercase; letter-spacing: 1px; }

/* --- MODAL SİSTEMİ --- */
.modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
    display: none; align-items: center; justify-content: center; z-index: 5000; padding: 20px;
}
.modal-window { 
    background: #0d111b; border: 1px solid var(--border); border-radius: 30px;
    width: 100%; max-width: 450px; padding: 30px; position: relative;
    max-height: 90vh; overflow-y: auto;
}

.modal-window h2 { font-family: 'Rajdhani'; color: var(--primary); margin-bottom: 20px; }
.form-group { text-align: left; margin-bottom: 15px; }
.form-group label { font-size: 11px; color: #555; margin-left: 10px; }
.form-group input { 
    width: 100%; background: #06080f; border: 1px solid var(--border);
    padding: 12px 15px; border-radius: 12px; color: #fff; outline: none; margin-top: 5px;
}
.form-group input:disabled { background: #111; color: #444; cursor: not-allowed; }

.btn-action {
    width: 100%; padding: 15px; border-radius: 12px; border: none;
    background: var(--primary); color: #000; font-weight: 800; cursor: pointer; margin-top: 10px;
}

/* --- ÇARK --- */
.wheel-container { position: relative; width: 280px; height: 280px; margin: 20px auto; }
#wheelImg { width: 100%; transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); }
.wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 40px; z-index: 10; }

/* --- PROMO --- */
.promo-error { color: var(--accent); font-size: 12px; margin-top: 5px; display: none; }

.dropdown-menu {
    position: absolute; top: 75px; right: 20px; width: 220px;
    background: #111420; border: 1px solid var(--border); border-radius: 20px;
    display: none; flex-direction: column; padding: 10px; z-index: 3000;
}
.dropdown-menu.active { display: flex; animation: slideIn 0.3s ease; }
.drop-link { padding: 12px; display: flex; align-items: center; gap: 10px; text-decoration: none; color: #aaa; font-size: 14px; border-radius: 10px; }
.drop-link:hover { background: rgba(255,255,255,0.05); color: #fff; }
.drop-link i { color: var(--primary); }

@keyframes slideIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

@media (max-width: 480px) {
    .game-grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>

<div class="nav-bar">
    <div class="brand">PIXELARENA</div>
    
    <div class="user-engine" id="guestPanel">
        <button onclick="openAuth('login')" style="background:none; border:none; color:#fff; cursor:pointer; font-weight:700;">GİRİŞ</button>
        <button onclick="openAuth('reg')" style="background:var(--primary); border:none; padding:8px 15px; border-radius:8px; font-weight:800; cursor:pointer;">KAYIT</button>
    </div>

    <div class="user-engine" id="userPanel" style="display:none;">
        <div class="wallet-box"><i class="fa-solid fa-coins" style="color:#ffd700"></i> <b id="uBalance">0 ₺</b></div>
        <img src="" class="p-avatar" id="avatarTrigger">
        
        <div class="dropdown-menu" id="userMenu">
            <a href="javascript:void(0)" class="drop-link" onclick="openModal('profileModal')"><i class="fa-solid fa-user-gear"></i> Profil Ayarları</a>
            <a href="javascript:void(0)" class="drop-link" onclick="openModal('wheelModal')"><i class="fa-solid fa-spinner"></i> Şans Çarkı</a>
            <a href="javascript:void(0)" class="drop-link" onclick="openModal('promoModal')"><i class="fa-solid fa-ticket"></i> Promo Kod</a>
            <a href="javascript:void(0)" class="drop-link" id="logoutBtn" style="color:var(--accent)"><i class="fa-solid fa-power-off"></i> Çıkış Yap</a>
        </div>
    </div>
</div>

<div class="main-content">
    <div class="section-header">Multiplayer Arena</div>
    <div class="game-grid">
        <div class="game-card" onclick="checkGo('duel.html')">
            <i class="fa-solid fa-hand-fist"></i>
            <span>Reflex Duel</span>
            <div class="tag">PVP Battle</div>
        </div>
        <div class="game-card" onclick="checkGo('neongrid.html')">
            <i class="fa-solid fa-square-rss"></i>
            <span>Grid Conquest</span>
            <div class="tag">Tactical PVP</div>
        </div>
    </div>

    <div class="section-header">Premium Slot & Casino</div>
    <div class="game-grid">
        <div class="game-card" onclick="checkGo('skycrash.html')">
            <i class="fa-solid fa-rocket"></i>
            <span>SkyCrash</span>
            <div class="tag">Multiplier</div>
        </div>
        <div class="game-card" onclick="checkGo('mines.html')">
            <i class="fa-solid fa-land-mine-on"></i>
            <span>Mines</span>
            <div class="tag">Risk & Reward</div>
        </div>
        <div class="game-card" onclick="checkGo('blackjack.html')">
            <i class="fa-solid fa-playing-cards"></i>
            <span>BlackJack</span>
            <div class="tag">Table Game</div>
        </div>
    </div>

    <div class="section-header">Arcade & Casual</div>
    <div class="game-grid">
        <div class="game-card" onclick="location.href='loops.html'">
            <i class="fa-solid fa-infinity"></i>
            <span>Loops</span>
            <div class="tag">Free Play</div>
        </div>
        <div class="game-card" onclick="location.href='snakepro.html'">
            <i class="fa-solid fa-snake"></i>
            <span>Snake Pro</span>
            <div class="tag">Arcade</div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="profileModal">
    <div class="modal-window">
        <h2>PROFİL AYARLARI</h2>
        <div class="form-group">
            <label>E-posta (Pasif)</label>
            <input type="text" id="pEmail" disabled>
        </div>
        <div class="form-group">
            <label>İsim Soyisim</label>
            <input type="text" id="pFullname" placeholder="Ad Soyad girin...">
        </div>
        <div class="form-group">
            <label>Kullanıcı Adı (Kalan Hak: <span id="uNameRight">1</span>)</label>
            <input type="text" id="pUsername">
        </div>
        <div class="form-group">
            <label>Avatar Seç (Kalan Hak: <span id="uAvRight">3</span>)</label>
            <div id="avList" style="display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:10px;"></div>
        </div>
        <button class="btn-action" onclick="saveProfile()">GÜNCELLE</button>
        <button onclick="closeModal('profileModal')" style="background:none; border:none; color:#555; width:100%; margin-top:15px; cursor:pointer;">Kapat</button>
    </div>
</div>

<div class="modal-overlay" id="wheelModal">
    <div class="modal-window" style="text-align:center;">
        <h2>ŞANS ÇARKINI ÇEVİR</h2>
        <div class="wheel-container">
            <img src="https://i.ibb.co/9H6S4xy/pointer.png" class="wheel-pointer">
            <img src="https://i.ibb.co/mRT80Pz/wheel.png" id="wheelImg">
        </div>
        <button class="btn-action" id="spinBtn" onclick="runWheel()">ÇEVİR (1 HAK)</button>
        <p onclick="closeModal('wheelModal')" style="margin-top:20px; cursor:pointer; opacity:0.5;">Kapat</p>
    </div>
</div>

<div class="modal-overlay" id="promoModal">
    <div class="modal-window">
        <h2>PROMO KOD AKTİVASYONU</h2>
        <div class="form-group">
            <input type="text" id="promoCode" placeholder="Kodunuzu buraya yazın..." style="text-align:center; text-transform:uppercase; font-weight:800; letter-spacing:2px;">
            <div id="promoError" class="promo-error">Geçersiz veya kullanılmış kod!</div>
        </div>
        <button class="btn-action" onclick="usePromo()">AKTİF ET</button>
        <p onclick="closeModal('promoModal')" style="margin-top:20px; text-align:center; cursor:pointer; opacity:0.5;">İptal</p>
    </div>
</div>

<div class="modal-overlay" id="authModal">
    <div class="modal-window">
        <h2 id="authT">Giriş Yap</h2>
        <div class="form-group"><input type="email" id="aEmail" placeholder="E-posta"></div>
        <div class="form-group"><input type="password" id="aPass" placeholder="Şifre"></div>
        <div class="form-group" id="userInp" style="display:none;"><input type="text" id="aUser" placeholder="Kullanıcı Adı"></div>
        <button class="btn-action" id="authBtn">DEVAM ET</button>
        <p id="authSwitch" style="margin-top:20px; text-align:center; font-size:13px; cursor:pointer;">Hesabın yok mu? <span style="color:var(--primary)">Kayıt Ol</span></p>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, onSnapshot, setDoc, updateDoc, getDoc, increment, collection, query, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
    authDomain:"emirhan-site.firebaseapp.com",
    projectId:"emirhan-site",
    storageBucket:"emirhan-site.firebasestorage.app",
    messagingSenderId:"668871888390",
    appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentU = null;
let selectedAv = "";
const avs = ["https://i.pravatar.cc/150?img=11", "https://i.pravatar.cc/150?img=12", "https://i.pravatar.cc/150?img=13", "https://i.pravatar.cc/150?img=14", "https://i.pravatar.cc/150?img=15", "https://i.pravatar.cc/150?img=16", "https://i.pravatar.cc/150?img=17", "https://i.pravatar.cc/150?img=18"];

// UI Yönlendirme
window.openModal = (id) => { document.getElementById(id).style.display = 'flex'; if(id === 'profileModal') loadAvs(); };
window.closeModal = (id) => document.getElementById(id).style.display = 'none';
document.getElementById('avatarTrigger').onclick = (e) => { e.stopPropagation(); document.getElementById('userMenu').classList.toggle('active'); };
window.onclick = () => document.getElementById('userMenu').classList.remove('active');

// Auth İşlemleri
let mode = "login";
window.openAuth = (m) => {
    mode = m;
    document.getElementById('authT').innerText = m === 'login' ? "Giriş Yap" : "Kayıt Ol";
    document.getElementById('userInp').style.display = m === 'login' ? 'none' : 'block';
    document.getElementById('authModal').style.display = 'flex';
};

document.getElementById('authSwitch').onclick = () => mode === 'login' ? openAuth('reg') : openAuth('login');

document.getElementById('authBtn').onclick = async () => {
    const e = document.getElementById('aEmail').value;
    const p = document.getElementById('aPass').value;
    const u = document.getElementById('aUser').value;
    try {
        if(mode === 'login') { await signInWithEmailAndPassword(auth, e, p); }
        else {
            const res = await createUserWithEmailAndPassword(auth, e, p);
            await setDoc(doc(db, "users", res.user.uid), { 
                username: u, balance: 500, avatar: avs[0], 
                uRight: 1, avRight: 3, nameFull: "", wheelLast: 0 
            });
        }
        closeModal('authModal');
    } catch(err) { alert("Hata: " + err.message); }
};

onAuthStateChanged(auth, user => {
    if(user) {
        document.getElementById('guestPanel').style.display = 'none';
        document.getElementById('userPanel').style.display = 'flex';
        onSnapshot(doc(db, "users", user.uid), s => {
            if(s.exists()){
                const d = s.data(); currentU = d;
                document.getElementById('uBalance').innerText = d.balance.toLocaleString() + " ₺";
                document.getElementById('pAvatar').src = d.avatar;
                document.getElementById('pEmail').value = user.email;
                document.getElementById('pUsername').value = d.username;
                document.getElementById('pFullname').value = d.nameFull;
                document.getElementById('uNameRight').innerText = d.uRight;
                document.getElementById('uAvRight').innerText = d.avRight;
                
                if(d.uRight <= 0) document.getElementById('pUsername').disabled = true;
                if(d.nameFull !== "") document.getElementById('pFullname').disabled = true;
            }
        });
    } else {
        document.getElementById('guestPanel').style.display = 'flex';
        document.getElementById('userPanel').style.display = 'none';
    }
});

document.getElementById('logoutBtn').onclick = () => signOut(auth);

// Profil Kaydet
window.saveProfile = async () => {
    const up = {};
    const newU = document.getElementById('pUsername').value;
    const newF = document.getElementById('pFullname').value;

    if(newU !== currentU.username && currentU.uRight > 0) { up.username = newU; up.uRight = 0; }
    if(newF !== "" && currentU.nameFull === "") { up.nameFull = newF; }
    if(selectedAv !== "" && selectedAv !== currentU.avatar && currentU.avRight > 0) { 
        up.avatar = selectedAv; 
        up.avRight = increment(-1); 
    }

    if(Object.keys(up).length > 0) {
        await updateDoc(doc(db, "users", auth.currentUser.uid), up);
        alert("Profil Güncellendi!");
        closeModal('profileModal');
    }
};

function loadAvs() {
    const container = document.getElementById('avList'); container.innerHTML = "";
    avs.forEach(url => {
        const img = document.createElement('img');
        img.src = url; img.style = "width:100%; border-radius:10px; cursor:pointer; border:2px solid transparent;";
        if(url === currentU.avatar) img.style.borderColor = "var(--primary)";
        img.onclick = () => {
            if(currentU.avRight <= 0) return alert("Avatar değişim hakkınız kalmadı!");
            document.querySelectorAll('#avList img').forEach(i => i.style.borderColor="transparent");
            img.style.borderColor = "var(--primary)";
            selectedAv = url;
        };
        container.appendChild(img);
    });
}

// Çark Sistemi
window.runWheel = async () => {
    const now = Date.now();
    if(now - currentU.wheelLast < 86400000) return alert("Günde sadece 1 kez çevirebilirsiniz!");
    
    const btn = document.getElementById('spinBtn'); btn.disabled = true;
    const deg = Math.floor(5000 + Math.random() * 5000);
    document.getElementById('wheelImg').style.transform = `rotate(${deg}deg)`;

    setTimeout(async () => {
        const win = [100, 500, 1000, 50, 250, 0][Math.floor(Math.random()*6)];
        await updateDoc(doc(db, "users", auth.currentUser.uid), { 
            balance: increment(win), wheelLast: now 
        });
        alert(win > 0 ? `TEBRİKLER! ${win} ₺ Kazandınız!` : "Maalesef bu sefer kazanamadınız.");
        btn.disabled = false;
        closeModal('wheelModal');
    }, 5500);
};

// Promo Kod
window.usePromo = async () => {
    const code = document.getElementById('promoCode').value.trim().toUpperCase();
    const err = document.getElementById('promoError');
    err.style.display = "none";

    if(!code) return;

    try {
        const q = query(collection(db, "promos"), where("code", "==", code));
        const snap = await getDocs(q);

        if(snap.empty) {
            err.innerText = "Hata: Geçersiz veya süresi dolmuş kod!";
            err.style.display = "block";
            return;
        }

        const promo = snap.docs[0];
        const data = promo.data();

        await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: increment(data.amount) });
        await deleteDoc(doc(db, "promos", promo.id)); // Tek kullanımlık

        alert(`BAŞARILI! ${data.amount} ₺ hesabınıza eklendi.`);
        closeModal('promoModal');
    } catch(e) {
        err.innerText = "Hata: Bir sorun oluştu.";
        err.style.display = "block";
    }
};

window.checkGo = (url) => {
    if(!auth.currentUser) openAuth('login');
    else location.href = url;
};
</script>

</body>
</html>
