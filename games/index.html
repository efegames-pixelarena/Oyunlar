<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PixelArena | Next-Gen Gaming</title>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Syncopate:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --primary: #00ffa3;
            --secondary: #dc143c;
            --accent: #00d4ff;
            --bg: #080a0f;
            --card-bg: rgba(255, 255, 255, 0.03);
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --text: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            background-image: 
                radial-gradient(circle at 20% 20%, rgba(0, 255, 163, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(220, 20, 60, 0.05) 0%, transparent 40%);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- ARKA PLAN EFEKTİ --- */
        #bg-glow {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; pointer-events: none;
        }

        /* --- MODERN NAVİGASYON --- */
        nav {
            position: fixed; top: 0; width: 100%; height: 80px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; background: rgba(8, 10, 15, 0.8);
            backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); z-index: 1000;
        }

        .logo {
            font-family: 'Syncopate', sans-serif; font-size: 22px; font-weight: 700;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
        }

        .nav-actions { display: flex; gap: 15px; align-items: center; }

        .btn {
            padding: 10px 24px; border-radius: 12px; font-weight: 600;
            cursor: pointer; transition: 0.3s; border: none; font-family: 'Outfit';
            display: flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: #000; box-shadow: 0 4px 15px rgba(0, 255, 163, 0.3); }
        .btn-outline { background: transparent; color: white; border: 1px solid var(--border); }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }

        /* --- KULLANICI PANELİ --- */
        .user-widget {
            display: none; align-items: center; gap: 15px;
            background: var(--glass); padding: 6px 6px 6px 18px;
            border-radius: 16px; border: 1px solid var(--border);
            position: relative; cursor: pointer;
        }
        .user-balance { font-weight: 800; color: var(--primary); font-size: 15px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 12px; object-fit: cover; border: 2px solid var(--primary); }

        /* --- HERO & ARAMA --- */
        .hero { padding: 120px 40px 40px; text-align: center; }
        .search-container {
            max-width: 600px; margin: 30px auto; position: relative;
        }
        .search-container i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--primary); }
        .search-container input {
            width: 100%; padding: 18px 20px 18px 55px; border-radius: 20px;
            background: var(--glass); border: 1px solid var(--border);
            color: white; font-size: 16px; outline: none; transition: 0.3s;
        }
        .search-container input:focus { border-color: var(--primary); background: rgba(255,255,255,0.08); }

        /* --- OYUN KARTLARI --- */
        .container { max-width: 1300px; margin: 0 auto; padding: 20px; }
        .section-header { 
            display: flex; align-items: center; gap: 15px; margin: 40px 0 25px;
            font-family: 'Syncopate'; font-size: 14px; color: var(--primary); opacity: 0.8;
        }
        .section-header::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, var(--border), transparent); }

        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .card {
            background: var(--card-bg); border: 1px solid var(--border);
            border-radius: 28px; padding: 30px; position: relative;
            transition: 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            overflow: hidden; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, transparent, rgba(255,255,255,0.05));
            pointer-events: none;
        }
        .card:hover {
            transform: translateY(-10px);
            background: rgba(255,255,255,0.06);
            border-color: var(--primary);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .card-icon {
            width: 70px; height: 70px; background: var(--glass);
            border-radius: 20px; display: flex; align-items: center; justify-content: center;
            font-size: 32px; color: var(--primary); margin-bottom: 20px;
            transition: 0.3s;
        }
        .card:hover .card-icon { transform: scale(1.1) rotate(5deg); background: var(--primary); color: #000; }

        .card-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; letter-spacing: -0.5px; }
        .card-tag { font-size: 12px; font-weight: 600; text-transform: uppercase; color: #94a3b8; }

        /* --- MODAL --- */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(15px); display: none; align-items: center;
            justify-content: center; z-index: 2000; padding: 20px;
        }
        .modal-content {
            background: #0f121a; border: 1px solid var(--border);
            width: 100%; max-width: 450px; border-radius: 32px; padding: 40px;
            position: relative; animation: modalIn 0.3s ease-out;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        .input-box {
            width: 100%; padding: 15px; background: var(--glass);
            border: 1px solid var(--border); border-radius: 14px;
            color: white; margin-bottom: 15px; outline: none; font-family: 'Outfit';
        }

        /* --- DROPDOWN --- */
        .dropdown {
            position: absolute; top: 100%; right: 0; width: 220px;
            background: #161b22; border: 1px solid var(--border);
            border-radius: 18px; margin-top: 10px; display: none;
            flex-direction: column; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .dropdown.active { display: flex; }
        .drop-item {
            padding: 15px 20px; display: flex; align-items: center; gap: 12px;
            color: #94a3b8; text-decoration: none; transition: 0.2s;
        }
        .drop-item:hover { background: var(--glass); color: white; }

        /* --- ÇARK --- */
        .wheel-box { position: relative; width: 300px; height: 300px; margin: 0 auto 30px; }
        #wheelCanvas { width: 100%; height: 100%; border-radius: 50%; border: 5px solid var(--border); }
        .wheel-pin {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            z-index: 10; width: 30px; filter: drop-shadow(0 0 10px var(--primary));
        }

        @media (max-width: 768px) {
            nav { padding: 0 20px; }
            .grid { grid-template-columns: 1fr 1fr; gap: 15px; }
            .hero { padding: 100px 20px 20px; }
            .card { padding: 20px; }
            .card-icon { width: 50px; height: 50px; font-size: 24px; }
        }
    </style>
</head>
<body>

<canvas id="bg-glow"></canvas>

<nav>
    <div class="logo">PIXELARENA</div>
    <div class="nav-actions">
        <button class="btn btn-outline" id="loginBtn">GİRİŞ</button>
        <button class="btn btn-primary" id="regBtn">KAYIT OL</button>

        <div class="user-widget" id="userPill">
            <span class="user-balance" id="userBalance">0 ₺</span>
            <img src="" class="user-avatar" id="avatarTrigger">
            <div class="dropdown" id="userDropdown">
                <a href="#" class="drop-item" onclick="openModal('profileModal')"><i class="fa-solid fa-circle-user"></i> Profilim</a>
                <a href="#" class="drop-item" onclick="openModal('wheelModal')"><i class="fa-solid fa-star"></i> Günlük Çark</a>
                <a href="#" class="drop-item" onclick="openModal('bonusModal')"><i class="fa-solid fa-ticket"></i> Promo Kod</a>
                <a href="#" class="drop-item" id="logoutBtn" style="color:var(--secondary)"><i class="fa-solid fa-power-off"></i> Çıkış Yap</a>
            </div>
        </div>
    </div>
</nav>

<div class="hero">
    <h1 style="font-size: clamp(24px, 5vw, 42px); font-weight: 800;">Sınırları <span style="color: var(--primary)">Zorla.</span></h1>
    <div class="search-container">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" id="searchInput" placeholder="Favori oyununu keşfet...">
    </div>
</div>

<div class="container">
    <div class="section-header">REKABETÇİ ARENA</div>
    <div class="grid" id="gamesList">
        <div class="card" data-name="reflex duel" onclick="checkLogin('duel.html')">
            <div class="card-icon"><i class="fa-solid fa-bolt"></i></div>
            <div class="card-title">Reflex Duel</div>
            <div class="card-tag">PVP • Online</div>
        </div>

        <div class="card" data-name="skycrash" onclick="checkLogin('skycrash.html')">
            <div class="card-icon"><i class="fa-solid fa-rocket"></i></div>
            <div class="card-title">SkyCrash</div>
            <div class="card-tag">Multiplier • Premium</div>
        </div>

        <div class="card" data-name="mines" onclick="checkLogin('mines.html')">
            <div class="card-icon"><i class="fa-solid fa-bomb"></i></div>
            <div class="card-title">Mines</div>
            <div class="card-tag">Strategy • Premium</div>
        </div>

        <div class="card" data-name="blackjack" onclick="checkLogin('blackjack.html')">
            <div class="card-icon"><i class="fa-solid fa-clover"></i></div>
            <div class="card-title">BlackJack</div>
            <div class="card-tag">Cards • Classic</div>
        </div>

        <div class="card" data-name="loops" onclick="location.href='loops.html'">
            <div class="card-icon"><i class="fa-solid fa-brain"></i></div>
            <div class="card-title">Loops</div>
            <div class="card-tag">Puzzle • Ücretsiz</div>
        </div>

        <div class="card" data-name="space pro" onclick="location.href='spacepro.html'">
            <div class="card-icon"><i class="fa-solid fa-shuttle-space"></i></div>
            <div class="card-title">Space Pro</div>
            <div class="card-tag">Arcade • Ücretsiz</div>
        </div>
    </div>
</div>

<div class="modal" id="authOverlay">
    <div class="modal-content">
        <h2 id="authTitle" style="margin-bottom:25px; font-family:'Syncopate'">GİRİŞ YAP</h2>
        <input type="email" id="authEmail" class="input-box" placeholder="E-posta">
        <input type="password" id="authPassword" class="input-box" placeholder="Şifre">
        <input type="text" id="authUsername" class="input-box" placeholder="Kullanıcı Adı" style="display:none;">
        <button class="btn btn-primary" id="authSubmit" style="width:100%; justify-content:center; padding:18px;">DEVAM ET</button>
        <p id="switchMode" style="text-align:center; margin-top:20px; font-size:14px; cursor:pointer; opacity:0.6;">Hesabın yok mu? Kayıt Ol</p>
    </div>
</div>

<div class="modal" id="wheelModal">
    <div class="modal-content" style="text-align:center;">
        <h2 style="font-family:'Syncopate'; margin-bottom:20px;">ŞANS ÇARKI</h2>
        <div class="wheel-box">
            <img src="https://cdn-icons-png.flaticon.com/512/3585/3585145.png" class="wheel-pin">
            <canvas id="wheelCanvas" width="500" height="500"></canvas>
        </div>
        <button class="btn btn-primary" id="spinBtn" onclick="spinWheel()" style="width:100%; justify-content:center;">ÇEVİR</button>
        <button class="btn btn-outline" onclick="closeModal('wheelModal')" style="width:100%; margin-top:10px; justify-content:center;">KAPAT</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, onSnapshot, setDoc, updateDoc, getDoc, increment, collection, query, where, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
    authDomain:"emirhan-site.firebaseapp.com",
    projectId:"emirhan-site",
    storageBucket:"emirhan-site.firebasestorage.app",
    messagingSenderId:"668871888390",
    appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const avatars = ["https://i.pravatar.cc/150?img=11", "https://i.pravatar.cc/150?img=32", "https://i.pravatar.cc/150?img=44", "https://i.pravatar.cc/150?img=52"];

// --- UI KONTROLLERİ ---
window.openModal = (id) => document.getElementById(id).style.display = 'flex';
window.closeModal = (id) => document.getElementById(id).style.display = 'none';

document.getElementById("avatarTrigger").onclick = (e) => {
    e.stopPropagation();
    document.getElementById("userDropdown").classList.toggle("active");
};

window.onclick = () => document.getElementById("userDropdown").classList.remove("active");

// --- ARAMA FİLTRESİ ---
document.getElementById('searchInput').addEventListener('input', (e) => {
    const term = e.target.value.toLowerCase();
    document.querySelectorAll('.card').forEach(card => {
        card.style.display = card.getAttribute('data-name').includes(term) ? 'flex' : 'none';
    });
});

// --- AUTH DURUMU ---
onAuthStateChanged(auth, user => {
    if(user) {
        document.getElementById("loginBtn").style.display="none"; 
        document.getElementById("regBtn").style.display="none";
        document.getElementById("userPill").style.display="flex";
        
        onSnapshot(doc(db, "users", user.uid), s => {
            if(s.exists()) {
                const data = s.data();
                document.getElementById("userBalance").innerText = data.balance.toLocaleString('tr-TR') + " ₺";
                document.getElementById("userAvatar").src = data.avatar || avatars[0];
            }
        });
    } else {
        document.getElementById("loginBtn").style.display="flex"; 
        document.getElementById("regBtn").style.display="flex";
        document.getElementById("userPill").style.display="none";
    }
});

// --- GİRİŞ / KAYIT ---
let isLogin = true;
document.getElementById("loginBtn").onclick = () => { isLogin=true; updateAuthUI(); openModal('authOverlay'); };
document.getElementById("regBtn").onclick = () => { isLogin=false; updateAuthUI(); openModal('authOverlay'); };
document.getElementById("switchMode").onclick = () => { isLogin = !isLogin; updateAuthUI(); };

function updateAuthUI() { 
    document.getElementById("authTitle").innerText = isLogin ? "GİRİŞ YAP" : "KAYIT OL"; 
    document.getElementById("authUsername").style.display = isLogin ? "none" : "block"; 
}

document.getElementById("authSubmit").onclick = async () => {
    const email = document.getElementById("authEmail").value;
    const pass = document.getElementById("authPassword").value;
    const userN = document.getElementById("authUsername").value;
    try {
        if(isLogin) { await signInWithEmailAndPassword(auth, email, pass); }
        else {
            const res = await createUserWithEmailAndPassword(auth, email, pass);
            await setDoc(doc(db, "users", res.user.uid), { 
                username: userN, balance: 500, lastSpin: 0, 
                nameChanges: 0, avatarChanges: 0, fullName: "", 
                avatar: avatars[0] 
            });
        }
        closeModal('authOverlay');
    } catch(e) { alert("Hata: " + e.message); }
};

document.getElementById("logoutBtn").onclick = () => signOut(auth);
window.checkLogin = (url) => { if(!auth.currentUser) openModal('authOverlay'); else location.href = url; };

// --- ÇARK SİSTEMİ (Modern Çizim) ---
const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");
const prizes = ["1000₺", "5000₺", "100₺", "2500₺", "500₺", "10.000₺", "250₺", "İFLAS"];
const colors = ["#00ffa3", "#080a0f", "#00d4ff", "#080a0f", "#00ffa3", "#080a0f", "#00d4ff", "#dc143c"];

function drawWheel() {
    const arc = Math.PI / (prizes.length / 2);
    ctx.clearRect(0,0,500,500);
    for (let i = 0; i < prizes.length; i++) {
        ctx.beginPath();
        ctx.fillStyle = colors[i];
        ctx.moveTo(250, 250);
        ctx.arc(250, 250, 240, i * arc, (i + 1) * arc);
        ctx.fill();
        ctx.save();
        ctx.translate(250, 250);
        ctx.rotate(i * arc + arc / 2);
        ctx.fillStyle = i % 2 === 0 ? "#000" : "#fff";
        ctx.font = "bold 22px Outfit";
        ctx.fillText(prizes[i], 120, 10);
        ctx.restore();
    }
}
drawWheel();

window.spinWheel = async () => {
    const user = auth.currentUser;
    const s = await getDoc(doc(db, "users", user.uid));
    const last = s.data().lastSpin || 0;
    if(Date.now() - last < 86400000) return alert("Yarın tekrar gel!");

    const deg = Math.floor(Math.random() * 360) + 3600;
    canvas.style.transition = "transform 5s cubic-bezier(0.1, 0, 0.1, 1)";
    canvas.style.transform = `rotate(${deg}deg)`;

    setTimeout(async () => {
        const actualDeg = deg % 360;
        const prizeIndex = Math.floor(((360 - actualDeg) % 360) / (360 / prizes.length));
        const prizeStr = prizes[prizeIndex];
        
        if(prizeStr !== "İFLAS") {
            const amount = parseInt(prizeStr.replace('.','').replace('₺',''));
            await updateDoc(doc(db, "users", user.uid), { balance: increment(amount), lastSpin: Date.now() });
            alert("Kazandın: " + prizeStr);
        } else {
            await updateDoc(doc(db, "users", user.uid), { balance: 0, lastSpin: Date.now() });
            alert("Maalesef İflas!");
        }
        closeModal('wheelModal');
    }, 5100);
};

// Arka Plan Glow Efekti
const bgCanvas = document.getElementById("bg-glow");
const bgCtx = bgCanvas.getContext("2d");
function resize() { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; }
window.onresize = resize; resize();

function animate() {
    bgCtx.clearRect(0,0,bgCanvas.width, bgCanvas.height);
    // Basit partikül veya ışık süzmesi eklenebilir
    requestAnimationFrame(animate);
}
animate();

</script>
</body>
</html>
