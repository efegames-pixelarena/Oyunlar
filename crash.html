<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>SkyCrash</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;background:#070b18;color:white;}
input{font-size:16px;}

.top-bar{
position:fixed;top:0;width:100%;height:55px;
display:flex;align-items:center;justify-content:space-between;
padding:0 12px;background:linear-gradient(135deg,#1a2a6c,#16245c);
z-index:100;
}

.right-menu{display:flex;gap:8px;}
.nav-box{padding:6px 12px;border-radius:16px;font-weight:700;font-size:13px;}
.balance-box{background:#273c8f;}
.bet-box{background:linear-gradient(90deg,#ff8a00,#ff5f00);color:#000;}

.history{
position:absolute;top:55px;width:100%;height:42px;
display:flex;align-items:center;gap:8px;
padding:0 12px;overflow-x:auto;background:#16245c;
}

.history span{
padding:5px 12px;border-radius:14px;font-size:12px;font-weight:800;
}

.main{
position:absolute;top:97px;bottom:150px;width:100%;
display:flex;flex-direction:column;align-items:center;justify-content:center;
}

.multiplier{font-size:65px;font-weight:bold;color:#00eaff;}
.status{margin-top:10px;font-size:16px;font-weight:700;color:#ff2a4d;}

.rocket{
position:absolute;
font-size:28px;
transform:translate(-50%,-50%);
pointer-events:none;
}

.bottom{
position:absolute;bottom:0;width:100%;height:150px;
background:#121833;display:flex;justify-content:center;align-items:center;gap:15px;
}

.betBox{
background:#1a2248;padding:12px;border-radius:10px;width:45%;max-width:200px;
display:flex;flex-direction:column;gap:6px;
}

.betBox input{
padding:8px;border:none;border-radius:6px;text-align:center;font-weight:bold;
}

.betBox button{
padding:10px;border:none;border-radius:6px;font-weight:bold;cursor:pointer;
background:#6c5ce7;color:white;
}

.cancel{background:#ff2a4d !important;}
.cashout{background:#00c853 !important;}
</style>
</head>
<body>

<div class="top-bar">
<div>SkyCrash</div>
<div class="right-menu">
<div class="nav-box balance-box">Bakiye: <span id="balance">0</span>â‚º</div>
<div class="nav-box bet-box">Bahis: <span id="bet">0</span>â‚º</div>
</div>
</div>

<div class="history" id="history"></div>

<div class="main" id="gameArea">
<div class="multiplier" id="multiplier">1.00x</div>
<div class="status" id="status"></div>
<div class="rocket" id="rocket">ðŸš€</div>
</div>

<div class="bottom">
<div class="betBox">
<input type="number" id="bet1" value="100">
<input type="number" id="auto1" placeholder="Auto X">
<button id="btn1">Bahis Yap</button>
</div>
<div class="betBox">
<input type="number" id="bet2" value="200">
<input type="number" id="auto2" placeholder="Auto X">
<button id="btn2">Bahis Yap</button>
</div>
</div>

<!-- SESLER (iOS uyumlu mp3) -->
<audio id="flySound" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-airplane-take-off-1740.mp3" loop></audio>
<audio id="explodeSound" preload="auto" src="https://assets.mixkit.co/sfx/preview/mixkit-explosion-impact-1684.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,doc,updateDoc,onSnapshot,setDoc,getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
authDomain:"emirhan-site.firebaseapp.com",
projectId:"emirhan-site",
storageBucket:"emirhan-site.firebasestorage.app",
messagingSenderId:"668871888390",
appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let balance=0,userRef=null;
let phase="betting";
let multiplier=1;
let crashPoint=0;
let animationId=null;
let startTime=0;
let countdownInterval=null;

let bet1=0,bet2=0,active1=false,active2=false;

const balanceEl=document.getElementById("balance");
const betEl=document.getElementById("bet");
const historyEl=document.getElementById("history");
const multiplierEl=document.getElementById("multiplier");
const statusEl=document.getElementById("status");
const rocket=document.getElementById("rocket");
const gameArea=document.getElementById("gameArea");

const flySound=document.getElementById("flySound");
const explodeSound=document.getElementById("explodeSound");

const btn1=document.getElementById("btn1");
const btn2=document.getElementById("btn2");

/* iOS SES UNLOCK */
document.body.addEventListener("click",()=>{
flySound.play().then(()=>flySound.pause()).catch(()=>{});
explodeSound.play().then(()=>explodeSound.pause()).catch(()=>{});
},{once:true});

onAuthStateChanged(auth,user=>{
if(!user){location.href="index.html";return;}
userRef=doc(db,"users",user.uid);
onSnapshot(userRef,snap=>{
if(!snap.exists()) return;
balance=Math.floor(snap.data().balance||0);
balanceEl.innerText=balance;
});
});

function updateTopBet(){
betEl.innerText=bet1+bet2;
}

function addHistory(val){
let span=document.createElement("span");
span.innerText=val.toFixed(2)+"x";
span.style.background=val<2?"#00bcd4":val<10?"#ff9800":"#ff2a4d";
historyEl.prepend(span);
if(historyEl.children.length>20)
historyEl.removeChild(historyEl.lastChild);
}

btn1.onclick=()=>handleBet(1);
btn2.onclick=()=>handleBet(2);

function handleBet(slot){
if(phase!=="betting") return;
let amount=parseInt(document.getElementById("bet"+slot).value);
if(!amount || amount<=0 || amount>balance) return;

balance-=amount;
updateDoc(userRef,{balance});

if(slot===1){bet1=amount;active1=true;}
if(slot===2){bet2=amount;active2=true;}

updateTopBet();
updateButton(slot,"cancel");
}

function updateButton(slot,type,value){
let btn=document.getElementById("btn"+slot);
if(type==="cancel"){
btn.innerText="Ä°ptal";
btn.className="cancel";
btn.onclick=()=>cancelBet(slot);
}
if(type==="cashout"){
btn.innerText="Ã‡ek "+Math.floor(value);
btn.className="cashout";
btn.onclick=()=>cashout(slot,value);
}
if(type==="reset"){
btn.innerText="Bahis Yap";
btn.className="";
btn.onclick=()=>handleBet(slot);
}
}

function cancelBet(slot){
if(phase!=="betting") return;
if(slot===1 && active1){balance+=bet1;bet1=0;active1=false;}
if(slot===2 && active2){balance+=bet2;bet2=0;active2=false;}
updateDoc(userRef,{balance});
updateTopBet();
updateButton(slot,"reset");
}

function cashout(slot,value){
if(phase!=="flying") return;
balance+=Math.floor(value);
updateDoc(userRef,{balance});
if(slot===1){active1=false;bet1=0;}
if(slot===2){active2=false;bet2=0;}
updateTopBet();
updateButton(slot,"reset");
}

function startRound(){
phase="betting";
multiplier=1;
multiplierEl.innerText="1.00x";
statusEl.innerText="";
rocket.style.display="none";
updateButton(1,"reset");
updateButton(2,"reset");
setTimeout(startFlight,2000);
}

function startFlight(){
phase="flying";
rocket.style.display="block";
crashPoint=(1/(1-Math.random()))*0.98;
startTime=performance.now();

flySound.currentTime=0;
flySound.volume=0.4;
flySound.play();

if(animationId) cancelAnimationFrame(animationId);
animationId=requestAnimationFrame(animate);
}

function animate(now){
let elapsed=(now-startTime)/1000;
multiplier = 1 + (Math.exp(elapsed*0.55)-1);
multiplierEl.innerText=multiplier.toFixed(2)+"x";

/* ROKET HAREKETÄ° */
let percent=Math.min(multiplier/crashPoint,1);
let x=percent*window.innerWidth;
let y=window.innerHeight-(percent*window.innerHeight*0.7);
rocket.style.left=x+"px";
rocket.style.top=y+"px";

if(active1) updateButton(1,"cashout",bet1*multiplier);
if(active2) updateButton(2,"cashout",bet2*multiplier);

if(multiplier>=crashPoint){crash();return;}
animationId=requestAnimationFrame(animate);
}

function crash(){
if(animationId) cancelAnimationFrame(animationId);
phase="crashed";

flySound.pause();
flySound.currentTime=0;

explodeSound.currentTime=0;
explodeSound.play();

multiplier=crashPoint;
multiplierEl.innerText=crashPoint.toFixed(2)+"x";

addHistory(crashPoint);

active1=false;active2=false;
bet1=0;bet2=0;
updateTopBet();
updateButton(1,"reset");
updateButton(2,"reset");

let timeLeft=5;
statusEl.innerText="Bahislerin KapanmasÄ±na : 5 Saniye";

countdownInterval=setInterval(()=>{
timeLeft--;
if(timeLeft>0){
statusEl.innerText="Bahislerin KapanmasÄ±na : "+timeLeft+" Saniye";
}else{
clearInterval(countdownInterval);
startRound(); // BEKLEME YOK
}
},1000);
}

startRound();
</script>
</body>
</html>
