<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SkyCrash</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#0b0f14;color:white}

/* HEADER */
.header{
height:60px;
background:#111418;
display:flex;
justify-content:space-between;
align-items:center;
padding:0 15px;
}
.headerLeft{
font-size:26px;
font-weight:bold;
color:#ff3b4d;
font-style:italic;
}
.balanceTop{color:#4caf50;font-weight:bold;font-size:18px;}

/* HISTORY */
.historyBar{
height:45px;
display:flex;
align-items:center;
padding:0 10px;
border-top:1px solid #1f2633;
border-bottom:1px solid #1f2633;
overflow:hidden;
}
.historyList{
display:flex;
gap:15px;
overflow-x:auto;
scrollbar-width:none;
}
.historyList::-webkit-scrollbar{display:none;}
.historyItem{font-weight:bold;font-size:18px;white-space:nowrap;}

/* CRASH AREA */
.crashContainer{
position:relative;
height:300px;
margin:15px;
border-radius:20px;
overflow:hidden;
background:radial-gradient(circle at center,#3a0066 0%,#0a0a0f 70%);
}
.multiplier{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:65px;
font-weight:bold;
}

/* BET SECTION */
.betSection{
display:flex;
gap:15px;
padding:15px;
}
.betCard{
flex:1;
background:linear-gradient(145deg,#181c24,#0e1015);
padding:15px;
border-radius:20px;
}
.betControl{
display:flex;
justify-content:space-between;
align-items:center;
background:#11151c;
padding:10px;
border-radius:15px;
margin-bottom:10px;
}
.betControl button{
background:#1b1f27;
border:none;
color:white;
font-size:20px;
width:45px;height:45px;
border-radius:50%;
}
.betInput{
width:100%;
text-align:center;
background:transparent;
border:none;
color:white;
font-size:22px;
font-weight:bold;
outline:none;
}
.quickAmounts{
display:grid;
grid-template-columns:repeat(4,1fr);
gap:8px;margin-bottom:12px;
}
.quickAmounts button{
background:#151922;
border:none;padding:8px;
border-radius:10px;color:#aaa;
}
.betButton{
width:100%;
background:#22b300;
color:white;
border:none;
padding:15px;
font-size:20px;
border-radius:15px;
}
.betButton.cashout{
background:#00eaff;
color:black;
}
</style>
</head>
<body>

<div class="header">
<div class="headerLeft">Aviator</div>
<div class="balanceTop"><span id="balanceTop">0</span> TRY</div>
</div>

<div class="historyBar">
<div class="historyList" id="historyList"></div>
</div>

<div class="crashContainer">
<div class="multiplier" id="multiplierDisplay">1.00x</div>
</div>

<div class="betSection">

<div class="betCard">
<div class="betControl">
<button onclick="changeBet(1,-50)">−</button>
<input type="number" id="bet1" class="betInput" value="100" min="0">
<button onclick="changeBet(1,100)">+</button>
</div>
<div class="quickAmounts">
<button onclick="setBet(1,1)">1</button>
<button onclick="setBet(1,2)">2</button>
<button onclick="setBet(1,5)">5</button>
<button onclick="setBet(1,10)">10</button>
</div>
<button class="betButton" id="betBtn1">Bahis</button>
</div>

<div class="betCard">
<div class="betControl">
<button onclick="changeBet(2,-50)">−</button>
<input type="number" id="bet2" class="betInput" value="100" min="0">
<button onclick="changeBet(2,100)">+</button>
</div>
<div class="quickAmounts">
<button onclick="setBet(2,1)">1</button>
<button onclick="setBet(2,2)">2</button>
<button onclick="setBet(2,5)">5</button>
<button onclick="setBet(2,10)">10</button>
</div>
<button class="betButton" id="betBtn2">Bahis</button>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,doc,updateDoc,onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
authDomain:"emirhan-site.firebaseapp.com",
projectId:"emirhan-site",
storageBucket:"emirhan-site.firebasestorage.app",
messagingSenderId:"668871888390",
appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let userRef=null;
let balance=0;
let authReady=false;

onAuthStateChanged(auth,user=>{
if(!user) return;
userRef=doc(db,"users",user.uid);
authReady=true;
onSnapshot(userRef,snap=>{
if(snap.exists()){
balance=snap.data().balance||0;
document.getElementById("balanceTop").innerText=Math.round(balance);
}
});
});

async function updateBalance(val){
if(!userRef) return;
await updateDoc(userRef,{balance:Math.round(val)});
}

/* GAME */
let multiplier=1;
let crashPoint=0;
let phase="betting";
let animation;
let activeBets={1:null,2:null};

function getSpeedRate(mult){
if(mult < 5) return 4;
if(mult < 15) return 6;
if(mult < 50) return 9;
return 9;
}

function startRound(){
phase="betting";
multiplier=1;
document.getElementById("multiplierDisplay").innerText="1.00x";
crashPoint=(1/(1-Math.random()))*0.97;
activeBets={1:null,2:null};
resetButtons();
setTimeout(startFlight,5000);
}

function startFlight(){
phase="flying";
animate();
}

function animate(){
let rate=getSpeedRate(multiplier);
multiplier+=multiplier*(rate/100);
document.getElementById("multiplierDisplay").innerText=
multiplier.toFixed(2)+"x";
if(multiplier>=crashPoint){triggerCrash();return;}
animation=requestAnimationFrame(animate);
}

function triggerCrash(){
cancelAnimationFrame(animation);
addHistory(multiplier);
phase="crashed";
resetButtons();
setTimeout(startRound,3000);
}

function addHistory(val){
let item=document.createElement("div");
item.className="historyItem";
item.innerText=val.toFixed(2)+"x";
if(val<2)item.style.color="#4da6ff";
else if(val<10)item.style.color="#b266ff";
else item.style.color="#ff4d94";
let list=document.getElementById("historyList");
list.prepend(item);
if(list.children.length>15) list.removeChild(list.lastChild);
}

/* BET FUNCTIONS */
function changeBet(i,amount){
let input=document.getElementById("bet"+i);
let val=parseInt(input.value)||0;
val+=amount;
if(val<0) val=0;
input.value=val;
}

function setBet(i,value){
document.getElementById("bet"+i).value=value;
}

function resetButtons(){
[1,2].forEach(i=>{
let btn=document.getElementById("betBtn"+i);
btn.classList.remove("cashout");
btn.innerText="Bahis";
});
}

document.getElementById("betBtn1").onclick=()=>handleBet(1);
document.getElementById("betBtn2").onclick=()=>handleBet(2);

async function handleBet(i){
if(!authReady) return;

let amt=parseInt(document.getElementById("bet"+i).value)||0;

if(phase==="betting"){
if(balance<amt || amt<=0) return;
balance-=amt;
await updateBalance(balance);
activeBets[i]=amt;
let btn=document.getElementById("betBtn"+i);
btn.classList.add("cashout");
btn.innerText="Cashout";
}
else if(phase==="flying" && activeBets[i]){
let payout=activeBets[i]*multiplier;
balance+=payout;
await updateBalance(balance);
activeBets[i]=null;
let btn=document.getElementById("betBtn"+i);
btn.classList.remove("cashout");
btn.innerText="Bahis";
}
}

startRound();
</script>
</body>
</html>
