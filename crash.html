<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyCrash V1</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
html,body{height:100%;overflow:hidden;background:#070b18;}
body{display:flex;flex-direction:column;height:100dvh;}

.top{
height:90px;
background:linear-gradient(180deg,#1b2247,#0e1330);
display:flex;
justify-content:space-between;
align-items:flex-start;
padding:15px 20px 0 20px;
border-bottom:1px solid #2a356b;
position:relative;
}

.logo{font-size:20px;font-weight:bold;color:#fff;letter-spacing:2px;}

.balanceBox{
background:rgba(255,255,255,0.05);
padding:6px 14px;
border-radius:20px;
border:1px solid rgba(0,255,255,0.3);
color:#00eaff;
font-weight:bold;
box-shadow:0 0 12px rgba(0,255,255,0.5);
}

.historyBar{
position:absolute;
bottom:8px;
left:0;
width:100%;
display:flex;
gap:10px;
padding:0 15px;
font-size:13px;
}

.historyItem{
padding:3px 8px;
border-radius:10px;
background:rgba(0,255,200,0.1);
color:#00eaff;
}

.historyCrash{
background:rgba(255,0,60,0.2);
color:#ff2a4d;
}

.main{flex:1;position:relative;overflow:hidden;}

.graphArea{
width:100%;
height:100%;
position:relative;
background:radial-gradient(circle at center,#16204a,#070b18 70%);
}

.multiplier{
position:absolute;
top:45%;
left:50%;
transform:translate(-50%,-50%);
font-size:70px;
font-weight:bold;
color:#00eaff;
text-shadow:0 0 25px #00eaff;
}

.plane{
position:absolute;
width:40px;
height:40px;
fill:#00eaff;
}

.fakeLiveBar{
position:absolute;
bottom:15px;
left:0;
width:100%;
display:flex;
justify-content:center;
pointer-events:none;
}

.fakeTrack{
display:flex;
gap:10px;
overflow:hidden;
max-width:90%;
}

.fakeItem{
background:rgba(0,255,200,0.12);
color:#00ffcc;
padding:6px 12px;
border-radius:20px;
white-space:nowrap;
animation:fadeIn 0.25s ease;
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(5px)}
to{opacity:1;transform:translateY(0)}
}

.bottom{
height:130px;
background:#121833;
display:flex;
justify-content:center;
align-items:center;
gap:15px;
}

.betBox{
background:#1a2248;
padding:12px;
border-radius:10px;
width:45%;
max-width:200px;
display:flex;
flex-direction:column;
gap:6px;
}

.betBox input{
padding:8px;
border:none;
border-radius:6px;
text-align:center;
font-weight:bold;
}

.betBox button{
padding:10px;
border:none;
border-radius:6px;
font-weight:bold;
cursor:pointer;
background:#6c5ce7;
color:white;
}

.cancel{background:#ff2a4d !important;}
.cashout{background:#00eaff !important;color:#000 !important;}

.crashScreen{
position:absolute;
inset:0;
background:black;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
z-index:20;
opacity:0;
pointer-events:none;
transition:0.3s;
}

.crashScreen.active{
opacity:1;
pointer-events:auto;
}

.crashTitle{color:white;font-size:28px;margin-bottom:15px;}
.crashValue{color:#ff0000;font-size:90px;font-weight:bold;}
.countdown{margin-top:20px;color:white;font-size:22px;}
</style>
</head>
<body>

<div class="top">
<div class="logo">SKYCRASH</div>
<div class="balanceBox">Bakiye: <span id="balance">0</span> TRY</div>
<div class="historyBar" id="historyBar"></div>
</div>

<div class="main">
<div class="graphArea">
<div class="multiplier" id="multiplier">1.00x</div>

<svg class="plane" id="plane" viewBox="0 0 24 24">
<path d="M2 16l20-5-20-5v4l15 1-15 1z"/>
</svg>

<div class="fakeLiveBar">
<div class="fakeTrack" id="fakeTrack"></div>
</div>

</div>

<div class="crashScreen" id="crashScreen">
<div class="crashTitle">CRASH!</div>
<div class="crashValue" id="crashValue">2.00x</div>
<div class="countdown" id="countdown"></div>
</div>
</div>

<div class="bottom">
<div class="betBox">
<input type="number" id="bet1" value="100">
<button id="btn1">Bahis Yap</button>
</div>
<div class="betBox">
<input type="number" id="bet2" value="200">
<button id="btn2">Bahis Yap</button>
</div>
</div>

<!-- FIREBASE ENTEGRASYONU -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
  authDomain: "emirhan-site.firebaseapp.com",
  projectId: "emirhan-site",
  storageBucket: "emirhan-site.firebasestorage.app",
  messagingSenderId: "668871888390",
  appId: "1:668871888390:web:76568bda84cb1641f7bd87",
  measurementId: "G-96ZVZX3DWH"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser=null;
let balance=0;

function updateBalance(){
document.getElementById("balance").innerText=balance.toFixed(2);
if(currentUser){
updateDoc(doc(db,"users",currentUser.uid),{balance:balance});
}
}

onAuthStateChanged(auth,(user)=>{
if(user){
currentUser=user;
onSnapshot(doc(db,"users",user.uid),(snap)=>{
if(snap.exists()){
balance=snap.data().balance;
document.getElementById("balance").innerText=balance.toFixed(2);
}
});
}
});
</script>

<!-- OYUN SCRIPTİ -->
<script>
/* BURADA OYUNUN TÜM ORİJİNAL JS KODU AYNEN DEVAM EDİYOR */
/* SADECE let balance=10000; KALDIRILDI */

let phase="betting";
let multiplier=1;
let crashPoint=0;
let animation;
let history=[];
let lastTime=0;

let bet1=0, bet2=0;
let active1=false, active2=false;
let cashed1=false, cashed2=false;
let currentWin1=0, currentWin2=0;

const plane=document.getElementById("plane");
const crashScreen=document.getElementById("crashScreen");
const crashValue=document.getElementById("crashValue");
const countdown=document.getElementById("countdown");

  function updateBalance(){
document.getElementById("balance").innerText=balance.toFixed(2);
}

function addHistory(x){
history.unshift(x.toFixed(2));
if(history.length>12) history.pop();
const bar=document.getElementById("historyBar");
bar.innerHTML="";
history.forEach(v=>{
let span=document.createElement("span");
span.className="historyItem";
if(v<2) span.classList.add("historyCrash");
span.innerText=v+"x";
bar.appendChild(span);
});
}

function resetButtons(){
["btn1","btn2"].forEach(id=>{
let b=document.getElementById(id);
b.disabled=false;
b.innerText="Bahis Yap";
b.classList.remove("cancel","cashout");
});
}

function startRoundCountdown(){
phase="betting";
generateFakePlayers();
let time=5;
countdown.innerText="Yeni tur: "+time;
crashScreen.classList.add("active");
resetButtons();
active1=false;
active2=false;

let interval=setInterval(()=>{
time--;
countdown.innerText="Yeni tur: "+time;
if(time<=0){
clearInterval(interval);
crashScreen.classList.remove("active");
startFlight();
}
},1000);
}

function startFlight(){
phase="flying";
multiplier=1;
cashed1=false; cashed2=false;
currentWin1=0; currentWin2=0;
lastTime=performance.now();
crashPoint=(1/(1-Math.random()))*0.97;

if(active1){
let b=document.getElementById("btn1");
b.innerText="Çek";
b.classList.add("cashout");
}
if(active2){
let b=document.getElementById("btn2");
b.innerText="Çek";
b.classList.add("cashout");
}

animate(performance.now());
}

function animate(timestamp){
let delta=(timestamp-lastTime)/1000;
lastTime=timestamp;

let speed= multiplier<2?0.07: multiplier<5?0.1:0.15;
multiplier+=speed*delta*multiplier;

document.getElementById("multiplier").innerText=multiplier.toFixed(2)+"x";
movePlane(multiplier);
updateFakePlayers(multiplier);

if(active1 && !cashed1){
currentWin1 = bet1 * multiplier;
document.getElementById("btn1").innerText="Çek ("+currentWin1.toFixed(2)+")";
}

if(active2 && !cashed2){
currentWin2 = bet2 * multiplier;
document.getElementById("btn2").innerText="Çek ("+currentWin2.toFixed(2)+")";
}

if(multiplier>=crashPoint){
triggerCrash();
return;
}

animation=requestAnimationFrame(animate);
}

function movePlane(m){
let screenH=window.innerHeight-220;
let maxHeight=screenH*0.6;
let y=screenH-(m*40);
if(y<maxHeight) y=maxHeight;
let x=Math.min(window.innerWidth-60,m*60);
plane.style.left=x+"px";
plane.style.top=y+"px";
}

function triggerCrash(){
cancelAnimationFrame(animation);
phase="crashed";
addHistory(multiplier);
crashValue.innerText=multiplier.toFixed(2)+"x";
crashScreen.classList.add("active");
active1=false;
active2=false;

setTimeout(()=>{
startRoundCountdown();
},2000);
}

function handleBet(btnId, betInputId, index){
let btn=document.getElementById(btnId);
let betInput=document.getElementById(betInputId);

btn.onclick=function(){
if(phase==="betting"){
let amount=parseFloat(betInput.value);
if(amount<=0 || balance<amount) return;

if(index===1 && !active1){
bet1=amount; balance-=amount; active1=true;
btn.innerText="İptal Et";
btn.classList.add("cancel");
}
else if(index===2 && !active2){
bet2=amount; balance-=amount; active2=true;
btn.innerText="İptal Et";
btn.classList.add("cancel");
}
else{
balance+= index===1?bet1:bet2;
if(index===1) active1=false; else active2=false;
btn.innerText="Bahis Yap";
btn.classList.remove("cancel");
}
updateBalance();
}
else if(phase==="flying"){
if(index===1 && active1 && !cashed1){
balance+=currentWin1;
cashed1=true; active1=false;
btn.disabled=true;
}
if(index===2 && active2 && !cashed2){
balance+=currentWin2;
cashed2=true; active2=false;
btn.disabled=true;
}
updateBalance();
}
};
}

handleBet("btn1","bet1",1);
handleBet("btn2","bet2",2);

updateBalance();
startRoundCountdown();
</script>

</body>
</html>
