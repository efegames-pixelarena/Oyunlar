<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyCrash</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#0b0f14;color:white}

/* HEADER */
.header{
height:60px;
background:#111418;
display:flex;
justify-content:space-between;
align-items:center;
padding:0 15px;
}
.headerLeft{
font-size:26px;
font-weight:bold;
color:#ff3b4d;
font-style:italic;
}
.balanceTop{color:#4caf50;font-weight:bold;font-size:18px;}

/* HISTORY */
.historyBar{
height:45px;
display:flex;
align-items:center;
padding:0 10px;
border-top:1px solid #1f2633;
border-bottom:1px solid #1f2633;
overflow:hidden;
}
.historyList{
display:flex;
gap:15px;
overflow-x:auto;
scrollbar-width:none;
}
.historyList::-webkit-scrollbar{display:none;}
.historyItem{font-weight:bold;font-size:18px;white-space:nowrap;}

/* CRASH AREA */
.crashContainer{
position:relative;
height:300px;
margin:15px;
border-radius:20px;
overflow:hidden;
background:radial-gradient(circle at center,#3a0066 0%,#0a0a0f 70%);
}

.multiplier{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:65px;
font-weight:bold;
}

.plane{
position:absolute;
bottom:20px;
left:0;
font-size:40px;
transition:transform .05s linear;
}

.redCurve{
position:absolute;
bottom:0;
left:0;
height:100%;
width:0%;
background:linear-gradient(to top right,#ff0022,#ff3355);
opacity:.3;
}

/* CRASH MESSAGE */
.crashMessage{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
text-align:center;
display:none;
}
.crashMessage h1{font-size:48px;color:#ff3b4d;}
.crashMessage p{margin-top:10px;font-size:22px;}

/* BET SECTION */
.betSection{
display:flex;
gap:15px;
padding:15px;
}
.betCard{
flex:1;
background:linear-gradient(145deg,#181c24,#0e1015);
padding:15px;
border-radius:20px;
}
.betControl{
display:flex;
justify-content:space-between;
align-items:center;
background:#11151c;
padding:10px;
border-radius:15px;
margin-bottom:10px;
}
.betControl button{
background:#1b1f27;
border:none;
color:white;
font-size:18px;
width:40px;height:40px;
border-radius:50%;
}
.betAmount{font-size:22px;font-weight:bold;}
.betButton{
width:100%;
background:#22b300;
color:white;
border:none;
padding:15px;
font-size:20px;
border-radius:15px;
}
.betButton.cashout{
background:#00eaff;
color:black;
}
</style>
</head>
<body>

<div class="header">
<div class="headerLeft">Aviator</div>
<div class="balanceTop"><span id="balanceTop">0</span> TRY</div>
</div>

<div class="historyBar">
<div class="historyList" id="historyList"></div>
</div>

<div class="crashContainer">
<div class="multiplier" id="multiplierDisplay">1.00x</div>
<div class="plane" id="plane">✈️</div>
<div class="redCurve" id="redCurve"></div>

<div class="crashMessage" id="crashMessage">
<h1>UZAKLAŞ !!</h1>
<p id="crashX"></p>
<p>Bahislerin Kapanmasına 5sn</p>
</div>
</div>

<div class="betSection">
<div class="betCard">
<div class="betControl">
<button onclick="changeBet(-1)">−</button>
<div class="betAmount" id="betDisplay">1.00</div>
<button onclick="changeBet(1)">+</button>
</div>
<button class="betButton" id="betBtn">Bahis Yap</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,doc,updateDoc,onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
authDomain:"emirhan-site.firebaseapp.com",
projectId:"emirhan-site",
storageBucket:"emirhan-site.firebasestorage.app",
messagingSenderId:"668871888390",
appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let userRef=null;
let balance=0;
let bet=1;
let hasBet=false;
let cashedOut=false;

onAuthStateChanged(auth,user=>{
if(!user) return;
userRef=doc(db,"users",user.uid);
onSnapshot(userRef,snap=>{
if(snap.exists()){
balance=snap.data().balance||0;
document.getElementById("balanceTop").innerText=Math.round(balance);
}
});
});

async function updateBalance(val){
if(!userRef) return;
await updateDoc(userRef,{balance:Math.round(val)});
}

/* GAME */
let multiplier=1;
let crashPoint=0;
let phase="betting";
let animation;

function startRound(){
phase="betting";
multiplier=1;
hasBet=false;
cashedOut=false;
document.getElementById("betBtn").innerText="Bahis Yap";
document.getElementById("betBtn").classList.remove("cashout");
document.getElementById("multiplierDisplay").innerText="1.00x";
document.getElementById("plane").style.transform="translate(0,0)";
document.getElementById("redCurve").style.width="0%";
document.getElementById("crashMessage").style.display="none";
crashPoint=(1/(1-Math.random()))*0.97;
setTimeout(startFlight,5000);
}

function startFlight(){
phase="flying";
animate();
}

function animate(){
multiplier+=multiplier*0.01; // %1 hız
updateVisual();
if(multiplier>=crashPoint){triggerCrash();return;}
animation=requestAnimationFrame(animate);
}

function updateVisual(){
document.getElementById("multiplierDisplay").innerText=multiplier.toFixed(2)+"x";
let percent=Math.min(multiplier*5,100);
document.getElementById("redCurve").style.width=percent+"%";
document.getElementById("plane").style.transform=
"translate("+percent*3+"px,-"+percent*1.5+"px)";
}

function triggerCrash(){
cancelAnimationFrame(animation);
phase="crashed";
document.getElementById("crashMessage").style.display="block";
document.getElementById("crashX").innerText=multiplier.toFixed(2)+"x";
addHistory(multiplier);
setTimeout(startRound,5000);
}

function addHistory(val){
let item=document.createElement("div");
item.className="historyItem";
item.innerText=val.toFixed(2)+"x";
if(val<2)item.style.color="#4da6ff";
else if(val<10)item.style.color="#b266ff";
else item.style.color="#ff4d94";
let list=document.getElementById("historyList");
list.prepend(item);
if(list.children.length>15) list.removeChild(list.lastChild);
}

/* BET */
function changeBet(v){
bet=Math.max(0.1,bet+v);
document.getElementById("betDisplay").innerText=bet.toFixed(2);
}

document.getElementById("betBtn").onclick=async()=>{
if(phase==="betting" && !hasBet){
if(balance<bet) return;
balance-=bet;
await updateBalance(balance);
hasBet=true;
document.getElementById("betBtn").innerText="İptal";
}
else if(phase==="betting" && hasBet){
balance+=bet;
await updateBalance(balance);
hasBet=false;
document.getElementById("betBtn").innerText="Bahis Yap";
}
else if(phase==="flying" && hasBet && !cashedOut){
let payout=bet*multiplier;
balance+=payout;
await updateBalance(balance);
cashedOut=true;
document.getElementById("betBtn").innerText="Çekildi";
}
};

startRound();
</script>
</body>
</html>
