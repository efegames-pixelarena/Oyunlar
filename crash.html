<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,
initial-scale=1,
maximum-scale=1,
minimum-scale=1,
user-scalable=no">
<title>SkyCrash</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
html,body{height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;background:#070b18;color:white;}

.top-bar{
position:fixed;top:0;width:100%;height:55px;
display:flex;align-items:center;justify-content:space-between;
padding:0 16px;
background:linear-gradient(135deg,#1a2a6c,#16245c);
box-shadow:0 4px 15px rgba(0,0,0,0.45);
z-index:100;
}

.brand{
font-size:18px;font-weight:800;
background:linear-gradient(90deg,#4fd1ff,#fff,#4fd1ff);
background-size:200% auto;
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
animation:shine 3s linear infinite;
}

@keyframes shine{to{background-position:200% center;}}

.right-menu{display:flex;gap:10px;}
.nav-box{padding:6px 14px;border-radius:14px;font-weight:700;font-size:13px;min-width:95px;text-align:center;}
.balance-box{background:#273c8f;}
.bet-box{background:linear-gradient(90deg,#ff8a00,#ff5f00);color:#000;}

.history{
position:absolute;top:55px;width:100%;height:42px;
display:flex;align-items:center;gap:8px;
padding:0 12px;overflow-x:auto;background:#16245c;
}
.history span{padding:5px 12px;border-radius:14px;font-size:12px;font-weight:800;white-space:nowrap;}

.main{position:absolute;top:97px;bottom:170px;width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;}
canvas{position:absolute;width:100%;height:100%;left:0;top:0;}

.multiplier{
position:relative;font-weight:800;z-index:2;
background:linear-gradient(90deg,#4fd1ff,#fff,#4fd1ff);
background-size:200% auto;
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
animation:shine 3s linear infinite;
}
.multiplier.big{font-size:65px;}
.multiplier.small{font-size:28px;}

.bottom{
position:absolute;bottom:0;width:100%;height:170px;
background:#121833;display:flex;justify-content:center;align-items:center;gap:20px;
}

.betBox{
background:#1a2248;
padding:18px;
border-radius:12px;
width:48%;
max-width:240px;
display:flex;
flex-direction:column;
gap:10px;
}

.betBox input{
padding:12px;
border:none;
border-radius:8px;
text-align:center;
font-weight:bold;
font-size:16px;
}

.betBox button{
padding:14px;
border:none;
border-radius:8px;
font-weight:bold;
font-size:15px;
cursor:pointer;
background:#6c5ce7;
color:white;
transition:0.2s;
}
.betBox button:active{transform:scale(0.97);}
.cancel{background:#ff2a4d !important;}
.cashout{background:#00c853 !important;}
</style>
</head>
<body>

<div class="top-bar">
<div class="brand">SkyCrash</div>
<div class="right-menu">
<div class="nav-box balance-box">Bakiye: <span id="balance">0</span>₺</div>
<div class="nav-box bet-box">Bahis: <span id="bet">0</span>₺</div>
</div>
</div>

<div class="history" id="history"></div>

<div class="main">
<canvas id="graph"></canvas>
<div class="multiplier small" id="multiplier">Uçuşa 5 Saniye</div>
</div>

<div class="bottom">
<div class="betBox">
<input type="number" id="bet1" value="100" min="1" max="5000">
<button id="btn1">Bahis Yap</button>
</div>
<div class="betBox">
<input type="number" id="bet2" value="200" min="1" max="5000">
<button id="btn2">Bahis Yap</button>
</div>
</div>

<script type="module">

/* ===== CANVAS ===== */
const canvas=document.getElementById("graph");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;}
window.addEventListener("resize",resize);resize();

/* ===== SESLER ===== */
let audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function tone(f,d,t="sine",v=0.2){
let o=audioCtx.createOscillator();
let g=audioCtx.createGain();
o.type=t;o.frequency.value=f;
o.connect(g);g.connect(audioCtx.destination);
g.gain.value=v;o.start();
o.stop(audioCtx.currentTime+d/1000);
}
function soundCrash(){tone(80,600,"sawtooth",0.5);}
function soundCash(){tone(1200,150,"triangle",0.3);}
function soundTick(){tone(900,100,"square",0.2);}

/* ===== FIREBASE ORİJİNAL ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,doc,onSnapshot,updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
authDomain:"emirhan-site.firebaseapp.com",
projectId:"emirhan-site",
storageBucket:"emirhan-site.firebasestorage.app",
messagingSenderId:"668871888390",
appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let userRef=null;
let balance=0;

onAuthStateChanged(auth,user=>{
if(user){
userRef=doc(db,"users",user.uid);
onSnapshot(userRef,snap=>{
if(snap.exists()){
balance=snap.data().balance||0;
updateUI();
}
});
}
});

/* ===== OYUN ===== */
let phase="betting";
let multiplier=1;
let crashPoint=0;
let animationId;
let activeBet1=0;
let activeBet2=0;

let rocketX=0,rocketY=0,rocketCrash=false,fallSpeed=0;

const multiplierEl=document.getElementById("multiplier");

/* ===== HISTORY ===== */
function addHistory(val){
let span=document.createElement("span");
span.innerText=val.toFixed(2)+"x";
span.style.background=val<2?"#ff2a4d":"#00c853";
document.getElementById("history").prepend(span);
}

/* ===== ROKET ===== */
function drawRocket(){
let progress=Math.min(multiplier/10,1);
rocketX=progress*canvas.width;
rocketY=canvas.height-(Math.log(multiplier+1)/Math.log(11))*canvas.height;

if(rocketCrash){fallSpeed+=0.4;rocketY+=fallSpeed;}

ctx.beginPath();
ctx.arc(rocketX,rocketY,8,0,Math.PI*2);
ctx.fillStyle="white";
ctx.fill();

if(rocketCrash){
ctx.beginPath();
ctx.arc(rocketX,rocketY,30,0,Math.PI*2);
ctx.fillStyle="rgba(255,0,0,0.4)";
ctx.fill();
}
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);

if(phase==="flying"){
multiplier+=0.002+multiplier*0.0006;
multiplierEl.className="multiplier big";
multiplierEl.innerText=multiplier.toFixed(2)+"x";
drawRocket();
if(multiplier>=crashPoint){crash();return;}
}
if(phase==="crashed"){drawRocket();}

animationId=requestAnimationFrame(animate);
}

function startFlight(){
phase="flying";
rocketCrash=false;fallSpeed=0;
multiplier=1;
crashPoint=1.5+Math.random()*4;
animationId=requestAnimationFrame(animate);
}

function crash(){
phase="crashed";
rocketCrash=true;
soundCrash();
addHistory(multiplier);
activeBet1=0;activeBet2=0;
updateUI();
setTimeout(startCountdown,3000);
}

function startCountdown(){
phase="betting";
let count=5;
multiplierEl.className="multiplier small";
multiplierEl.innerText="Uçuşa "+count+" Saniye";
let interval=setInterval(()=>{
soundTick();
count--;
if(count<=0){clearInterval(interval);startFlight();}
else{multiplierEl.innerText="Uçuşa "+count+" Saniye";}
},1000);
}

/* ===== BUTONLAR ===== */
function updateUI(){
document.getElementById("balance").innerText=balance;
document.getElementById("bet").innerText=activeBet1+activeBet2;
updateButton("btn1",activeBet1);
updateButton("btn2",activeBet2);
}

function updateButton(id,bet){
let btn=document.getElementById(id);
if(phase==="betting" && bet===0){btn.innerText="Bahis Yap";btn.className="";}
else if(phase==="betting" && bet>0){btn.innerText="İptal";btn.className="cancel";}
else if(phase==="flying" && bet>0){
btn.innerText="Çek (₺"+Math.floor(bet*multiplier)+")";
btn.className="cashout";
}else{btn.innerText="Bahis Yap";btn.className="";}
}

function handleBet(box){
let input=document.getElementById("bet"+box);
let amount=parseInt(input.value);
if(amount<1) amount=1;
if(amount>5000) amount=5000;
input.value=amount;

let active=box===1?activeBet1:activeBet2;

if(phase==="betting"){
if(active===0 && balance>=amount){
balance-=amount;
if(box===1) activeBet1=amount; else activeBet2=amount;
}
else if(active>0){
balance+=active;
if(box===1) activeBet1=0; else activeBet2=0;
}
}
else if(phase==="flying" && active>0){
balance+=Math.floor(active*multiplier);
soundCash();
if(box===1) activeBet1=0; else activeBet2=0;
}
updateUI();
}

document.getElementById("btn1").onclick=()=>handleBet(1);
document.getElementById("btn2").onclick=()=>handleBet(2);

animate();
startCountdown();
</script>
</body>
</html>
