<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SkyCrash</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none;}
body{height:100vh;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
background:#070b18;color:white;touch-action:manipulation;}

/* ===== PIXELARENA ÜST BAR ===== */

.top-bar{
position:fixed;
top:0;
width:100%;
height:55px;
display:flex;
align-items:center;
justify-content:space-between;
padding:0 16px;
background:linear-gradient(135deg,#1a2a6c,#16245c);
box-shadow:0 4px 15px rgba(0,0,0,0.45);
z-index:100;
}

.brand{
font-size:18px;
font-weight:800;
background:linear-gradient(90deg,#4fd1ff,#fff,#4fd1ff);
background-size:200% auto;
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
animation:shine 3s linear infinite;
}
@keyframes shine{to{background-position:200% center;}}

.right-menu{display:flex;gap:10px;}
.nav-box{
padding:6px 14px;
border-radius:14px;
font-weight:700;
font-size:13px;
min-width:95px;
text-align:center;
}
.balance-box{background:#273c8f;}
.bet-box{background:linear-gradient(90deg,#ff8a00,#ff5f00);color:#000;}

/* ===== OYUN ===== */

.main{
position:absolute;
top:55px;
bottom:130px;
width:100%;
background:radial-gradient(circle at center,#16204a,#070b18 70%);
display:flex;
align-items:center;
justify-content:center;
}

.multiplier{
font-size:70px;
font-weight:bold;
color:#00eaff;
text-shadow:0 0 25px #00eaff;
}

.bottom{
position:absolute;
bottom:0;
width:100%;
height:130px;
background:#121833;
display:flex;
justify-content:center;
align-items:center;
gap:15px;
}

.betBox{
background:#1a2248;
padding:12px;
border-radius:10px;
width:45%;
max-width:200px;
display:flex;
flex-direction:column;
gap:6px;
}

.betBox input{
padding:8px;
border:none;
border-radius:6px;
text-align:center;
font-weight:bold;
}

.betBox button{
padding:10px;
border:none;
border-radius:6px;
font-weight:bold;
cursor:pointer;
background:#6c5ce7;
color:white;
}

.cancel{background:#ff2a4d !important;}
</style>
</head>
<body>

<div class="top-bar">
<div class="brand">SkyCrash</div>
<div class="right-menu">
<div class="nav-box balance-box">Bakiye: <span id="balance">0</span>₺</div>
<div class="nav-box bet-box">Bahis: <span id="bet">0</span>₺</div>
</div>
</div>

<div class="main">
<div class="multiplier" id="multiplier">1.00x</div>
</div>

<div class="bottom">
<div class="betBox">
<input type="number" id="bet1" value="100">
<button id="btn1">Bahis Yap</button>
</div>
<div class="betBox">
<input type="number" id="bet2" value="200">
<button id="btn2">Bahis Yap</button>
</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,doc,updateDoc,onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
authDomain:"emirhan-site.firebaseapp.com",
projectId:"emirhan-site",
storageBucket:"emirhan-site.firebasestorage.app",
messagingSenderId:"668871888390",
appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let balance=0;
let totalBet=0;
let userRef=null;

const balanceEl=document.getElementById("balance");
const betEl=document.getElementById("bet");

onAuthStateChanged(auth,user=>{
if(!user){window.location.href="index.html";return;}
userRef=doc(db,"users",user.uid);

onSnapshot(userRef,snap=>{
if(!snap.exists()) return;
balance=snap.data().balance||0;
balanceEl.innerText=balance.toFixed(2);
});
});

/* ===== CRASH ENGINE ===== */

let phase="betting";
let multiplier=1;
let crashPoint=0;
let animation;
let bet1=0,bet2=0;
let active1=false,active2=false;
let win1=0,win2=0;

function updateBetBox(){
let total=0;
if(active1) total+=bet1;
if(active2) total+=bet2;
betEl.innerText=total.toFixed(2);
}

function startRound(){
phase="betting";
multiplier=1;
document.getElementById("multiplier").innerText="1.00x";
setTimeout(startFlight,5000);
}

function startFlight(){
phase="flying";
crashPoint=(1/(1-Math.random()))*0.97;
animate();
}

function animate(){
multiplier+=0.01*multiplier;
document.getElementById("multiplier").innerText=multiplier.toFixed(2)+"x";

if(active1){win1=bet1*multiplier;btn1.innerText="Çek "+win1.toFixed(2);}
if(active2){win2=bet2*multiplier;btn2.innerText="Çek "+win2.toFixed(2);}

if(multiplier>=crashPoint){crash();return;}
animation=requestAnimationFrame(animate);
}

function crash(){
cancelAnimationFrame(animation);
phase="crashed";
active1=false;
active2=false;
updateBetBox();
setTimeout(startRound,2000);
}

async function betHandler(btn,input,index){
btn.onclick=async()=>{
if(phase==="betting"){
let amount=parseFloat(input.value);
if(amount<=0||balance<amount) return;
balance-=amount;
await updateDoc(userRef,{balance});
if(index===1){bet1=amount;active1=true;}
else{bet2=amount;active2=true;}
updateBetBox();
btn.innerText="İptal";
btn.classList.add("cancel");
}
else if(phase==="flying"){
if(index===1&&active1){
balance+=win1;
await updateDoc(userRef,{balance});
active1=false;
btn.disabled=true;
updateBetBox();
}
if(index===2&&active2){
balance+=win2;
await updateDoc(userRef,{balance});
active2=false;
btn.disabled=true;
updateBetBox();
}
}
};
}

const btn1=document.getElementById("btn1");
const btn2=document.getElementById("btn2");

betHandler(btn1,document.getElementById("bet1"),1);
betHandler(btn2,document.getElementById("bet2"),2);

startRound();

</script>
</body>
</html>
