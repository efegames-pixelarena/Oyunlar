<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyCrash Pro</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#0b0f14;color:white}

/* HEADER */
.header{
height:60px;
background:#111418;
display:flex;
justify-content:space-between;
align-items:center;
padding:0 15px;
}
.headerLeft{
font-size:26px;
font-weight:bold;
color:#ff3b4d;
font-style:italic;
}
.balanceTop{color:#4caf50;font-weight:bold;font-size:18px;}

/* GAME AREA */
.crashContainer{
position:relative;
height:320px;
margin:15px;
border-radius:20px;
overflow:hidden;
background:radial-gradient(circle at center,#2a003f 0%,#0a0a0f 70%);
}

.multiplier{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:60px;
font-weight:bold;
}

.plane{
position:absolute;
bottom:20px;
left:0;
font-size:40px;
}

.redCurve{
position:absolute;
bottom:0;
left:0;
height:100%;
width:0%;
background:linear-gradient(to top right,#ff0022,#ff3355);
opacity:.25;
}

.crashMessage{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
text-align:center;
display:none;
}
.crashMessage h1{font-size:50px;color:#ff3b4d;}
.crashMessage h2{font-size:40px;margin-top:10px;}
.crashMessage p{margin-top:10px;font-size:20px;}

/* BET */
.betSection{padding:15px;}
.betCard{
background:linear-gradient(145deg,#181c24,#0e1015);
padding:15px;
border-radius:20px;
}
.betControl{
display:flex;
justify-content:space-between;
align-items:center;
background:#11151c;
padding:10px;
border-radius:15px;
margin-bottom:10px;
}
.betControl button{
background:#1b1f27;
border:none;
color:white;
font-size:20px;
width:45px;height:45px;
border-radius:50%;
}
.betAmount{font-size:22px;font-weight:bold;}
.betButton{
width:100%;
background:#22b300;
color:white;
border:none;
padding:15px;
font-size:20px;
border-radius:15px;
}
.betButton.cashout{
background:#00eaff;
color:black;
}
.betButton.disabled{
opacity:.5;
pointer-events:none;
}
</style>
</head>
<body>

<div class="header">
<div class="headerLeft">Aviator</div>
<div class="balanceTop"><span id="balanceTop">Yükleniyor...</span> TRY</div>
</div>

<div class="crashContainer">
<div class="multiplier" id="multiplierDisplay">5</div>
<div class="plane" id="plane">✈️</div>
<div class="redCurve" id="redCurve"></div>

<div class="crashMessage" id="crashMessage">
<h1>UZAKLAŞ !!</h1>
<h2 id="crashX"></h2>
<p id="crashCountdown"></p>
</div>
</div>

<div class="betSection">
<div class="betCard">
<div class="betControl">
<button onclick="changeBet(-1)">−</button>
<div class="betAmount" id="betDisplay">1.00</div>
<button onclick="changeBet(1)">+</button>
</div>
<button class="betButton" id="betBtn">Bahis Yap</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* FIREBASE CONFIG */
const firebaseConfig={
apiKey:"API_KEY",
authDomain:"PROJECT.firebaseapp.com",
projectId:"PROJECT_ID",
storageBucket:"PROJECT.appspot.com",
messagingSenderId:"MSG_ID",
appId:"APP_ID"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let userRef=null;
let balance=0;
let bet=1;
let hasBet=false;
let cashedOut=false;
let multiplier=1;
let crashPoint=0;
let phase="betting";
let animation;

/* AUTO LOGIN */
signInAnonymously(auth);

onAuthStateChanged(auth, async(user)=>{
if(!user) return;

userRef=doc(db,"users",user.uid);
let snap=await getDoc(userRef);

if(!snap.exists()){
await setDoc(userRef,{balance:1000});
}

onSnapshot(userRef,(docSnap)=>{
if(docSnap.exists()){
balance=docSnap.data().balance||0;
balanceTop.innerText=Math.floor(balance);
}
});
});

/* UPDATE BALANCE */
async function updateBalance(val){
if(!userRef) return;
await updateDoc(userRef,{balance:Math.floor(val)});
}

/* GAME */
function startRound(){
phase="betting";
multiplier=1;
hasBet=false;
cashedOut=false;
betBtn.innerText="Bahis Yap";
betBtn.classList.remove("cashout","disabled");
plane.style.transform="translate(0,0)";
redCurve.style.width="0%";
crashMessage.style.display="none";
startCountdown();
}

function startCountdown(){
let time=5;
multiplierDisplay.innerText=time;
let interval=setInterval(()=>{
time--;
multiplierDisplay.innerText=time;
if(time<=0){
clearInterval(interval);
startFlight();
}
},1000);
}

function startFlight(){
phase="flying";
if(hasBet){
betBtn.innerText="Cashout";
betBtn.classList.add("cashout");
}
crashPoint=(1/(1-Math.random()))*0.96;
animate();
}

function animate(){
multiplier+=0.004;
updateVisual();
if(multiplier>=crashPoint){triggerCrash();return;}
animation=requestAnimationFrame(animate);
}

function updateVisual(){
multiplierDisplay.innerText=multiplier.toFixed(2)+"x";
let percent=Math.min(multiplier*4,100);
redCurve.style.width=percent+"%";
plane.style.transform=
"translate("+percent*3+"px,-"+percent*1.6+"px)";
}

function triggerCrash(){
cancelAnimationFrame(animation);
phase="crashed";
betBtn.classList.add("disabled");
crashMessage.style.display="block";
crashX.innerText=multiplier.toFixed(2)+"x";
crashCountdown.innerText="Bahislerin Kapanmasına 5sn";
setTimeout(startRound,5000);
}

/* BET */
function changeBet(v){
if(phase!=="betting") return;
bet=Math.max(1,bet+v);
betDisplay.innerText=bet.toFixed(2);
}

betBtn.onclick=async()=>{
if(!userRef) return;

if(phase==="betting" && !hasBet){
if(balance<bet) return;
balance-=bet;
await updateBalance(balance);
hasBet=true;
betBtn.innerText="İptal";
}
else if(phase==="betting" && hasBet){
balance+=bet;
await updateBalance(balance);
hasBet=false;
betBtn.innerText="Bahis Yap";
}
else if(phase==="flying" && hasBet && !cashedOut){
let payout=bet*multiplier;
balance+=payout;
await updateBalance(balance);
cashedOut=true;
betBtn.innerText="Çekildi";
betBtn.classList.add("disabled");
}
};

startRound();
</script>
</body>
</html>
