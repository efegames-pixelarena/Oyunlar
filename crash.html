<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Aviator</title>

<style>
body{
margin:0;
background:#050b16;
font-family:Arial;
color:white;
overflow:hidden;
}

.topbar{
display:flex;
justify-content:space-between;
padding:15px;
font-size:22px;
}

.logo{
color:#ff3b3b;
font-style:italic;
font-weight:bold;
}

.balance{
color:#35d07f;
font-weight:bold;
}

.game{
position:relative;
height:300px;
margin:10px;
border-radius:20px;
background:radial-gradient(circle at center,#3b0066,#070b1a);
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
overflow:hidden;
}

.multiplier{
font-size:55px;
font-weight:bold;
}

.plane{
position:absolute;
left:20px;
bottom:40px;
font-size:40px;
transition:all linear;
}

.controls{
padding:15px;
}

.betbox{
background:#111a2b;
border-radius:20px;
padding:20px;
}

.betrow{
display:flex;
align-items:center;
justify-content:space-between;
margin-bottom:15px;
}

.betbtn{
width:50px;
height:50px;
border-radius:50%;
background:#1d2a40;
border:none;
color:white;
font-size:25px;
}

.betinput{
width:120px;
text-align:center;
font-size:22px;
background:transparent;
border:none;
color:white;
outline:none;
}

.quick{
display:flex;
justify-content:space-between;
margin-bottom:15px;
}

.quick button{
flex:1;
margin:5px;
background:#1d2a40;
border:none;
color:white;
padding:10px;
border-radius:10px;
}

.mainbtn{
width:100%;
padding:15px;
border:none;
border-radius:15px;
font-size:20px;
font-weight:bold;
background:#1ed760;
color:black;
}

.cashout{
background:#00c9d6 !important;
}

.message{
text-align:center;
margin-top:10px;
}
</style>
</head>

<body>

<div class="topbar">
<div class="logo">Aviator</div>
<div class="balance" id="balance">0 TRY</div>
</div>

<div class="game">
<div class="multiplier" id="multiplier">1.00x</div>
<div class="plane" id="plane">✈️</div>
<div class="message" id="message"></div>
</div>

<div class="controls">
<div class="betbox">

<div class="betrow">
<button class="betbtn" id="minus">-</button>
<input type="number" id="betAmount" class="betinput" value="100">
<button class="betbtn" id="plus">+</button>
</div>

<div class="quick">
<button data-amount="1">1</button>
<button data-amount="2">2</button>
<button data-amount="5">5</button>
<button data-amount="10">10</button>
</div>

<button class="mainbtn" id="betButton">Bahis Yap</button>

</div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* KENDİ FIREBASE CONFIGİNİ BURAYA KOY */
const firebaseConfig = {
apiKey: "APIKEY",
authDomain: "PROJECT.firebaseapp.com",
projectId: "PROJECT",
storageBucket: "PROJECT.appspot.com",
messagingSenderId: "XXXX",
appId: "XXXX"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let user = auth.currentUser;

if(!user){
alert("Kullanıcı login değil!");
throw new Error("Login gerekli");
}

const userRef = doc(db,"users",user.uid);

let balance = 0;

const balanceEl = document.getElementById("balance");
const multiplierEl = document.getElementById("multiplier");
const plane = document.getElementById("plane");
const betInput = document.getElementById("betAmount");
const betButton = document.getElementById("betButton");
const message = document.getElementById("message");

/* BAKİYE DİNLE */
onSnapshot(userRef,(snap)=>{
if(!snap.exists()){
alert("users/{uid} belgesi yok!");
return;
}
balance = snap.data().balance || 0;
balanceEl.innerText = balance + " TRY";
});

/* + - BUTON */
document.getElementById("minus").onclick=()=>{
betInput.value=Math.max(0,Number(betInput.value)-50);
};
document.getElementById("plus").onclick=()=>{
betInput.value=Number(betInput.value)+100;
};

/* QUICK */
document.querySelectorAll(".quick button").forEach(btn=>{
btn.onclick=()=>{
betInput.value=Number(betInput.value)+Number(btn.dataset.amount);
};
});

let gameInterval;
let multiplier=1;
let crashed=false;
let activeBet=0;
let cashed=false;

/* OYUN BAŞLAT */
function startGame(){
multiplier=1;
crashed=false;
cashed=false;
message.innerText="";
multiplierEl.innerText="1.00x";
plane.style.left="20px";
plane.style.bottom="40px";

const crashPoint=(Math.random()*5+1.5).toFixed(2);

gameInterval=setInterval(()=>{
if(crashed) return;

multiplier+=0.01;
multiplierEl.innerText=multiplier.toFixed(2)+"x";
plane.style.left=(20+multiplier*20)+"px";
plane.style.bottom=(40+multiplier*15)+"px";

if(multiplier>=crashPoint){
crashed=true;
clearInterval(gameInterval);
multiplierEl.innerText="UZAKLAŞ !!";
message.innerHTML=crashPoint+"x<br>Bahislerin Kapanmasına 5sn";

setTimeout(()=>{
message.innerText="";
multiplierEl.innerText="1.00x";
betButton.innerText="Bahis Yap";
betButton.classList.remove("cashout");
},5000);
}

},100);
}

/* BUTON */
betButton.onclick=async ()=>{

if(crashed) return;

if(activeBet===0){

const bet=Number(betInput.value);
if(bet<=0 || bet>balance) return alert("Yetersiz bakiye");

activeBet=bet;
await updateDoc(userRef,{balance:balance-bet});
betButton.innerText="Cashout";
betButton.classList.add("cashout");
startGame();

}else{

if(cashed) return;

cashed=true;
clearInterval(gameInterval);

const win=(activeBet*multiplier).toFixed(2);
await updateDoc(userRef,{balance:balance+Number(win)});
betButton.innerText="Bahis Yap";
betButton.classList.remove("cashout");
activeBet=0;

}
};

</script>
</body>
</html>
