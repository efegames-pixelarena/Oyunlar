<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aviator</title>

<style>
body{
margin:0;
background:#050b14;
font-family:Arial, sans-serif;
color:white;
text-align:center;
overflow:hidden;
}

header{
display:flex;
justify-content:space-between;
padding:15px;
font-size:22px;
font-weight:bold;
}

#balance{
color:#4caf50;
}

.crashArea{
position:relative;
height:55vh;
background:radial-gradient(circle at center, #3b0066 0%, #0a0f1c 70%);
display:flex;
align-items:center;
justify-content:center;
overflow:hidden;
}

#multiplier{
font-size:70px;
font-weight:bold;
z-index:2;
}

#plane{
position:absolute;
width:80px;
bottom:40px;
left:10%;
transition:transform 0.1s linear;
}

#countdown{
position:absolute;
top:10px;
font-size:18px;
opacity:0.8;
}

.betSection{
position:fixed;
bottom:0;
width:100%;
background:#0f1724;
padding:20px;
box-sizing:border-box;
}

.betControls{
display:flex;
justify-content:center;
align-items:center;
gap:20px;
margin-bottom:15px;
}

.betControls button{
width:50px;
height:50px;
border-radius:50%;
border:none;
background:#1f2937;
color:white;
font-size:22px;
}

#betAmount{
font-size:26px;
width:100px;
text-align:center;
background:none;
border:none;
color:white;
}

#betBtn{
width:90%;
padding:15px;
border-radius:15px;
border:none;
background:#4caf50;
font-size:22px;
font-weight:bold;
color:white;
}

</style>
</head>
<body>

<header>
<div>Aviator</div>
<div id="balance">0 TRY</div>
</header>

<div class="crashArea">
<div id="countdown"></div>
<div id="multiplier">1.00x</div>
<img id="plane" src="https://i.imgur.com/7Qp7YQK.png">
</div>

<div class="betSection">
<div class="betControls">
<button onclick="changeBet(-10)">-</button>
<input id="betAmount" value="100">
<button onclick="changeBet(10)">+</button>
</div>
<button id="betBtn" onclick="placeBet()">Bahis Yap</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "APIKEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT",
  storageBucket: "PROJECT.appspot.com",
  messagingSenderId: "ID",
  appId: "APPID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let userRef;
let balance = 0;
let currentMultiplier = 1;
let interval;
let crashPoint;
let bettingOpen = false;
let hasBet = false;
let betAmount = 0;

onAuthStateChanged(auth, (user) => {
if(user){
userRef = doc(db,"users",user.uid);
onSnapshot(userRef,(snap)=>{
balance = snap.data().balance;
document.getElementById("balance").innerText = balance+" TRY";
});
}
});

function changeBet(val){
let input = document.getElementById("betAmount");
let newVal = Math.max(10, parseInt(input.value)+val);
input.value = newVal;
}

function placeBet(){
if(!bettingOpen) return;
betAmount = parseInt(document.getElementById("betAmount").value);
if(balance < betAmount) return alert("Yetersiz bakiye");
updateDoc(userRef,{balance:balance-betAmount});
hasBet = true;
document.getElementById("betBtn").innerText="Cash Out";
document.getElementById("betBtn").onclick = cashOut;
}

function cashOut(){
if(!hasBet) return;
let win = Math.floor(betAmount * currentMultiplier);
updateDoc(userRef,{balance:balance+win});
resetBet();
}

function resetBet(){
hasBet=false;
document.getElementById("betBtn").innerText="Bahis Yap";
document.getElementById("betBtn").onclick = placeBet;
}

function startRound(){
bettingOpen=false;
currentMultiplier=1;
crashPoint=(Math.random()*5+1).toFixed(2);

interval=setInterval(()=>{
currentMultiplier+=0.02;
document.getElementById("multiplier").innerText=currentMultiplier.toFixed(2)+"x";

let moveX=currentMultiplier*15;
let moveY=currentMultiplier*8;
document.getElementById("plane").style.transform=
`translate(${moveX}px,-${moveY}px)`;

if(currentMultiplier>=crashPoint){
clearInterval(interval);
resetBet();
setTimeout(countdownNext,1000);
}
},100);
}

function countdownNext(){
let time=5;
document.getElementById("countdown").innerText="Yeni Tur: "+time;

let cd=setInterval(()=>{
time--;
document.getElementById("countdown").innerText="Yeni Tur: "+time;
if(time<=0){
clearInterval(cd);
document.getElementById("countdown").innerText="";
bettingOpen=true;
startRound();
}
},1000);
}

bettingOpen=true;
countdownNext();

</script>
</body>
</html>
