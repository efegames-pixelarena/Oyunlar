<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyCrash</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
html,body{height:100%;overflow:hidden;background:#070b18;}
body{display:flex;flex-direction:column;height:100dvh;}

/* ======= YENİ ÜST BAR ======= */

.top{
height:90px;
background:linear-gradient(180deg,#1b2247,#0e1330);
display:flex;
justify-content:space-between;
align-items:center;
padding:0 20px;
border-bottom:1px solid #2a356b;
position:relative;
}

.logo{
font-size:24px;
font-weight:bold;
color:#00eaff;
letter-spacing:1px;
}

.balanceWrap{
display:flex;
gap:15px;
align-items:center;
}

.balanceBox{
background:rgba(0,255,255,0.08);
padding:10px 20px;
border-radius:30px;
border:1px solid rgba(0,255,255,0.4);
color:#00eaff;
font-weight:bold;
box-shadow:0 0 15px rgba(0,255,255,0.4);
}

.betTotalBox{
background:linear-gradient(90deg,#ff8c00,#ff6a00);
padding:10px 20px;
border-radius:30px;
color:#fff;
font-weight:bold;
box-shadow:0 0 15px rgba(255,140,0,0.6);
}

.historyBar{
position:absolute;
bottom:8px;
left:0;
width:100%;
display:flex;
gap:10px;
padding:0 15px;
font-size:13px;
}

.historyItem{
padding:3px 8px;
border-radius:10px;
background:rgba(0,255,200,0.1);
color:#00eaff;
}

.historyCrash{
background:rgba(255,0,60,0.2);
color:#ff2a4d;
}

/* ======= OYUN ======= */

.main{flex:1;position:relative;overflow:hidden;}

.graphArea{
width:100%;
height:100%;
position:relative;
background:radial-gradient(circle at center,#16204a,#070b18 70%);
}

.multiplier{
position:absolute;
top:45%;
left:50%;
transform:translate(-50%,-50%);
font-size:70px;
font-weight:bold;
color:#00eaff;
text-shadow:0 0 25px #00eaff;
}

.bottom{
height:130px;
background:#121833;
display:flex;
justify-content:center;
align-items:center;
gap:15px;
}

.betBox{
background:#1a2248;
padding:12px;
border-radius:10px;
width:45%;
max-width:200px;
display:flex;
flex-direction:column;
gap:6px;
}

.betBox input{
padding:8px;
border:none;
border-radius:6px;
text-align:center;
font-weight:bold;
}

.betBox button{
padding:10px;
border:none;
border-radius:6px;
font-weight:bold;
cursor:pointer;
background:#6c5ce7;
color:white;
}

.cancel{background:#ff2a4d !important;}
.cashout{background:#00eaff !important;color:#000 !important;}
</style>
</head>
<body>

<div class="top">
<div class="logo">SkyCrash</div>

<div class="balanceWrap">
<div class="balanceBox">Bakiye: <span id="balance">0.00</span>₺</div>
<div class="betTotalBox">Bahis: <span id="totalBet">0.00</span>₺</div>
</div>

<div class="historyBar" id="historyBar"></div>
</div>

<div class="main">
<div class="graphArea">
<div class="multiplier" id="multiplier">1.00x</div>
</div>
</div>

<div class="bottom">
<div class="betBox">
<input type="number" id="bet1" value="100">
<button id="btn1">Bahis Yap</button>
</div>
<div class="betBox">
<input type="number" id="bet2" value="200">
<button id="btn2">Bahis Yap</button>
</div>
</div>

<script type="module">

/* ================= FIREBASE ================= */

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
  authDomain: "emirhan-site.firebaseapp.com",
  projectId: "emirhan-site",
  storageBucket: "emirhan-site.firebasestorage.app",
  messagingSenderId: "668871888390",
  appId: "1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser=null;
let balance=0;

onAuthStateChanged(auth,(user)=>{
if(!user){ window.location.href="index.html"; return; }
currentUser=user;

onSnapshot(doc(db,"users",user.uid),(snap)=>{
if(snap.exists()){
balance = snap.data().balance || 0;
document.getElementById("balance").innerText = balance.toFixed(2);
}
});
});

/* ================= GAME ================= */

let phase="betting";
let multiplier=1;
let crashPoint=0;
let animation;
let history=[];
let bet1=0, bet2=0;
let active1=false, active2=false;
let win1=0, win2=0;

function updateTotalBet(){
let total=0;
if(active1) total+=bet1;
if(active2) total+=bet2;
document.getElementById("totalBet").innerText=total.toFixed(2);
}

function startCountdown(){
phase="betting";
multiplier=1;
document.getElementById("multiplier").innerText="1.00x";
resetButtons();
setTimeout(startFlight,5000);
}

function startFlight(){
phase="flying";
crashPoint=(1/(1-Math.random()))*0.97;
animate();
}

function animate(){
multiplier+=0.01*multiplier;
document.getElementById("multiplier").innerText=multiplier.toFixed(2)+"x";

if(active1){ win1=bet1*multiplier; document.getElementById("btn1").innerText="Çek ("+win1.toFixed(2)+")"; }
if(active2){ win2=bet2*multiplier; document.getElementById("btn2").innerText="Çek ("+win2.toFixed(2)+")"; }

if(multiplier>=crashPoint){ triggerCrash(); return; }

animation=requestAnimationFrame(animate);
}

function triggerCrash(){
cancelAnimationFrame(animation);
phase="crashed";
active1=false;
active2=false;
updateTotalBet();
setTimeout(startCountdown,2000);
}

function resetButtons(){
["btn1","btn2"].forEach(id=>{
let b=document.getElementById(id);
b.disabled=false;
b.innerText="Bahis Yap";
b.classList.remove("cancel","cashout");
});
updateTotalBet();
}

async function handleBet(btnId,inputId,index){
let btn=document.getElementById(btnId);
let input=document.getElementById(inputId);

btn.onclick=async function(){

if(phase==="betting"){
let amount=parseFloat(input.value);
if(amount<=0 || balance<amount) return;

await updateDoc(doc(db,"users",currentUser.uid),{ balance: balance-amount });

if(index===1){ bet1=amount; active1=true; }
else{ bet2=amount; active2=true; }

updateTotalBet();
btn.innerText="İptal Et";
btn.classList.add("cancel");
}

else if(phase==="flying"){

if(index===1 && active1){
await updateDoc(doc(db,"users",currentUser.uid),{ balance: balance+win1 });
active1=false;
btn.disabled=true;
updateTotalBet();
}

if(index===2 && active2){
await updateDoc(doc(db,"users",currentUser.uid),{ balance: balance+win2 });
active2=false;
btn.disabled=true;
updateTotalBet();
}

}
};
}

handleBet("btn1","bet1",1);
handleBet("btn2","bet2",2);

startCountdown();

</script>
</body>
</html>
