<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">

<!-- ‚úÖ DOUBLE TAP ZOOM FIX -->
<meta name="viewport"
content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

<title>Pattern Master</title>

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
-webkit-tap-highlight-color:transparent;
user-select:none;
touch-action:manipulation;
}

html,body{
overscroll-behavior:none;
touch-action:manipulation;
}

body{
background:#0f0f1a;
color:white;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
height:100vh;
overflow:hidden;
transition:background .2s, transform .1s;
}

/* ===== SCREEN FLASH ===== */
.flash{
background:#ffffff !important;
}

/* ===== SHAKE ===== */
.shake{
animation:shakeAnim .35s ease;
}

@keyframes shakeAnim{
0%{transform:translateX(0);}
20%{transform:translateX(-8px);}
40%{transform:translateX(8px);}
60%{transform:translateX(-6px);}
80%{transform:translateX(6px);}
100%{transform:translateX(0);}
}

/* ===== TOP BAR ===== */
.top-bar{
position:fixed;
top:0;
width:100%;
height:55px;
display:flex;
align-items:center;
justify-content:center;
background:linear-gradient(135deg,#1a2a6c,#16245c);
box-shadow:0 4px 15px rgba(0,0,0,0.45);
z-index:100;
}

.brand{
font-size:18px;
font-weight:800;
letter-spacing:2px;
background:linear-gradient(90deg,#00f5ff,#ff00c8);
background-size:200% auto;
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
animation:shine 3s linear infinite;
}

@keyframes shine{
to{background-position:200% center;}
}

/* ===== GAME ===== */
.game-wrapper{
margin-top:55px;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
height:calc(100vh - 55px);
}

#info{margin-bottom:20px;text-align:center;opacity:.9;}

#grid{
display:grid;
grid-template-columns:repeat(2,120px);
grid-template-rows:repeat(2,120px);
gap:20px;
margin-bottom:25px;
}

.btn{
display:flex;
align-items:center;
justify-content:center;
font-size:40px;
border-radius:20px;
cursor:pointer;
transition:all .2s ease;
background:#1a1a2e;
box-shadow:0 0 15px rgba(0,255,255,.2);
}

.btn:active{transform:scale(.95);}

.neon-up{color:#00f5ff;}
.neon-down{color:#ff00c8;}
.neon-left{color:#00ff88;}
.neon-right{color:#ffaa00;}

.active{
box-shadow:0 0 30px currentColor;
background:#111;
transform:scale(1.1);
}

.perfect{
animation:perfectGlow .6s ease;
}

@keyframes perfectGlow{
0%{box-shadow:0 0 0px #fff;}
50%{box-shadow:0 0 40px #fff;}
100%{box-shadow:0 0 0px #fff;}
}

#status{
height:30px;
margin-bottom:15px;
font-weight:600;
}

#startBtn{
padding:10px 25px;
border:none;
border-radius:20px;
background:linear-gradient(90deg,#00f5ff,#ff00c8);
color:white;
font-weight:700;
cursor:pointer;
}

#highscore{
margin-top:10px;
opacity:.7;
font-size:14px;
}
</style>
</head>
<body>

<div class="top-bar">
<div class="brand">PATTERN MASTER</div>
</div>

<div class="game-wrapper">

<div id="info">
Level: <span id="level">1</span> | 
Combo: <span id="combo">0</span>
</div>

<div id="status"></div>

<div id="grid">
<div class="btn neon-up" data-dir="up">üöó</div>
<div class="btn neon-right" data-dir="right">‚öΩÔ∏è</div>
<div class="btn neon-left" data-dir="left">üçì</div>
<div class="btn neon-down" data-dir="down">üíé</div>
</div>

<button id="startBtn">Ba≈üla</button>
<div id="highscore"></div>

</div>

<script>
const buttons=document.querySelectorAll(".btn");
const levelEl=document.getElementById("level");
const comboEl=document.getElementById("combo");
const statusEl=document.getElementById("status");
const startBtn=document.getElementById("startBtn");
const highscoreEl=document.getElementById("highscore");

let pattern=[];
let playerIndex=0;
let level=1;
let combo=0;
let speed=800;
let isShowing=false;
let perfectStreak=true;

let highScore=localStorage.getItem("patternHigh")||0;
highscoreEl.innerText="High Score: "+highScore;

/* ===== ULTRA STABLE IOS AUDIO ===== */
let audioCtx=null;

function initAudio(){
if(!audioCtx){
audioCtx=new (window.AudioContext||window.webkitAudioContext)();
}
if(audioCtx.state==="suspended"){
audioCtx.resume();
}
}

function playBeep(freq,duration=0.15){
if(!audioCtx)return;
if(audioCtx.state==="suspended"){
audioCtx.resume();
}

const osc=audioCtx.createOscillator();
const gain=audioCtx.createGain();

osc.type="sine";
osc.frequency.setValueAtTime(freq,audioCtx.currentTime);

gain.gain.setValueAtTime(0.25,audioCtx.currentTime);
gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+duration);

osc.connect(gain);
gain.connect(audioCtx.destination);

osc.start();
osc.stop(audioCtx.currentTime+duration);
}

document.addEventListener("visibilitychange",()=>{
if(audioCtx && audioCtx.state==="suspended"){
audioCtx.resume();
}
});

/* ===== GAME ===== */

function randomDir(){
const dirs=["up","down","left","right"];
return dirs[Math.floor(Math.random()*4)];
}

function flashButton(dir){
const btn=document.querySelector(`[data-dir='${dir}']`);
btn.classList.add("active");
setTimeout(()=>btn.classList.remove("active"),speed-200);
}

async function showPattern(){
isShowing=true;
statusEl.innerText="ƒ∞zle...";
for(let i=0;i<pattern.length;i++){
flashButton(pattern[i]);
playBeep(300+i*60,0.12);
await new Promise(r=>setTimeout(r,speed));
}
isShowing=false;
statusEl.innerText="Sƒ±ranƒ± Yap!";
}

function screenFlash(){
document.body.classList.add("flash");
setTimeout(()=>document.body.classList.remove("flash"),150);
}

function screenShake(){
document.body.classList.add("shake");
setTimeout(()=>document.body.classList.remove("shake"),350);
}

function startGame(){
initAudio();
pattern=[];
level=1;
combo=0;
speed=800;
perfectStreak=true;
nextRound();
}

function nextRound(){
playerIndex=0;
pattern.push(randomDir());
levelEl.innerText=level;
comboEl.innerText=combo;
showPattern();
}

function levelUp(){
screenFlash();
playBeep(900,.18);

if(perfectStreak){
combo+=10;
statusEl.innerText="üî• PERFECT!";
document.querySelectorAll(".btn").forEach(b=>{
b.classList.add("perfect");
setTimeout(()=>b.classList.remove("perfect"),600);
});
}else{
statusEl.innerText="Level Up!";
}

level++;
speed=Math.max(300,speed-40);
setTimeout(nextRound,700);
}

function gameOver(){
screenShake();
playBeep(140,.4);
statusEl.innerText="Yanlƒ±≈ü! Oyun Bitti";
perfectStreak=false;

if(level-1>highScore){
highScore=level-1;
localStorage.setItem("patternHigh",highScore);
highscoreEl.innerText="High Score: "+highScore;
}
}

buttons.forEach(btn=>{
btn.addEventListener("pointerdown",()=>{
if(isShowing)return;

initAudio();
const dir=btn.dataset.dir;
flashButton(dir);
playBeep(550,0.12);

if(dir===pattern[playerIndex]){
playerIndex++;
combo++;
comboEl.innerText=combo;

if(playerIndex===pattern.length){
levelUp();
}
}else{
perfectStreak=false;
gameOver();
}
});
});

startBtn.addEventListener("pointerdown",()=>{
initAudio();
startGame();
});
</script>

</body>
</html>
