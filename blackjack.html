<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PixelArena BJ</title>

<style>
body{
    margin:0;
    font-family:Arial, Helvetica, sans-serif;
    background:linear-gradient(to bottom,#000 40%,#0b6623 60%);
    color:white;
    text-align:center;
    overflow-x:hidden;
}

header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px;
    background:#1e2a78;
    font-weight:bold;
}

.badge{
    padding:8px 15px;
    border-radius:20px;
}

.balance{background:#304ffe;}
.bet{background:#ff6f00;}

.area{
    min-height:250px;
    position:relative;
    padding:10px;
}

.cards{
    min-height:140px;
    position:relative;
}

.card{
    width:80px;
    height:120px;
    position:absolute;
    left:50%;
    transform:translateX(-50%) translateY(-200px);
    transition:all 0.6s ease;
}

.card img{
    width:100%;
    border-radius:8px;
}

.total{
    color:gold;
    font-weight:bold;
    margin-top:5px;
}

.controls{
    margin-top:15px;
}

button{
    padding:12px 25px;
    border:none;
    border-radius:10px;
    font-size:18px;
    margin:5px;
    cursor:pointer;
}

.hit{background:#2ecc71;color:white;}
.stand{background:#e74c3c;color:white;}

.chips button{
    border-radius:50%;
    width:60px;
    height:60px;
    font-weight:bold;
}
</style>
</head>
<body>

<header>
<div>PixelArena BJ</div>
<div class="badge balance">Bakiye: <span id="balance">0</span>â‚º</div>
<div class="badge bet">Bahis: <span id="bet">0</span>â‚º</div>
</header>

<div class="area">
<h2>KURUPÄ°YER</h2>
<div class="cards" id="dealer-cards"></div>
<div class="total">Toplam: <span id="dealer-total">0</span></div>
</div>

<hr style="border:2px solid orange">

<div class="area">
<div class="cards" id="player-cards"></div>
<div class="total">Toplam: <span id="player-total">0</span></div>

<div id="status"></div>

<div class="controls">
<button class="hit" onclick="hit()">HIT</button>
<button class="stand" onclick="stand()">STAND</button>
</div>

<div class="chips">
<button onclick="placeBet(10)">10</button>
<button onclick="placeBet(25)">25</button>
<button onclick="placeBet(50)">50</button>
<button onclick="placeBet(100)">100</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ðŸ”¥ BURAYA SENÄ°N INDEX.HTML'DEKÄ° FIREBASE CONFIG */
const firebaseConfig = {
    apiKey: "SENÄ°N_KEY",
    authDomain: "SENÄ°N_DOMAIN",
    projectId: "SENÄ°N_ID",
    storageBucket: "SENÄ°N_BUCKET",
    messagingSenderId: "SENÄ°N_SENDER",
    appId: "SENÄ°N_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let balance = 0;
let bet = 0;
let deck = [];
let playerHand = [];
let dealerHand = [];
let gameActive = false;
let bettingOpen = true;

auth.onAuthStateChanged(user=>{
    if(user){
        const ref = doc(db,"users",user.uid);
        onSnapshot(ref,(snap)=>{
            if(snap.exists()){
                balance = snap.data().balance || 0;
                document.getElementById("balance").innerText = balance;
            }
        });
    }
});

function createDeck(){
    const suits=["S","H","D","C"];
    const values=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    deck=[];
    for(let s of suits){
        for(let v of values){
            deck.push({s,v});
        }
    }
    deck.sort(()=>Math.random()-0.5);
}

function cardImage(card){
    return `https://deckofcardsapi.com/static/img/${card.v}${card.s}.png`;
}

function calculateTotal(hand){
    let total=0, aces=0;
    for(let c of hand){
        if(["J","Q","K"].includes(c.v)) total+=10;
        else if(c.v==="A"){total+=11;aces++;}
        else total+=parseInt(c.v);
    }
    while(total>21 && aces>0){
        total-=10; aces--;
    }
    return total;
}

function renderCard(container, card, hidden=false){
    const div=document.createElement("div");
    div.className="card";
    const img=document.createElement("img");
    img.src = hidden ? "https://deckofcardsapi.com/static/img/back.png" : cardImage(card);
    div.appendChild(img);
    container.appendChild(div);

    setTimeout(()=>{
        div.style.transform=`translateX(${(container.children.length-1)*90 - 90}px) translateY(0px)`;
    },50);
}

async function startGame(){
    gameActive=true;
    bettingOpen=false;
    document.getElementById("status").innerText="";
    createDeck();
    playerHand=[];
    dealerHand=[];
    document.getElementById("player-cards").innerHTML="";
    document.getElementById("dealer-cards").innerHTML="";

    dealCard(playerHand,"player-cards",false);
    await delay(500);
    dealCard(dealerHand,"dealer-cards",false);
    await delay(500);
    dealCard(playerHand,"player-cards",false);
    await delay(500);
    dealCard(dealerHand,"dealer-cards",true);

    updateTotals();
}

function dealCard(hand, elementId, hidden){
    const card=deck.pop();
    hand.push(card);
    renderCard(document.getElementById(elementId),card,hidden);
}

function updateTotals(){
    document.getElementById("player-total").innerText=calculateTotal(playerHand);
    document.getElementById("dealer-total").innerText=dealerHand.length>1?calculateTotal([dealerHand[0]]):0;
}

function hit(){
    if(!gameActive) return;
    dealCard(playerHand,"player-cards",false);
    updateTotals();
    if(calculateTotal(playerHand)>21){
        endGame();
    }
}

async function stand(){
    if(!gameActive) return;
    document.getElementById("dealer-cards").innerHTML="";
    dealerHand.forEach(c=>renderCard(document.getElementById("dealer-cards"),c,false));
    while(calculateTotal(dealerHand)<17){
        await delay(700);
        dealCard(dealerHand,"dealer-cards",false);
    }
    endGame();
}

function endGame(){
    gameActive=false;
    const p=calculateTotal(playerHand);
    const d=calculateTotal(dealerHand);

    let result="";
    if(p>21) result="Kaybettin";
    else if(d>21 || p>d){ result="KazandÄ±n"; balance+=bet*2; }
    else if(p===d){ result="Berabere"; balance+=bet; }
    else result="Kaybettin";

    updateBalance();
    document.getElementById("status").innerText=result;
    bet=0;
    document.getElementById("bet").innerText=0;
    bettingOpen=true;
}

async function updateBalance(){
    const user=auth.currentUser;
    if(user){
        await updateDoc(doc(db,"users",user.uid),{balance:balance});
    }
}

function placeBet(amount){
    if(!bettingOpen || balance<amount) return;
    if(bet===0){
        setTimeout(()=>startGame(),5000);
    }
    bet+=amount;
    balance-=amount;
    document.getElementById("bet").innerText=bet;
    document.getElementById("balance").innerText=balance;
}

function delay(ms){ return new Promise(res=>setTimeout(res,ms)); }

window.hit=hit;
window.stand=stand;
window.placeBet=placeBet;

</script>
</body>
</html>
