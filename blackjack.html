<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PixelArena Blackjack</title>

<style>
body{
  margin:0;
  background:#0f172a;
  font-family:Arial, Helvetica, sans-serif;
  color:white;
  overflow:hidden;
}

/* ===== PREMIUM TOPBAR ===== */

.topbar{
  height:50px;
  background:#ffffff;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 4px 20px rgba(0,0,0,0.15);
}

.topbar-inner{
  width:95%;
  max-width:1200px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:600;
  color:#111;
}

.logo{
  font-size:17px;
  letter-spacing:1px;
}

.wallet{
  display:flex;
  gap:15px;
}

.oval{
  padding:6px 14px;
  border-radius:30px;
  background:#111;
  color:#00ffcc;
  font-weight:700;
  animation:glow 1.2s infinite alternate;
}

@keyframes glow{
  from{box-shadow:0 0 5px #00ffcc;}
  to{box-shadow:0 0 15px #00ffcc;}
}

/* ===== TABLE ===== */

.table{
  text-align:center;
  margin-top:40px;
}

.cards{
  font-size:18px;
  margin:15px;
}

button{
  padding:10px 20px;
  margin:8px;
  font-size:16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

#hit{background:#22c55e;color:white;}
#stand{background:#ef4444;color:white;}

button:disabled{
  opacity:0.4;
  cursor:not-allowed;
}

#message{
  font-size:18px;
  margin-top:15px;
  font-weight:600;
}
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-inner">
    <div class="logo">PixelArena BJ</div>
    <div class="wallet">
      <div class="oval">Bakiye ₺<span id="balance">0</span></div>
      <div class="oval">Bahis ₺<span id="bet">0</span></div>
    </div>
  </div>
</div>

<div class="table">
  <div class="cards">
    <div>Oyuncu: <span id="playerCards"></span> (<span id="playerScore">0</span>)</div>
    <div>KURUPİER: <span id="dealerCards"></span> (<span id="dealerScore">0</span>)</div>
  </div>

  <div id="message">Yükleniyor...</div>

  <button id="hit" disabled>HIT</button>
  <button id="stand" disabled>STAND</button>
</div>

<script type="module">

/* ================= FIREBASE ================= */

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT",
  storageBucket: "PROJECT.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ================= STATE ================= */

let currentUser=null;
let balance=0;
let bet=100; // sabit örnek bahis

let player=[];
let dealer=[];
let gameActive=false;
let decisionTimer=null;

const balanceEl=document.getElementById("balance");
const betEl=document.getElementById("bet");
const playerCardsEl=document.getElementById("playerCards");
const dealerCardsEl=document.getElementById("dealerCards");
const playerScoreEl=document.getElementById("playerScore");
const dealerScoreEl=document.getElementById("dealerScore");
const message=document.getElementById("message");
const hitBtn=document.getElementById("hit");
const standBtn=document.getElementById("stand");

/* ================= AUTH ================= */

onAuthStateChanged(auth, async(user)=>{

  if(!user){
    window.location.replace("index.html");
    return;
  }

  currentUser=user;

  const snap=await getDoc(doc(db,"users",user.uid));

  if(!snap.exists() || snap.data().balance === undefined){
    message.innerText="Hesabınıza bakiye tanımlanmamış.";
    return;
  }

  balance=snap.data().balance;

  if(balance < bet){
    message.innerText="Yetersiz bakiye.";
    return;
  }

  updateUI();
  startGame();
});

/* ================= GAME ================= */

function startGame(){

  player=[];
  dealer=[];
  gameActive=true;

  balance-=bet;
  updateUI();

  player.push(draw());
  dealer.push(draw());
  player.push(draw());
  dealer.push(draw());

  render(true);

  enableDecision();
}

function draw(){
  return Math.floor(Math.random()*11)+1;
}

function calculate(hand){
  return hand.reduce((a,b)=>a+b,0);
}

function render(hideDealer){

  playerCardsEl.innerText=player.join(" , ");
  playerScoreEl.innerText=calculate(player);

  if(hideDealer){
    dealerCardsEl.innerText=dealer[0]+" , ?";
    dealerScoreEl.innerText="?";
  }else{
    dealerCardsEl.innerText=dealer.join(" , ");
    dealerScoreEl.innerText=calculate(dealer);
  }
}

function enableDecision(){

  hitBtn.disabled=false;
  standBtn.disabled=false;
  message.innerText="Karar için 10 saniye";

  decisionTimer=setTimeout(()=>{
    if(gameActive) stand();
  },10000);
}

hitBtn.onclick=()=>{
  if(!gameActive) return;

  player.push(draw());
  render(true);

  if(calculate(player)>21){
    endGame("lose");
  }
};

standBtn.onclick=stand;

function stand(){
  if(!gameActive) return;

  clearTimeout(decisionTimer);

  while(calculate(dealer)<17){
    dealer.push(draw());
  }

  render(false);

  const p=calculate(player);
  const d=calculate(dealer);

  if(d>21 || p>d){
    endGame("win");
  }else if(p<d){
    endGame("lose");
  }else{
    endGame("push");
  }
}

function endGame(result){

  gameActive=false;
  hitBtn.disabled=true;
  standBtn.disabled=true;

  if(result==="win"){
    balance+=bet*2;
    message.innerText="Kazandınız!";
  }
  else if(result==="push"){
    balance+=bet;
    message.innerText="Berabere.";
  }
  else{
    message.innerText="Kaybettiniz.";
  }

  saveBalance();
  updateUI();
}

async function saveBalance(){
  await updateDoc(doc(db,"users",currentUser.uid),{
    balance:balance
  });
}

function updateUI(){
  balanceEl.innerText=balance;
  betEl.innerText=bet;
}

</script>
</body>
</html>
