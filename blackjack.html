<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Live Blackjack</title>

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:Arial;
}

html,body{
height:100%;
overflow:hidden;
background:#000;
overscroll-behavior:none;
}

.app{
position:fixed;
inset:0;
width:100%;
height:100%;
color:white;
overflow:hidden;
}

/* ÜST ARKA PLAN */
.studio{
position:absolute;
top:0;
left:0;
width:100%;
height:60%;
background:
linear-gradient(to bottom,rgba(0,0,0,0.2),rgba(0,0,0,0.7)),
url('https://images.unsplash.com/photo-1512453979798-5ea266f8880c?auto=format&fit=crop&w=1400&q=80');
background-size:cover;
background-position:center;
}

/* ÜST BAR */
.topBar{
position:absolute;
top:0;
width:100%;
height:40px;
background:rgba(0,0,0,.6);
display:flex;
justify-content:space-between;
align-items:center;
padding:0 12px;
font-size:13px;
z-index:10;
}

/* DEALER */
.dealerZone{
position:absolute;
top:60px;
width:100%;
text-align:center;
}

.score{
font-size:14px;
color:#22c55e;
margin-top:5px;
}

/* MASA */
.table{
position:absolute;
bottom:110px;
width:100%;
height:35%;
background:#0a0a0a;
border-top-left-radius:50% 25%;
border-top-right-radius:50% 25%;
padding-top:25px;
text-align:center;
}

/* KARTLAR */
.hand{
margin-top:10px;
min-height:95px;
}

.card{
width:60px;
height:90px;
background:white;
border-radius:8px;
display:inline-flex;
align-items:center;
justify-content:center;
margin:4px;
font-weight:bold;
font-size:20px;
}

.red{color:#c1121f;}
.black{color:black;}

/* BAHİS */
.betOptions{
position:absolute;
bottom:90px;
width:100%;
display:flex;
justify-content:center;
gap:15px;
}

.betBtn{
width:65px;
height:65px;
border-radius:50%;
background:rgba(255,255,255,.1);
display:flex;
align-items:center;
justify-content:center;
cursor:pointer;
font-weight:bold;
}

/* KONTROLLER */
.controls{
position:absolute;
bottom:50px;
width:100%;
text-align:center;
}

.controls button{
padding:8px 14px;
margin:4px;
border:none;
border-radius:6px;
background:#22c55e;
color:black;
font-weight:bold;
}

.controls button:disabled{
background:#555;
color:#aaa;
}

/* ALT BAR */
.bottomBar{
position:absolute;
bottom:0;
width:100%;
height:50px;
background:#000;
display:flex;
justify-content:space-between;
align-items:center;
padding:0 15px;
font-size:13px;
padding-bottom:env(safe-area-inset-bottom);
}

.ticker{
position:absolute;
bottom:160px;
width:100%;
text-align:center;
font-size:18px;
font-weight:bold;
color:#00ffcc;
text-shadow:0 0 15px #00ffcc;
}
</style>
</head>

<body>
<div class="app">

<div class="studio"></div>

<div class="topBar">
<div>Türkçe Blackjack • 8 Deck • S17</div>
<div>ID: -</div>
</div>

<div class="dealerZone">
<div>Dealer</div>
<div class="score" id="dealerScore"></div>
<div class="hand" id="dealerHand"></div>
</div>

<div class="table">
<div>Oyuncu</div>
<div class="score" id="playerScore"></div>
<div class="hand" id="playerHand"></div>
</div>

<div class="ticker" id="ticker">Bahis koyun</div>

<div class="betOptions">
<div class="betBtn" onclick="placeBet(50)">50₺</div>
<div class="betBtn" onclick="placeBet(100)">100₺</div>
<div class="betBtn" onclick="placeBet(250)">250₺</div>
</div>

<div class="controls">
<button id="dealBtn" disabled onclick="startRound()">Dağıt</button>
<button id="hitBtn" disabled onclick="hit()">Hit</button>
<button id="standBtn" disabled onclick="stand()">Stand</button>
</div>

<div class="bottomBar">
<div>Bakiye: ₺<span id="balance">0</span></div>
<div>Bahis: ₺<span id="bet">0</span></div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
authDomain:"emirhan-site.firebaseapp.com",
projectId:"emirhan-site",
storageBucket:"emirhan-site.firebasestorage.app",
messagingSenderId:"668871888390",
appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser=null;
let balance=0,currentBet=0,gameActive=false;
let shoe=[],player=[],dealer=[];

const SUITS=['♠','♥','♦','♣'];
const VALUES=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

function buildShoe(){
shoe=[];
for(let d=0;d<8;d++)
for(let s of SUITS)
for(let v of VALUES)
shoe.push({value:v,suit:s});
shuffle();
}

function shuffle(){
for(let i=shoe.length-1;i>0;i--){
let j=Math.floor(Math.random()*(i+1));
[shoe[i],shoe[j]]=[shoe[j],shoe[i]];
}
}

function draw(){
if(shoe.length<60) buildShoe();
return shoe.pop();
}

function value(c){
if(c.value==="A") return 11;
if(["K","Q","J"].includes(c.value)) return 10;
return parseInt(c.value);
}

function score(hand){
let total=0,aces=0;
hand.forEach(c=>{
total+=value(c);
if(c.value==="A") aces++;
});
while(total>21&&aces>0){
total-=10;
aces--;
}
return total;
}

function updateUI(){
document.getElementById("balance").innerText=balance;
document.getElementById("bet").innerText=currentBet;
}

function setButtons(d=false,h=false,s=false){
dealBtn.disabled=!d;
hitBtn.disabled=!h;
standBtn.disabled=!s;
}

window.placeBet=function(amount){
if(!currentUser||gameActive||balance<amount)return;
balance-=amount;
currentBet+=amount;
updateUI();
if(currentBet>0) dealBtn.disabled=false;
}

window.startRound=function(){
if(gameActive||currentBet<=0)return;
gameActive=true;
player=[];dealer=[];
setButtons(false,true,true);
player.push(draw());
dealer.push(draw());
player.push(draw());
dealer.push(draw());
render(true);
updateScores(true);
}

window.hit=function(){
if(!gameActive)return;
player.push(draw());
render(true);
updateScores(true);
if(score(player)>21){revealDealer();setTimeout(endRound,800);}
}

window.stand=function(){
if(!gameActive)return;
revealDealer();
}

function revealDealer(){
render(false);
updateScores(false);
dealerPlay();
}

function dealerPlay(){
let interval=setInterval(()=>{
if(score(dealer)<17){
dealer.push(draw());
render(false);
updateScores(false);
}else{
clearInterval(interval);
setTimeout(endRound,800);
}
},500);
}

async function endRound(){
gameActive=false;
let p=score(player),d=score(dealer);
if(p<=21&&(d>21||p>d))balance+=currentBet*2;
else if(p===d)balance+=currentBet;
currentBet=0;
updateUI();
setButtons(false,false,false);
if(currentUser)await updateDoc(doc(db,"users",currentUser.uid),{balance});
}

function cardHTML(c){
let color=(c.suit==="♥"||c.suit==="♦")?"red":"black";
return `<div class="card ${color}">${c.value}${c.suit}</div>`;
}

function render(hide=false){
playerHand.innerHTML=player.map(cardHTML).join("");
dealerHand.innerHTML=
hide&&dealer.length?cardHTML(dealer[0])+`<div class="card"></div>`:
dealer.map(cardHTML).join("");
}

function updateScores(hide=false){
playerScore.innerText=player.length?"Toplam: "+score(player):"";
dealerScore.innerText=dealer.length?(hide?value(dealer[0]):score(dealer)):"";
}

onAuthStateChanged(auth,async(user)=>{
if(!user){window.location.replace("index.html");return;}
currentUser=user;
const snap=await getDoc(doc(db,"users",user.uid));
balance=snap.exists()?snap.data().balance||0:0;
updateUI();
setButtons(false,false,false);
});

buildShoe();
</script>

</body>
</html>
