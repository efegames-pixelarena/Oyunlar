<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Live Blackjack Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial}
body{background:#000;overflow:hidden;height:100svh;}
.app{width:100vw;height:100svh;position:relative;color:white;overflow:hidden;}
:root{--safe-bottom: env(safe-area-inset-bottom);}
.studio{position:absolute;top:0;left:0;width:100%;height:65%;
background:linear-gradient(to bottom,rgba(0,0,0,0.2),rgba(0,0,0,0.7)),
url('https://images.unsplash.com/photo-1512453979798-5ea266f8880c?auto=format&fit=crop&w=1400&q=80');
background-size:cover;background-position:center;}
.ticker{position:absolute;top:65%;left:50%;transform:translate(-50%,-50%);
font-size:20px;font-weight:bold;color:#00ffcc;text-shadow:0 0 15px #00ffcc;z-index:20;}
.dealerZone{position:absolute;top:60px;left:0;width:100%;text-align:center;}
.score{font-size:14px;color:#22c55e;margin-top:5px;}
.topBar{position:absolute;top:0;width:100%;height:35px;background:rgba(0,0,0,.6);
display:flex;justify-content:space-between;align-items:center;padding:0 10px;font-size:12px;}
.table{position:absolute;bottom:30%;left:0;width:100%;height:35%;
background:#0a0a0a;border-top-left-radius:50% 25%;
border-top-right-radius:50% 25%;padding-top:25px;text-align:center;}
.hand{margin-top:10px;min-height:95px;}
.card{width:60px;height:90px;background:white;border-radius:8px;
display:inline-flex;align-items:center;justify-content:center;
margin:4px;font-weight:bold;font-size:20px;}
.red{color:#c1121f}.black{color:black}
.betOptions{position:absolute;bottom:120px;width:100%;
display:flex;justify-content:center;gap:15px;}
.betBtn{width:60px;height:60px;border-radius:50%;
background:rgba(255,255,255,.1);
display:flex;align-items:center;justify-content:center;cursor:pointer;}
.controls{position:absolute;bottom:70px;width:100%;text-align:center;}
.controls button{padding:8px 14px;margin:4px;border:none;
border-radius:6px;background:#22c55e;color:black;font-weight:bold;}
.controls button:disabled{background:#555;color:#aaa;}
.bottomBar{position:absolute;bottom:0;width:100%;height:70px;
background:#000;display:flex;justify-content:space-between;
align-items:center;padding:0 15px;font-size:13px;}
</style>
</head>
<body>
<div class="app">

<div class="studio"></div>

<div class="topBar">
<div>Türkçe Blackjack • 8 Deck • S17</div>
<div>ID: <span id="roundId">-</span></div>
</div>

<div class="dealerZone">
<div>Dealer</div>
<div class="score" id="dealerScore"></div>
<div class="hand" id="dealerHand"></div>
</div>

<div class="table">
<div>Oyuncu</div>
<div class="score" id="playerScore"></div>
<div class="hand" id="playerHand"></div>
</div>

<div class="betOptions">
<div class="betBtn" onclick="placeBet(50)">50₺</div>
<div class="betBtn" onclick="placeBet(100)">100₺</div>
<div class="betBtn" onclick="placeBet(250)">250₺</div>
</div>

<div class="controls">
<button id="dealBtn" disabled onclick="startCountdown()">Dağıt</button>
<button id="hitBtn" disabled onclick="hit()">Hit</button>
<button id="standBtn" disabled onclick="stand()">Stand</button>
</div>

<div class="ticker" id="ticker">Yükleniyor...</div>

<div class="bottomBar">
<div>Bakiye: ₺<span id="balance">0</span></div>
<div>Toplam Bahis: ₺<span id="bet">0</span></div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
authDomain:"emirhan-site.firebaseapp.com",
projectId:"emirhan-site",
storageBucket:"emirhan-site.firebasestorage.app",
messagingSenderId:"668871888390",
appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let currentUser=null;
let balance=0,currentBet=0;
let shoe=[],player=[],dealer=[];
let gameActive=false,round=1;

const SUITS=['♠','♥','♦','♣'];
const VALUES=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

function buildShoe(){shoe=[];for(let d=0;d<8;d++)for(let s of SUITS)for(let v of VALUES)shoe.push({value:v,suit:s});shuffle();}
function shuffle(){for(let i=shoe.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[shoe[i],shoe[j]]=[shoe[j],shoe[i]]}}
function draw(){if(shoe.length<60)buildShoe();return shoe.pop();}
function value(c){if(c.value=="A")return 11;if(["K","Q","J"].includes(c.value))return 10;return parseInt(c.value);}
function score(h){let t=0,a=0;h.forEach(c=>{t+=value(c);if(c.value=="A")a++});while(t>21&&a>0){t-=10;a--}return t;}
function cardHTML(c){let color=(c.suit=="♥"||c.suit=="♦")?"red":"black";return `<div class="card ${color}">${c.value}${c.suit}</div>`}

function updateUI(){balanceEl.innerText=balance;betEl.innerText=currentBet;}
const balanceEl=document.getElementById("balance");
const betEl=document.getElementById("bet");

function placeBet(a){
if(!currentUser||gameActive||balance<a)return;
balance-=a;currentBet+=a;updateUI();
}

function startCountdown(){
if(currentBet<=0)return;
startRound();
}

function startRound(){
player=[];dealer=[];gameActive=true;
document.getElementById("hitBtn").disabled=false;
document.getElementById("standBtn").disabled=false;
player.push(draw());dealer.push(draw());player.push(draw());dealer.push(draw());
render(true);updateScores(true);
}

function hit(){player.push(draw());render(true);updateScores(true);
if(score(player)>21){revealDealer();setTimeout(endRound,1000)}}
function stand(){revealDealer();}
function revealDealer(){render(false);updateScores(false);dealerPlay();}
function dealerPlay(){let i=setInterval(()=>{if(score(dealer)<17){dealer.push(draw());render(false);updateScores(false)}
else{clearInterval(i);setTimeout(endRound,1000)}},600);}

async function endRound(){
gameActive=false;
document.getElementById("hitBtn").disabled=true;
document.getElementById("standBtn").disabled=true;
let p=score(player),d=score(dealer);
if(p<=21&&(d>21||p>d)){balance+=currentBet*2;}
else if(p==d){balance+=currentBet;}
currentBet=0;updateUI();
await updateDoc(doc(db,"users",currentUser.uid),{balance});
}

function render(h=false){
document.getElementById("playerHand").innerHTML=player.map(cardHTML).join("");
document.getElementById("dealerHand").innerHTML=h?cardHTML(dealer[0]):dealer.map(cardHTML).join("");
}
function updateScores(h=false){
document.getElementById("playerScore").innerText=player.length?"Toplam: "+score(player):"";
document.getElementById("dealerScore").innerText=dealer.length?(h?value(dealer[0]):score(dealer)):"";
}

onAuthStateChanged(auth,async(user)=>{
if(!user){window.location.href="index.html";return;}
currentUser=user;
const snap=await getDoc(doc(db,"users",user.uid));
balance=snap.exists()?snap.data().balance||0:0;
updateUI();
document.getElementById("dealBtn").disabled=false;
document.getElementById("ticker").innerText="Bahis koyun";
});

buildShoe();
</script>
</body>
</html>
