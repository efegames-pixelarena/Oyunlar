<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PixelArena Casino - Pro</title>

<style>
    /* TEMEL SIFIRLAMA */
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none;}
    
    body {
        height:100vh;
        width: 100vw;
        overflow:hidden;
        font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
        background: radial-gradient(circle at 50% 50%, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.5) 100%),
                    linear-gradient(135deg, #073d1c 0%, #0a5d2a 50%, #063d1c 100%);
        color:white;
        touch-action:manipulation;
        display: flex;
        flex-direction: column;
    }

    /* ÜST BAR - STİL KORUNDU */
    .top-bar {
        height: 60px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 10px;
        background: #000;
        border-bottom: 2px solid #d4af37;
        z-index: 100;
        flex-shrink: 0;
    }

    .brand {
        font-size: 16px;
        font-weight: 900;
        color: #ffd700;
        line-height: 1.1;
        text-transform: uppercase;
    }

    .right-menu { display: flex; gap: 8px; align-items: center; }

    .nav-box {
        padding: 5px 10px;
        border-radius: 8px;
        text-align: center;
        min-width: 85px;
        font-weight: 700;
        font-size: 12px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .balance-box { background: #1a2a6c; border: 1px solid #4fd1ff; color: #fff; }
    .bet-box { background: #ff8a00; color: #000; }

    /* OYUN ALANI DÜZENİ - KAYMALARI ÖNLER */
    .game-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px 0;
        position: relative;
    }

    .area { width: 100%; text-align: center; }

    .dealer-title {
        font-size: 18px;
        letter-spacing: 5px;
        color: rgba(212, 175, 55, 0.6);
        margin-bottom: 10px;
        font-weight: 800;
    }

    .score-badge {
        background: rgba(0,0,0,0.6);
        color: #ffd700;
        padding: 4px 15px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 700;
        display: inline-block;
        margin-bottom: 10px;
        border: 1px solid rgba(255,215,0,0.3);
    }

    .cards-wrapper {
        display: flex;
        justify-content: center;
        gap: 8px;
        min-height: 105px;
        padding: 0 10px;
    }

    .card {
        width: 70px;
        height: 100px;
        border-radius: 6px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        transform: translateY(-20px);
        opacity: 0;
        transition: all 0.5s ease-out;
    }
    .card.show { transform: translateY(0); opacity: 1; }

    /* MESAJ VE KONTROLLER */
    #message {
        font-size: 22px;
        font-weight: 900;
        color: #fff;
        text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        text-transform: uppercase;
        height: 30px;
    }

    .controls {
        display: none;
        gap: 15px;
        justify-content: center;
        margin-bottom: 10px;
    }

    .btn {
        padding: 12px 25px;
        border-radius: 10px;
        border: none;
        font-weight: 800;
        font-size: 15px;
        color: white;
        box-shadow: 0 4px 0 rgba(0,0,0,0.2);
    }
    #hit { background: #2ecc71; }
    #stand { background: #e74c3c; }

    /* ÇİPLER ALANI */
    .chips-area {
        display: flex;
        justify-content: center;
        gap: 12px;
        padding-bottom: 15px;
    }

    .chip {
        width: 65px;
        height: 65px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
        font-size: 16px;
        border: 4px dashed rgba(255,255,255,0.4);
        box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    }
    .c250 { background: #fff; color: #000; }
    .c500 { background: #27ae60; color: #fff; }
    .c1k { background: #e74c3c; color: #fff; }
    .c2k { background: #000; color: #fff; border-color: #ffd700; }
    
    .disabled { opacity: 0.3; pointer-events: none; }
</style>
</head>
<body>

<div class="top-bar">
    <div class="brand">PIXEL ARENA<br>CASINO</div>
    <div class="right-menu">
        <div class="nav-box balance-box">BAKİYE:<br><span id="balance">0</span>₺</div>
        <div class="nav-box bet-box">BAHİS:<br><span id="bet">0</span>₺</div>
    </div>
</div>

<div class="game-container">
    <div id="dealerArea" class="area">
        <div class="dealer-title">KURUPİER</div>
        <div class="score-badge">SAYI: <span id="dealerScore">0</span></div>
        <div id="dealerCards" class="cards-wrapper"></div>
    </div>

    <div class="area">
        <div id="message">BAHİS YAPIN</div>
        <div class="controls" id="controls">
            <button id="hit" class="btn">KART ÇEK</button>
            <button id="stand" class="btn">KAL</button>
        </div>
    </div>

    <div id="playerArea" class="area">
        <div id="playerCards" class="cards-wrapper"></div>
        <div class="score-badge">SAYI: <span id="playerScore">0</span></div>
    </div>

    <div class="chips-area" id="chipsArea">
        <div class="chip c250" onclick="addBet(250)">250</div>
        <div class="chip c500" onclick="addBet(500)">500</div>
        <div class="chip c1k" onclick="addBet(1000)">1K</div>
        <div class="chip c2k" onclick="addBet(2000)">2K</div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
    authDomain:"emirhan-site.firebaseapp.com",
    projectId:"emirhan-site",
    storageBucket:"emirhan-site.firebasestorage.app",
    messagingSenderId:"668871888390",
    appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let audioCtx = null, balance = 0, bet = 0, userRef = null;
let gameState = "loading", betCountdown = null, actionTimer = null;
let deck = [], player = [], dealer = [], dealerHidden = true;

// DOM ELEMANLARI
const balanceEl = document.getElementById("balance");
const betEl = document.getElementById("bet");
const messageEl = document.getElementById("message");
const controlsEl = document.getElementById("controls");
const chipsAreaEl = document.getElementById("chipsArea");

// SES SİSTEMİ
function playSound(type) {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === "suspended") audioCtx.resume();
    const now = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.connect(g); g.connect(audioCtx.destination);

    if(type==='chip') { osc.frequency.setValueAtTime(1000, now); g.gain.setValueAtTime(0.1, now); osc.start(); osc.stop(now+0.05); }
    if(type==='card') { osc.type='triangle'; osc.frequency.setValueAtTime(400, now); g.gain.setValueAtTime(0.05, now); osc.start(); osc.stop(now+0.1); }
    if(type==='win') { osc.frequency.setValueAtTime(600, now); g.gain.setValueAtTime(0.1, now); osc.start(); osc.stop(now+0.3); }
}

onAuthStateChanged(auth, user => {
    if(!user) return;
    userRef = doc(db, "users", user.uid);
    onSnapshot(userRef, snap => {
        balance = snap.data().balance || 0;
        balanceEl.innerText = balance;
        if(gameState === "loading") gameState = "betting";
    });
});

window.addBet = (amount) => {
    if(gameState !== "betting" || balance < amount) return;
    if(bet + amount > 20000) return;
    playSound('chip');
    bet += amount;
    balance -= amount;
    balanceEl.innerText = balance;
    betEl.innerText = bet;
    if(!betCountdown) startBetCountdown();
};

function startBetCountdown(){
    let s = 5;
    messageEl.innerText = "BAŞLIYOR: " + s;
    betCountdown = setInterval(() => {
        s--;
        if(s > 0) messageEl.innerText = "BAŞLIYOR: " + s;
        else { clearInterval(betCountdown); betCountdown = null; messageEl.innerText = ""; startGame(); }
    }, 1000);
}

async function startGame(){
    gameState = "playing";
    chipsAreaEl.classList.add("disabled");
    document.getElementById("dealerCards").innerHTML = "";
    document.getElementById("playerCards").innerHTML = "";
    player = []; dealer = []; dealerHidden = true;
    createDeck();
    await updateDoc(userRef, { balance: balance });

    await draw(player, "playerCards"); await delay(2000);
    await draw(dealer, "dealerCards"); await delay(2000);
    await draw(player, "playerCards"); await delay(2000);
    await draw(dealer, "dealerCards", true);

    if(total(player) === 21) dealerTurn();
    else { controlsEl.style.display = "flex"; startActionTimer(); }
}

async function draw(hand, divId, hidden=false){
    playSound('card');
    let card = deck.pop();
    hand.push(card);
    let img = document.createElement("img");
    img.className = "card";
    img.src = hidden ? "https://deckofcardsapi.com/static/img/back.png" : `https://deckofcardsapi.com/static/img/${card.v}${card.s}.png`;
    document.getElementById(divId).appendChild(img);
    setTimeout(() => img.classList.add("show"), 50);
    updateScores();
}

function createDeck(){
    const s=["H","D","C","S"], v=["A","2","3","4","5","6","7","8","9","0","J","Q","K"];
    deck = []; s.forEach(x => v.forEach(y => deck.push({s:x, v:y})));
    deck.sort(() => Math.random() - 0.5);
}

function total(h){
    let t=0, a=0;
    h.forEach(c => {
        if(c.v==='A') a++;
        else if(['J','Q','K','0'].includes(c.v)) t+=10;
        else t+=parseInt(c.v);
    });
    for(let i=0; i<a; i++) t += (t+11 > 21) ? 1 : 11;
    return t;
}

function updateScores(){
    document.getElementById("playerScore").innerText = total(player);
    document.getElementById("dealerScore").innerText = dealerHidden ? (dealer[0] ? (['J','Q','K','0'].includes(dealer[0].v)?10:dealer[0].v==='A'?11:parseInt(dealer[0].v)) : 0) : total(dealer);
}

function startActionTimer(){
    let s = 10;
    messageEl.innerText = "KARAR (" + s + ")";
    actionTimer = setInterval(() => {
        s--;
        if(s>0) { messageEl.innerText = "KARAR (" + s + ")"; playSound('count'); }
        else { clearInterval(actionTimer); stand(); }
    }, 1000);
}

document.getElementById("hit").onclick = async () => {
    clearInterval(actionTimer);
    controlsEl.style.display = "none";
    await draw(player, "playerCards");
    if(total(player) > 21) dealerTurn();
    else { await delay(2000); controlsEl.style.display = "flex"; startActionTimer(); }
};

document.getElementById("stand").onclick = () => { clearInterval(actionTimer); controlsEl.style.display="none"; dealerTurn(); };

async function dealerTurn(){
    dealerHidden = false;
    const dc = document.getElementById("dealerCards").children;
    if(dc[1]) dc[1].src = `https://deckofcardsapi.com/static/img/${dealer[1].v}${dealer[1].s}.png`;
    updateScores();
    await delay(2000);
    if(total(player) <= 21){
        while(total(dealer) < 17){ await draw(dealer, "dealerCards"); await delay(2000); }
    }
    endGame();
}

async function endGame(){
    let p=total(player), d=total(dealer), m=0, txt="";
    if(p>21) txt="BUST! KAYBETTİN";
    else if(d>21 || p>d) { txt="KAZANDIN!"; m=2; playSound('win'); }
    else if(d>p) txt="KAYBETTİN";
    else { txt="BERABERE"; m=1; }
    
    if(m>0) await updateDoc(userRef, { balance: increment(bet*m) });
    messageEl.innerText = txt;
    await delay(3000);
    bet = 0; betEl.innerText = 0;
    gameState = "betting";
    chipsAreaEl.classList.remove("disabled");
    messageEl.innerText = "BAHİS YAPIN";
    updateScores();
}

function delay(ms){ return new Promise(r => setTimeout(r, ms)); }

</script>
</body>
</html>
