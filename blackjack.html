<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Blackjack</title>
<style>
body{
background:#0f172a;
color:white;
font-family:Arial;
text-align:center;
margin:0;
padding:0;
}

.topbar{
background:#111827;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
font-size:18px;
}

.game-area{
margin-top:30px;
}

.cards{
display:flex;
justify-content:center;
gap:10px;
margin:15px 0;
}

.card{
width:70px;
height:100px;
background:white;
color:black;
border-radius:8px;
display:flex;
align-items:center;
justify-content:center;
font-weight:bold;
font-size:20px;
}

.red{color:red;}
.back{background:#374151;}

button{
padding:10px 20px;
margin:5px;
border:none;
border-radius:6px;
cursor:pointer;
font-size:16px;
}

.bet-btn{background:#2563eb;color:white;}
.control-btn{background:#16a34a;color:white;}
#controls{display:none;}
</style>
</head>
<body>

<div class="topbar">
<div>Bakiye: ₺<span id="balance">0</span></div>
<div>Bahis: ₺<span id="bet">0</span></div>
</div>

<div class="game-area">
<h2>Krupi̇ye</h2>
<div id="dealerCards" class="cards"></div>
<div>Skor: <span id="dealerScore">0</span></div>

<h2>Oyuncu</h2>
<div id="playerCards" class="cards"></div>
<div>Skor: <span id="playerScore">0</span></div>

<h3 id="message">Yükleniyor...</h3>

<div>
<button class="bet-btn" onclick="addBet(100)">100₺</button>
<button class="bet-btn" onclick="addBet(500)">500₺</button>
<button class="bet-btn" onclick="addBet(1000)">1000₺</button>
</div>

<div id="controls">
<button id="hit" class="control-btn">HIT</button>
<button id="stand" class="control-btn">STAND</button>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore,doc,onSnapshot,updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"API_KEY",
authDomain:"PROJECT.firebaseapp.com",
projectId:"PROJECT",
storageBucket:"PROJECT.appspot.com",
messagingSenderId:"XXXX",
appId:"XXXX"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let balance=0,bet=0,userRef=null;
let betTimer=null,decisionTimer=null;
let betTime=5,decisionTime=10;
let gameState="betting";
let deck=[],player=[],dealer=[],dealerHidden=null;

const balanceEl=document.getElementById("balance");
const betEl=document.getElementById("bet");
const messageEl=document.getElementById("message");
const playerCardsEl=document.getElementById("playerCards");
const dealerCardsEl=document.getElementById("dealerCards");
const playerScoreEl=document.getElementById("playerScore");
const dealerScoreEl=document.getElementById("dealerScore");
const controls=document.getElementById("controls");

onAuthStateChanged(auth,user=>{
if(!user){
messageEl.innerText="Giriş Yapmalısın";
return;
}
userRef=doc(db,"users",user.uid);
onSnapshot(userRef,snap=>{
if(!snap.exists()||snap.data().balance==null){
messageEl.innerText="Balance Yok";
return;
}
balance=snap.data().balance;
updateUI();
messageEl.innerText="Bahis Yapın";
});
});

function updateUI(){
balanceEl.innerText=balance;
betEl.innerText=bet;
playerScoreEl.innerText=total(player);
dealerScoreEl.innerText=(gameState==="playing")?(dealer[0]?cardValue(dealer[0]):0):total(dealer);
}

function createDeck(){
deck=[];
for(let s of ["♥","♦","♣","♠"]){
for(let v=1;v<=13;v++){
deck.push({suit:s,value:v});
}}
deck.sort(()=>Math.random()-0.5);
}

function cardValue(c){
if(c.value>10)return 10;
if(c.value===1)return 11;
return c.value;
}

function total(hand){
let t=0,a=0;
for(let c of hand){
let v=cardValue(c);
t+=v;
if(c.value===1)a++;
}
while(t>21&&a>0){t-=10;a--;}
return t;
}

function renderCard(c){
let d=document.createElement("div");
d.className="card "+((c.suit==="♥"||c.suit==="♦")?"red":"");
let v=c.value===1?"A":c.value===11?"J":c.value===12?"Q":c.value===13?"K":c.value;
d.innerText=v+c.suit;
return d;
}

function renderBack(){
let d=document.createElement("div");
d.className="card back";
return d;
}

window.addBet=async function(amount){
if(gameState!=="betting"||balance<amount)return;
balance-=amount;
bet+=amount;
await updateDoc(userRef,{balance});
updateUI();
if(!betTimer)startBetTimer();
}

function startBetTimer(){
betTime=5;
messageEl.innerText="Bahisler Kapanıyor: "+betTime;
betTimer=setInterval(()=>{
betTime--;
if(betTime<=0){
clearInterval(betTimer);
betTimer=null;
messageEl.innerText="";
if(bet>0)startGame();
}else{
messageEl.innerText="Bahisler Kapanıyor: "+betTime;
}
},1000);
}

function startGame(){
gameState="dealing";
createDeck();
player=[];dealer=[];
playerCardsEl.innerHTML="";
dealerCardsEl.innerHTML="";
setTimeout(()=>{
deal("player");
deal("dealer");
deal("player");
dealerHidden=deck.pop();
dealer.push(dealerHidden);
dealerCardsEl.appendChild(renderCard(dealer[0]));
dealerCardsEl.appendChild(renderBack());
gameState="playing";
controls.style.display="block";
startDecisionTimer();
updateUI();
},3000);
}

function deal(to){
let c=deck.pop();
if(to==="player"){
player.push(c);
playerCardsEl.appendChild(renderCard(c));
}else{
dealer.push(c);
dealerCardsEl.appendChild(renderCard(c));
}
updateUI();
}

function startDecisionTimer(){
decisionTime=10;
messageEl.innerText="Karar Süresi: "+decisionTime;
decisionTimer=setInterval(()=>{
decisionTime--;
if(decisionTime<=0){
clearInterval(decisionTimer);
stand();
}else{
messageEl.innerText="Karar Süresi: "+decisionTime;
}
},1000);
}

document.getElementById("hit").onclick=()=>{
if(gameState!=="playing")return;
deal("player");
if(total(player)>21)finish("lose");
};

async function stand(){
if(gameState!=="playing")return;
clearInterval(decisionTimer);
gameState="finished";
controls.style.display="none";
dealerCardsEl.children[1].remove();
dealerCardsEl.appendChild(renderCard(dealerHidden));
while(total(dealer)<17)deal("dealer");
let p=total(player),d=total(dealer);
if(d>21||p>d){
await updateDoc(userRef,{balance:balance+bet*2});
}
else if(p===d){
await updateDoc(userRef,{balance:balance+bet});
}
finish("done");
}

document.getElementById("stand").onclick=stand;

function finish(){
bet=0;
updateUI();
setTimeout(()=>{
player=[];dealer=[];
playerCardsEl.innerHTML="";
dealerCardsEl.innerHTML="";
messageEl.innerText="Bahis Yapın";
gameState="betting";
updateUI();
},3000);
}
</script>
</body>
</html>
