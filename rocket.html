<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space War Ultimate</title>

<style>
body{
margin:0;
background:black;
overflow:hidden;
display:flex;
flex-direction:column;
align-items:center;
}

canvas{
margin-top:20px;
border:3px solid #00ff88;
background:black;
}

.controls{
position:fixed;
bottom:20px;
width:100%;
display:flex;
justify-content:space-around;
}

/* SADECE TU≈û TASARIMI G√úNCELLENDƒ∞ */
.ctrl-btn{
width:100px;
height:100px;
background:#111;
border:3px solid #00ff88;
color:#00ff88;
font-size:45px;
font-weight:bold;
display:flex;
align-items:center;
justify-content:center;
border-radius:15px;
box-shadow:0 0 15px #00ff88;
}

#restartBtn{
display:none;
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
padding:15px 30px;
font-size:20px;
background:#00ff88;
border:none;
color:black;
}
</style>
</head>
<body>

<canvas id="game" width="400" height="500"></canvas>
<button id="restartBtn">Tekrar Oyna</button>

<div class="controls">
<div class="ctrl-btn" id="leftBtn">‚Üê</div>
<div class="ctrl-btn" id="rightBtn">‚Üí</div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const restartBtn=document.getElementById("restartBtn");

let highScore=Number(localStorage.getItem("spaceHighScore"))||0;
function saveHighScore(score){
if(score>highScore){
highScore=score;
localStorage.setItem("spaceHighScore",highScore);
}
}

const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
function play(freq,type="square",vol=0.1,dur=120){
let o=audioCtx.createOscillator();
let g=audioCtx.createGain();
o.type=type;
o.frequency.value=freq;
g.gain.value=vol;
o.connect(g);g.connect(audioCtx.destination);
o.start();
setTimeout(()=>o.stop(),dur);
}

const stars=[];
for(let i=0;i<120;i++){
stars.push({
x:Math.random()*400,
y:Math.random()*500,
size:Math.random()*2+0.5,
speed:Math.random()*1.5+0.5
});
}

let rockets,bullets,enemies,boss,particles;
let gifts,hearts;
let baseX,score,lives,gameRunning;
let moveLeft=false,moveRight=false;

function init(){
rockets=[{offset:0}];
bullets=[];
enemies=[];
boss=null;
particles=[];
gifts=[];
hearts=[];
baseX=180;
score=0;
lives=3;
gameRunning=true;
restartBtn.style.display="none";
}
init();

function hold(id,fn){
let el=document.getElementById(id);
el.addEventListener("touchstart",e=>{
e.preventDefault();
audioCtx.resume();
fn(true);
});
el.addEventListener("touchend",e=>{
e.preventDefault();
fn(false);
});
}
hold("leftBtn",v=>moveLeft=v);
hold("rightBtn",v=>moveRight=v);

setInterval(()=>{
if(!gameRunning)return;
for(let r of rockets){
bullets.push({x:baseX+r.offset,y:420});
}
},250);

setInterval(()=>{
if(!gameRunning)return;
enemies.push({x:Math.random()*360,y:-30});
},800);

setInterval(()=>{
if(!gameRunning)return;
if(score>0 && score%20===0 && !boss){
boss={x:130,y:-80,hp:30};
}
},2000);

setInterval(()=>{
if(!gameRunning)return;
if(rockets.length<4){
if(Math.random()<0.5){
gifts.push({x:Math.random()*360,y:-30});
}
}
},6000);

setInterval(()=>{
if(!gameRunning)return;
if(lives<5){
if(Math.random()<0.4){
hearts.push({x:Math.random()*360,y:-30,life:0});
}
}
},7000);

function createExplosion(x,y,color){
for(let i=0;i<25;i++){
particles.push({
x:x,
y:y,
vx:(Math.random()-0.5)*6,
vy:(Math.random()-0.5)*6,
life:30,
color:color
});
}
}

function hit(a,b){
return a.x<b.x+28 && a.x+28>b.x &&
a.y<b.y+28 && a.y+28>b.y;
}

function update(){
if(!gameRunning)return;

for(let s of stars){
s.y+=s.speed;
if(s.y>500){
s.y=0;
s.x=Math.random()*400;
}
}

if(moveLeft)baseX=Math.max(20,baseX-6);
if(moveRight)baseX=Math.min(360,baseX+6);

for(let i=bullets.length-1;i>=0;i--){
bullets[i].y-=9;
if(bullets[i].y<0)bullets.splice(i,1);
}

let enemySpeed=2+(score*0.08);
for(let i=enemies.length-1;i>=0;i--){
let e=enemies[i];
e.y+=enemySpeed;

if(e.y>470){
lives--;
e.y=-30;
}

for(let j=bullets.length-1;j>=0;j--){
if(hit(e,bullets[j])){
createExplosion(e.x,e.y,"orange");
bullets.splice(j,1);
enemies.splice(i,1);
score++;
play(600);
break;
}
}
}

if(boss){
boss.y+=1.5;

for(let j=bullets.length-1;j>=0;j--){
if(hit(boss,bullets[j])){
bullets.splice(j,1);
boss.hp--;
play(500);
}
}

if(boss.hp<=0){
createExplosion(boss.x,boss.y,"red");
score+=10;
boss=null;
}
}

for(let i=gifts.length-1;i>=0;i--){
let g=gifts[i];
g.y+=2;

for(let j=bullets.length-1;j>=0;j--){
if(hit(g,bullets[j])){
bullets.splice(j,1);
if(rockets.length<4){
let spacing=25;
let newOffset=(rockets.length%2==0?1:-1)*spacing*Math.ceil(rockets.length/2);
rockets.push({offset:newOffset});
}
gifts.splice(i,1);
play(900,"triangle",0.2,200);
break;
}
}

if(g && g.y>500)gifts.splice(i,1);
}

for(let i=hearts.length-1;i>=0;i--){
let h=hearts[i];
h.y+=2;
h.life++;

if(h.life>350){
hearts.splice(i,1);
continue;
}

for(let j=bullets.length-1;j>=0;j--){
if(hit(h,bullets[j])){
bullets.splice(j,1);
if(lives<5)lives++;
hearts.splice(i,1);
play(1000,"triangle",0.2,200);
break;
}
}
}

for(let i=particles.length-1;i>=0;i--){
let p=particles[i];
p.x+=p.vx;
p.y+=p.vy;
p.life--;
if(p.life<=0)particles.splice(i,1);
}

if(lives<=0){
gameRunning=false;
saveHighScore(score);
restartBtn.style.display="block";
}
}

function draw(){
ctx.clearRect(0,0,400,500);

ctx.fillStyle="white";
for(let s of stars){
ctx.fillRect(s.x,s.y,s.size,s.size);
}

for(let p of particles){
ctx.globalAlpha=p.life/30;
ctx.fillStyle=p.color;
ctx.fillRect(p.x,p.y,4,4);
ctx.globalAlpha=1;
}

ctx.font="30px Arial";
for(let r of rockets){
ctx.fillText("üöÄ",baseX+r.offset,420);
}

ctx.fillStyle="cyan";
for(let b of bullets){
ctx.fillRect(b.x,b.y,3,8);
}

ctx.font="26px Arial";
for(let e of enemies){
ctx.fillText("üëæ",e.x,e.y);
}

if(boss){
ctx.font="50px Arial";
ctx.fillText("üëΩ",boss.x,boss.y);
ctx.fillStyle="red";
ctx.fillRect(boss.x,boss.y-10,boss.hp*3,5);
}

ctx.font="24px Arial";
for(let g of gifts){
ctx.fillText("üéÅ",g.x,g.y);
}

for(let h of hearts){
ctx.globalAlpha=1-(h.life/350);
ctx.font="24px Arial";
ctx.fillText("‚ù§Ô∏è",h.x,h.y);
ctx.globalAlpha=1;
}

ctx.fillStyle="white";
ctx.font="16px Arial";
ctx.fillText("Skor: "+score+"  |  High: "+highScore,10,20);

for(let i=0;i<lives;i++){
ctx.font="20px Arial";
ctx.fillText("‚ù§Ô∏è",10+i*22,40);
}

if(!gameRunning){
ctx.font="28px Arial";
ctx.fillText("OYUN Bƒ∞TTƒ∞",120,240);
}
}

function loop(){
update();
draw();
requestAnimationFrame(loop);
}
loop();

restartBtn.onclick=()=>init();
</script>
</body>
</html>
