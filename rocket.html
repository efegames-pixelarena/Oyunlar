<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space War Ultimate | Pro</title>
    <style>
        body { margin: 0; background: #050505; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: Arial, sans-serif; }
        canvas { border: 3px solid #00ff88; background: black; box-shadow: 0 0 20px rgba(0, 255, 136, 0.2); max-width: 95vw; max-height: 70vh; }
        .controls { width: 100%; max-width: 400px; display: flex; justify-content: space-around; margin-top: 20px; }
        .ctrl-btn { width: 80px; height: 80px; background: rgba(17, 17, 17, 0.8); border: 2px solid #00ff88; color: #00ff88; font-size: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; box-shadow: 0 0 15px rgba(0, 255, 136, 0.3); touch-action: none; }
        #restartBtn { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 15px 40px; font-size: 20px; background: #00ff88; border: none; color: black; font-weight: bold; border-radius: 5px; cursor: pointer; z-index: 10; }
    </style>
</head>
<body>

<button id="restartBtn">TEKRAR BA≈ûLAT</button>
<canvas id="game" width="400" height="500"></canvas>

<div class="controls">
    <div class="ctrl-btn" id="leftBtn">‚Üê</div>
    <div class="ctrl-btn" id="rightBtn">‚Üí</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const restartBtn = document.getElementById("restartBtn");

let highScore = Number(localStorage.getItem("spaceHighScore")) || 0;
let frameCount = 0;
let moveLeft = false, moveRight = false;
let rockets, bullets, enemies, boss, particles, gifts, hearts, stars;
let baseX, score, lives, gameRunning;

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(freq, type = "square", vol = 0.05, dur = 100) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type;
    o.frequency.setValueAtTime(freq, audioCtx.currentTime);
    g.gain.setValueAtTime(vol, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur/1000);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + dur/1000);
}

function init() {
    rockets = [{ offset: 0 }];
    bullets = []; enemies = []; particles = []; gifts = []; hearts = [];
    stars = Array.from({ length: 100 }, () => ({
        x: Math.random() * 400, y: Math.random() * 500,
        size: Math.random() * 2, speed: Math.random() * 2 + 1
    }));
    boss = null; baseX = 180; score = 0; lives = 3;
    gameRunning = true; frameCount = 0;
    restartBtn.style.display = "none";
}

// Geli≈ümi≈ü √áarpƒ±≈üma Testi (Dinamik Boyut)
function hit(objA, objB, sizeA, sizeB) {
    return objA.x < objB.x + sizeB && objA.x + sizeA > objB.x &&
           objA.y < objB.y + sizeB && objA.y + sizeA > objB.y;
}

function createExplosion(x, y, color) {
    for (let i = 0; i < 15; i++) {
        particles.push({
            x, y, vx: (Math.random() - 0.5) * 5, vy: (Math.random() - 0.5) * 5,
            life: 30, color
        });
    }
}

function update() {
    if (!gameRunning) return;
    frameCount++;

    // Yƒ±ldƒ±zlar
    stars.forEach(s => { s.y += s.speed; if (s.y > 500) s.y = 0; });

    // Hareket
    if (moveLeft) baseX = Math.max(10, baseX - 6);
    if (moveRight) baseX = Math.min(350, baseX + 6);

    // Mermi √úretimi (Hƒ±za g√∂re)
    if (frameCount % 12 === 0) {
        rockets.forEach(r => bullets.push({ x: baseX + r.offset + 12, y: 410 }));
    }

    // D√º≈üman √úretimi
    if (frameCount % Math.max(20, (50 - Math.floor(score/5))) === 0) {
        enemies.push({ x: Math.random() * 370, y: -30 });
    }

    // Boss Mantƒ±ƒüƒ± (Her 50 skorda bir)
    if (score > 0 && score % 50 === 0 && !boss) {
        boss = { x: 150, y: -60, hp: 50, maxHp: 50 };
    }

    // Mermi G√ºncelleme
    for (let i = bullets.length - 1; i >= 0; i--) {
        bullets[i].y -= 10;
        if (bullets[i].y < 0) bullets.splice(i, 1);
    }

    // D√º≈üman G√ºncelleme
    for (let i = enemies.length - 1; i >= 0; i--) {
        let e = enemies[i];
        e.y += 3 + (score * 0.02);

        if (e.y > 500) { lives--; enemies.splice(i, 1); continue; }

        bullets.forEach((b, bi) => {
            if (hit(e, b, 26, 4)) {
                createExplosion(e.x, e.y, "#00ff88");
                enemies.splice(i, 1);
                bullets.splice(bi, 1);
                score++;
                playSound(400 + (score*2));
            }
        });
    }

    // Boss G√ºncelleme
    if (boss) {
        boss.y = Math.min(50, boss.y + 1);
        bullets.forEach((b, bi) => {
            if (hit(boss, b, 60, 4)) {
                boss.hp--;
                bullets.splice(bi, 1);
                playSound(200, "sawtooth", 0.03);
            }
        });
        if (boss.hp <= 0) {
            createExplosion(boss.x + 30, boss.y + 30, "red");
            score += 20; boss = null;
            playSound(100, "square", 0.2, 500);
        }
    }

    // Hediye ve Can Paketleri
    if (frameCount % 600 === 0) gifts.push({ x: Math.random() * 370, y: -30 });
    if (frameCount % 1000 === 0 && lives < 5) hearts.push({ x: Math.random() * 370, y: -30 });

    [gifts, hearts].forEach((list, type) => {
        for (let i = list.length - 1; i >= 0; i--) {
            list[i].y += 2;
            if (hit({x:baseX, y:420}, list[i], 40, 30)) {
                if (type === 0 && rockets.length < 4) {
                    let off = (rockets.length % 2 === 0 ? 1 : -1) * 25 * Math.ceil(rockets.length/2);
                    rockets.push({ offset: off });
                } else if (type === 1) { lives++; }
                list.splice(i, 1);
                playSound(800, "triangle", 0.2, 300);
            }
            else if (list[i].y > 500) list.splice(i, 1);
        }
    });

    // Partik√ºller
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.life--;
        if (p.life <= 0) particles.splice(i, 1);
    });

    if (lives <= 0) {
        gameRunning = false;
        if (score > highScore) {
            highScore = score;
            localStorage.setItem("spaceHighScore", highScore);
        }
        restartBtn.style.display = "block";
    }
}

function draw() {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, 400, 500);

    ctx.fillStyle = "white";
    stars.forEach(s => ctx.fillRect(s.x, s.y, s.size, s.size));

    particles.forEach(p => {
        ctx.globalAlpha = p.life / 30;
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x, p.y, 3, 3);
    });
    ctx.globalAlpha = 1;

    // Karakterler
    ctx.font = "34px Arial";
    rockets.forEach(r => ctx.fillText("üöÄ", baseX + r.offset, 450));

    ctx.fillStyle = "#00ff88";
    bullets.forEach(b => ctx.fillRect(b.x, b.y, 3, 10));

    ctx.font = "28px Arial";
    enemies.forEach(e => ctx.fillText("üëæ", e.x, e.y));

    if (boss) {
        ctx.font = "60px Arial";
        ctx.fillText("üëΩ", boss.x, boss.y + 50);
        ctx.fillStyle = "#333";
        ctx.fillRect(boss.x, boss.y, 60, 6);
        ctx.fillStyle = "red";
        ctx.fillRect(boss.x, boss.y, (boss.hp / boss.maxHp) * 60, 6);
    }

    ctx.font = "24px Arial";
    gifts.forEach(g => ctx.fillText("üéÅ", g.x, g.y));
    hearts.forEach(h => ctx.fillText("‚ù§Ô∏è", h.x, h.y));

    // UI
    ctx.fillStyle = "white";
    ctx.font = "bold 16px Arial";
    ctx.fillText(`SKOR: ${score}  |  EN Y√úKSEK: ${highScore}`, 10, 25);
    ctx.fillText("CAN:", 10, 50);
    for (let i = 0; i < lives; i++) ctx.fillText("‚ù§Ô∏è", 55 + i * 25, 50);

    if (!gameRunning) {
        ctx.fillStyle = "rgba(0,0,0,0.7)";
        ctx.fillRect(0, 0, 400, 500);
        ctx.fillStyle = "#00ff88";
        ctx.font = "40px Arial";
        ctx.fillText("OYUN Bƒ∞TTƒ∞", 85, 230);
        ctx.font = "20px Arial";
        ctx.fillText(`TOPLAM SKOR: ${score}`, 120, 270);
    }
}

function loop() { update(); draw(); requestAnimationFrame(loop); }

// Kontrol Eventleri
const setupCtrl = (id, state) => {
    const el = document.getElementById(id);
    const set = (v) => { if(state === 'L') moveLeft = v; else moveRight = v; audioCtx.resume(); };
    el.addEventListener("touchstart", (e) => { e.preventDefault(); set(true); });
    el.addEventListener("touchend", (e) => { e.preventDefault(); set(false); });
    el.addEventListener("touchcancel", (e) => { e.preventDefault(); set(false); });
};
setupCtrl("leftBtn", 'L');
setupCtrl("rightBtn", 'R');

init();
loop();
restartBtn.onclick = () => init();
</script>
</body>
</html>
